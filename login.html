<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Gerador de Declarações</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="bg-gradient-to-br from-blue-50 to-blue-100 min-h-screen flex items-center justify-center">
    
    <div class="bg-white rounded-2xl shadow-2xl p-8 md:p-12 max-w-md w-full mx-4">
        <!-- Logo/Header -->
        <div class="text-center mb-8">
            <div class="inline-block bg-blue-600 rounded-full p-4 mb-4">
                <i class="bi bi-file-earmark-text text-white text-4xl"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Gerador de Declarações</h1>
            <p class="text-gray-600">Sistema Profissional Online</p>
        </div>

        <!-- Login com Senha -->
        <div id="loginSenha" class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="bi bi-shield-lock mr-2"></i>Senha de Acesso
            </label>
            <input 
                type="password" 
                id="senhaInput"
                placeholder="Digite sua senha"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
            <button 
                onclick="fazerLogin()"
                class="w-full mt-3 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                <i class="bi bi-box-arrow-in-right mr-2"></i>Entrar
            </button>
        </div>

        <!-- Separador -->
        <div class="relative my-6">
            <div class="absolute inset-0 flex items-center">
                <div class="w-full border-t border-gray-300"></div>
            </div>
            <div class="relative flex justify-center text-sm">
                <span class="px-4 bg-white text-gray-500">Ou</span>
            </div>
        </div>

        <!-- Primeiro Acesso -->
        <button onclick="primeiroAcesso()" 
                class="w-full bg-gray-800 hover:bg-gray-900 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-3">
            <i class="bi bi-github text-2xl"></i>
            <span>Primeiro Acesso (GitHub)</span>
        </button>

        <!-- Footer Info -->
        <div class="mt-8 pt-6 border-t text-center text-sm text-gray-500">
            <p class="mb-2">
                <i class="bi bi-shield-check text-green-600"></i>
                Sistema seguro e privado
            </p>
            <p class="text-xs">
                Seus dados são armazenados em repositório privado do GitHub.<br>
                Apenas usuários autorizados têm acesso.
            </p>
        </div>

        <!-- Esqueceu a senha -->
        <div class="text-center mt-4">
            <button onclick="esqueceuSenha()" class="text-sm text-blue-600 hover:text-blue-800">
                <i class="bi bi-question-circle mr-1"></i>Esqueceu a senha?
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/github-api.js"></script>
    <script src="js/auth-manager.js"></script>
    <script src="js/password-manager.js"></script>
    <script src="js/dark-mode.js"></script>
    
    <script>
        // Verificar se já está autenticado
        window.addEventListener('load', async () => {
            const autenticado = await authManager.verificarAutenticacao();
            
            if (autenticado) {
                redirecionar();
            }
            
            // Focus no input
            document.getElementById('senhaInput').focus();
        });

        // Login com senha
        async function fazerLogin() {
            const credentials = await passwordManager.verificarSenha();
            
            if (credentials) {
                // Configurar token
                authManager.salvarToken(credentials.token);
                githubAPI.setToken(credentials.token);
                
                // Verificar autenticação
                const autenticado = await authManager.verificarAutenticacao();
                
                if (autenticado) {
                    redirecionar();
                } else {
                    alert('❌ Token expirado! Faça o primeiro acesso novamente.');
                    passwordManager.limparSenha();
                }
            }
        }

        // Primeiro acesso
        function primeiroAcesso() {
            window.location.href = 'callback.html';
        }

        // Esqueceu a senha
        function esqueceuSenha() {
            if (confirm('⚠️ Isso vai apagar suas credenciais salvas.\n\nVocê precisará fazer o primeiro acesso novamente e criar uma nova senha.\n\nContinuar?')) {
                passwordManager.limparSenha();
                authManager.logout();
                alert('✅ Credenciais apagadas! Clique em "Primeiro Acesso".');
            }
        }

        // Redirecionar baseado no tipo
        function redirecionar() {
            if (authManager.isAdmin()) {
                window.location.href = 'admin.html';
            } else {
                window.location.href = 'user.html';
            }
        }

        // Enter para logar
        document.getElementById('senhaInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') fazerLogin();
        });
    </script>

</body>
</html>
