<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Gerador de Declarações</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <!-- html2pdf.js - Geração de PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- CSS Custom -->
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="transition-colors duration-300" x-data="adminApp()" :class="darkMode ? 'bg-gray-900 text-gray-100' : 'bg-gray-100 text-gray-900'">
    
    <!-- Loading Overlay -->
    <div x-show="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 flex flex-col items-center">
            <div class="spinner mb-4"></div>
            <p class="text-gray-700 font-medium" x-text="loadingMessage"></p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="bi bi-shield-check text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">Painel Administrativo</h1>
                        <p class="text-blue-200 text-sm">Gerador de Declarações</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-sm text-blue-200">Administrador</p>
                        <p class="font-medium" x-text="usuario ? usuario.login : 'Carregando...'"></p>
                    </div>
                    <img x-show="usuario" :src="usuario?.avatar_url" alt="Avatar" class="w-10 h-10 rounded-full border-2 border-white">
                    <button @click="toggleDarkMode()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg transition-colors">
                        <i :class="darkMode ? 'bi-sun-fill' : 'bi-moon-fill'" class="mr-2"></i>
                        <span x-text="darkMode ? 'Claro' : 'Escuro'"></span>
                    </button>
                    <button @click="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition-colors">
                        <i class="bi bi-box-arrow-right mr-2"></i>Sair
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Alert System -->
    <div x-show="alert.show" 
         x-transition
         class="container mx-auto px-4 mt-4">
        <div :class="alert.type === 'error' ? 'bg-red-100 border-red-400 text-red-700' : 'bg-green-100 border-green-400 text-green-700'"
             class="border-l-4 p-4 rounded shadow-md" role="alert">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i :class="alert.type === 'error' ? 'bi-exclamation-triangle-fill' : 'bi-check-circle-fill'" class="text-xl mr-3"></i>
                    <p x-text="alert.message"></p>
                </div>
                <button @click="alert.show = false" class="text-lg">&times;</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        
        <!-- Dashboard Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-8">
            <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Empresas</p>
                        <p class="text-3xl font-bold text-blue-600" x-text="stats.empresas"></p>
                    </div>
                    <i class="bi bi-building text-4xl text-blue-200"></i>
                </div>
            </div>

            <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Modelos</p>
                        <p class="text-3xl font-bold text-green-600" x-text="stats.modelos"></p>
                    </div>
                    <i class="bi bi-file-earmark-text text-4xl text-green-200"></i>
                </div>
            </div>

            <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Users Ativos</p>
                        <p class="text-3xl font-bold text-purple-600" x-text="stats.users"></p>
                    </div>
                    <i class="bi bi-people text-4xl text-purple-200"></i>
                </div>
            </div>

            <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">PDFs Hoje</p>
                        <p class="text-3xl font-bold text-orange-600" x-text="stats.declaracoesHoje"></p>
                    </div>
                    <i class="bi bi-file-earmark-pdf text-4xl text-orange-200"></i>
                </div>
            </div>

            <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Total Clientes</p>
                        <p class="text-3xl font-bold text-cyan-600" x-text="stats.totalClientes || 0"></p>
                    </div>
                    <i class="bi bi-briefcase text-4xl text-cyan-200"></i>
                </div>
            </div>

            <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Total PDFs</p>
                        <p class="text-3xl font-bold text-pink-600" x-text="stats.totalDeclaracoes || 0"></p>
                    </div>
                    <i class="bi bi-graph-up-arrow text-4xl text-pink-200"></i>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div :class="darkMode ? 'bg-gray-800' : 'bg-white'" class="rounded-lg shadow-md mb-6">
            <div class="flex border-b" :class="darkMode ? 'border-gray-700' : ''">
                <button @click="activeTab = 'empresas'" 
                        :class="activeTab === 'empresas' ? 'border-blue-600 text-blue-600' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="px-6 py-3 border-b-2 font-medium transition-colors">
                    <i class="bi bi-building mr-2"></i>Empresas
                </button>
         
                <button @click="activeTab = 'clientes'" 
                        :class="activeTab === 'clientes' ? 'border-blue-600 text-blue-600' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="px-6 py-3 border-b-2 font-medium transition-colors">
                    <i class="bi bi-people mr-2"></i>Clientes (Todos)
                </button>
                       <button @click="activeTab = 'modelos'" 
                        :class="activeTab === 'modelos' ? 'border-blue-600 text-blue-600' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="px-6 py-3 border-b-2 font-medium transition-colors">
                    <i class="bi bi-file-earmark-richtext mr-2"></i>Modelos
                </button>
                <a href="users.html"
                        :class="darkMode ? 'text-gray-400 hover:text-blue-400' : 'text-gray-600 hover:text-blue-600'"
                        class="px-6 py-3 border-b-2 border-transparent hover:border-blue-300 font-medium transition-colors relative">
                    <i class="bi bi-person-gear mr-2"></i>Usuários
                    <!-- Badge de notificação -->
                    <span id="users-badge" class="hidden absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center">0</span>
                    <!-- Ícone de notificação pulsante -->
                    <i id="users-notification-icon" class="hidden bi bi-bell-fill text-orange-500 absolute -top-2 -right-2 animate-pulse"></i>
                </a>
                <button @click="activeTab = 'config'" 
                        :class="activeTab === 'config' ? 'border-blue-600 text-blue-600' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="px-6 py-3 border-b-2 font-medium transition-colors">
                    <i class="bi bi-gear mr-2"></i>Configurações
                </button>
            </div>
        </div>

        <!-- TAB: Empresas -->
        <div x-show="activeTab === 'empresas'" :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                    <i class="bi bi-building mr-2 text-blue-600"></i>Gestão de Empresas
                </h2>
                <button @click="modalNovaEmpresa = true" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                    <i class="bi bi-plus-circle mr-2"></i>Adicionar Empresa
                </button>
            </div>

            <!-- Lista de Empresas -->
            <div class="space-y-4">
                <template x-for="empresa in empresas" :key="empresa.id">
                    <div class="border-2 border-gray-200 rounded-xl p-6 hover:shadow-xl transition-all hover:border-blue-300">
                        <div class="flex items-start justify-between">
                            <!-- Lado Esquerdo: Logo + Dados -->
                            <div class="flex items-start space-x-6 flex-1">
                                <!-- Logo -->
                                <div class="flex-shrink-0">
                                    <img :src="empresa.logo" 
                                         :alt="empresa.nome" 
                                         class="w-24 h-24 object-contain rounded-lg border-2 border-gray-200 bg-white p-2">
                                </div>

                                <!-- Dados Principais -->
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-gray-800 mb-2" x-text="empresa.nome"></h3>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                        <div>
                                            <p class="text-gray-600">
                                                <i class="bi bi-credit-card text-blue-600 mr-2"></i>
                                                <strong>NIF:</strong> <span x-text="empresa.nif"></span>
                                            </p>
                                        </div>
                                        
                                        <div>
                                            <p class="text-gray-600">
                                                <i class="bi bi-geo-alt text-green-600 mr-2"></i>
                                                <strong>Município:</strong> <span x-text="empresa.endereco.municipio"></span>
                                            </p>
                                        </div>

                                        <div class="col-span-2">
                                            <p class="text-gray-600">
                                                <i class="bi bi-building text-purple-600 mr-2"></i>
                                                <strong>Sede:</strong> 
                                                <span x-text="empresa.endereco.rua"></span>
                                                <span x-show="empresa.endereco.edificio" x-text="', ' + empresa.endereco.edificio"></span>
                                                <span x-show="empresa.endereco.bairro" x-text="', ' + empresa.endereco.bairro"></span>
                                            </p>
                                        </div>

                                        <div x-show="empresa.telefone">
                                            <p class="text-gray-600">
                                                <i class="bi bi-telephone text-orange-600 mr-2"></i>
                                                <span x-text="empresa.telefone"></span>
                                            </p>
                                        </div>

                                        <div x-show="empresa.email">
                                            <p class="text-gray-600">
                                                <i class="bi bi-envelope text-red-600 mr-2"></i>
                                                <span x-text="empresa.email"></span>
                                            </p>
                                        </div>
                                    </div>

                                    <!-- Tags de Cores -->
                                    <div class="flex items-center space-x-2 mt-3">
                                        <div class="w-6 h-6 rounded border-2 border-gray-300" 
                                             :style="'background-color: ' + empresa.corPrimaria"
                                             :title="'Cor Primária: ' + empresa.corPrimaria"></div>
                                        <div class="w-6 h-6 rounded border-2 border-gray-300" 
                                             :style="'background-color: ' + empresa.corSecundaria"
                                             :title="'Cor Secundária: ' + empresa.corSecundaria"></div>
                                        <span x-show="empresa.marcaDagua" class="text-xs text-gray-500 ml-2">
                                            <i class="bi bi-water"></i> Marca d'água
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Lado Direito: Ações -->
                            <div class="flex flex-col items-end space-y-3 ml-6">
                                <!-- Contador de Declarações -->
                                <div class="text-center bg-gray-50 rounded-lg p-3 min-w-[120px]">
                                    <p class="text-xs text-gray-600 mb-1">Declarações</p>
                                    <p class="text-3xl font-bold" :class="getContador(empresa.id) >= 5 ? 'text-red-600' : 'text-green-600'">
                                        <span x-text="getContador(empresa.id)"></span><span class="text-lg text-gray-400"> / 5</span>
                                    </p>
                                </div>

                                <!-- Carimbo Thumbnail -->
                                <div class="bg-gray-50 rounded-lg p-2 border border-gray-200">
                                    <img :src="empresa.carimbo" 
                                         alt="Carimbo" 
                                         class="w-16 h-16 object-contain">
                                </div>

                                <!-- Botões de Ação -->
                                <div class="flex items-center space-x-2">
                                    <button @click="editarEmpresa(empresa)" 
                                            class="bg-blue-100 text-blue-700 hover:bg-blue-200 p-2 rounded-lg transition-colors"
                                            title="Editar">
                                        <i class="bi bi-pencil text-lg"></i>
                                    </button>
                                    <button @click="resetarContador(empresa.id)" 
                                            class="bg-orange-100 text-orange-700 hover:bg-orange-200 p-2 rounded-lg transition-colors" 
                                            title="Resetar contador">
                                        <i class="bi bi-arrow-clockwise text-lg"></i>
                                    </button>
                                    <button @click="deletarEmpresa(empresa.id)" 
                                            class="bg-red-100 text-red-700 hover:bg-red-200 p-2 rounded-lg transition-colors"
                                            title="Excluir">
                                        <i class="bi bi-trash text-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <div x-show="empresas.length === 0" class="text-center py-16 text-gray-500 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
                    <i class="bi bi-building text-7xl mb-4 text-gray-300"></i>
                    <p class="text-lg font-medium mb-2">Nenhuma empresa cadastrada ainda</p>
                    <p class="text-sm text-gray-400">Clique em "Adicionar Empresa" para começar a criar documentos profissionais</p>
                </div>
            </div>
        </div>

        <!-- TAB: Modelos -->
        <div x-show="activeTab === 'modelos'" :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                        <i class="bi bi-file-earmark-richtext mr-2 text-green-600"></i>Modelos de Documentos
                    </h2>
                    <p :class="darkMode ? 'text-gray-400' : 'text-gray-600'" class="text-sm mt-1">
                        Escolha o layout perfeito para suas declarações e recibos profissionais
                    </p>
                    <div :class="darkMode ? 'text-gray-500' : 'text-gray-500'" class="mt-2 flex items-center space-x-4 text-xs">
                        <span><i class="bi bi-file-text mr-1"></i>2 Modelos de Recibo</span>
                        <span><i class="bi bi-file-earmark-text mr-1"></i>3 Modelos de Declaração</span>
                    </div>
                </div>
            </div>

            <!-- Grid de Modelos -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <template x-for="modelo in modelos" :key="modelo.id">
                    <div @click="visualizarModelo(modelo)" 
                         class="border-2 border-gray-200 rounded-xl overflow-hidden hover:shadow-2xl transition-all cursor-pointer hover:border-blue-400 group">
                        
                        <!-- Preview Visual do Modelo -->
                        <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-8 h-72 flex items-center justify-center relative overflow-hidden">
                            
                            <!-- Marca d'água de fundo (Logo simulado com opacidade) -->
                            <div class="absolute inset-0 flex items-center justify-center opacity-10">
                                <i :class="modelo.icone" class="text-[200px] text-gray-400"></i>
                            </div>
                            
                            <!-- Miniatura estilizada do documento -->
                            <div class="relative z-10 w-full h-full flex items-center justify-center">
                                
                                <!-- Modelo EXECUTIVO (Declaração Corporativa) -->
                                <template x-if="modelo.id === 'modelo_executivo'">
                                    <div class="bg-white shadow-2xl rounded-lg w-48 h-64 p-4 border-l-4 border-blue-600">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="w-8 h-8 bg-blue-600 rounded"></div>
                                            <div class="text-xs text-gray-400">DECLARAÇÃO</div>
                                        </div>
                                        <div class="space-y-1.5">
                                            <div class="h-2 bg-gray-300 rounded"></div>
                                            <div class="h-2 bg-gray-300 rounded w-3/4"></div>
                                            <div class="h-1.5 bg-gray-200 rounded w-5/6 mt-3"></div>
                                            <div class="h-1.5 bg-gray-200 rounded"></div>
                                            <div class="h-1.5 bg-gray-200 rounded w-4/5"></div>
                                            <div class="h-1.5 bg-gray-200 rounded w-3/4"></div>
                                        </div>
                                        <div class="mt-4 pt-3 border-t">
                                            <div class="h-1.5 bg-gray-200 rounded w-2/3"></div>
                                        </div>
                                        <div class="absolute bottom-4 right-4 w-12 h-12 bg-gray-200 rounded-full opacity-30"></div>
                                    </div>
                                </template>

                                <!-- Modelo CLÁSSICO (Declaração Tradicional) -->
                                <template x-if="modelo.id === 'modelo_classico'">
                                    <div class="bg-white shadow-2xl rounded-lg w-48 h-64 p-4">
                                        <div class="text-center mb-4">
                                            <div class="w-12 h-12 bg-gray-300 rounded-full mx-auto mb-2"></div>
                                            <div class="h-2 bg-gray-300 rounded w-3/4 mx-auto"></div>
                                        </div>
                                        <div class="space-y-1.5">
                                            <div class="h-2 bg-gray-900 rounded w-2/3 mx-auto"></div>
                                            <div class="h-1.5 bg-gray-200 rounded mt-3"></div>
                                            <div class="h-1.5 bg-gray-200 rounded"></div>
                                            <div class="h-1.5 bg-gray-200 rounded w-5/6"></div>
                                            <div class="h-1.5 bg-gray-200 rounded w-4/5"></div>
                                            <div class="h-1.5 bg-gray-200 rounded"></div>
                                        </div>
                                        <div class="mt-6 text-center">
                                            <div class="h-1.5 bg-gray-300 rounded w-1/2 mx-auto"></div>
                                            <div class="w-16 h-6 bg-gray-200 mx-auto mt-2"></div>
                                        </div>
                                    </div>
                                </template>

                                <!-- Modelo CORPORATIVO (Recibo Moderno) -->
                                <template x-if="modelo.id === 'modelo_corporativo'">
                                    <div class="bg-white shadow-2xl rounded-lg w-48 h-64 p-4 border-t-4 border-green-600">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="h-2 bg-green-600 rounded w-1/3"></div>
                                            <div class="text-xs text-gray-400">RECIBO</div>
                                        </div>
                                        <div class="bg-gray-100 rounded p-2 mb-3">
                                            <div class="h-1.5 bg-gray-300 rounded w-2/3 mb-1"></div>
                                            <div class="h-1.5 bg-gray-300 rounded w-3/4"></div>
                                        </div>
                                        <div class="space-y-1">
                                            <div class="flex justify-between">
                                                <div class="h-1.5 bg-gray-200 rounded w-1/3"></div>
                                                <div class="h-1.5 bg-gray-300 rounded w-1/4"></div>
                                            </div>
                                            <div class="flex justify-between">
                                                <div class="h-1.5 bg-gray-200 rounded w-1/3"></div>
                                                <div class="h-1.5 bg-gray-300 rounded w-1/4"></div>
                                            </div>
                                            <div class="flex justify-between pt-2 border-t">
                                                <div class="h-2 bg-gray-900 rounded w-1/3"></div>
                                                <div class="h-2 bg-green-600 rounded w-1/4"></div>
                                            </div>
                                        </div>
                                        <div class="mt-4 text-xs text-gray-400 text-center">
                                            <div class="h-1 bg-gray-200 rounded w-full mb-1"></div>
                                            <div class="h-1 bg-gray-200 rounded w-3/4 mx-auto"></div>
                                        </div>
                                    </div>
                                </template>

                                <!-- Modelo MINIMALISTA (Declaração Clean) -->
                                <template x-if="modelo.id === 'modelo_minimalista'">
                                    <div class="bg-white shadow-2xl rounded-lg w-48 h-64 p-6">
                                        <div class="flex items-center space-x-2 mb-4">
                                            <div class="w-6 h-6 border-2 border-gray-400 rounded-full"></div>
                                            <div class="h-1.5 bg-gray-300 rounded w-1/2"></div>
                                        </div>
                                        <div class="space-y-3">
                                            <div class="h-2 bg-gray-900 rounded w-1/2"></div>
                                            <div class="space-y-1.5">
                                                <div class="h-1.5 bg-gray-200 rounded"></div>
                                                <div class="h-1.5 bg-gray-200 rounded w-5/6"></div>
                                                <div class="h-1.5 bg-gray-200 rounded w-4/5"></div>
                                            </div>
                                            <div class="space-y-1.5 pt-2">
                                                <div class="h-1.5 bg-gray-200 rounded"></div>
                                                <div class="h-1.5 bg-gray-200 rounded w-3/4"></div>
                                            </div>
                                        </div>
                                        <div class="absolute bottom-6 left-6 right-6">
                                            <div class="h-px bg-gray-300 mb-2"></div>
                                            <div class="h-1.5 bg-gray-200 rounded w-1/3"></div>
                                        </div>
                                    </div>
                                </template>

                                <!-- Modelo MODERNO (Declaração Arrojada) -->
                                <template x-if="modelo.id === 'modelo_moderno'">
                                    <div class="bg-white shadow-2xl rounded-lg w-48 h-64 overflow-hidden flex">
                                        <div class="w-12 bg-gradient-to-b from-purple-600 to-purple-800"></div>
                                        <div class="flex-1 p-4">
                                            <div class="mb-3">
                                                <div class="h-2 bg-purple-600 rounded w-2/3 mb-2"></div>
                                                <div class="h-1.5 bg-gray-300 rounded w-1/2"></div>
                                            </div>
                                            <div class="space-y-1.5">
                                                <div class="h-1.5 bg-gray-200 rounded"></div>
                                                <div class="h-1.5 bg-gray-200 rounded w-5/6"></div>
                                                <div class="h-1.5 bg-gray-200 rounded w-4/5"></div>
                                                <div class="h-1.5 bg-gray-200 rounded"></div>
                                            </div>
                                            <div class="mt-6">
                                                <div class="h-2 bg-gray-900 rounded w-1/2 mb-1"></div>
                                                <div class="h-1.5 bg-gray-200 rounded w-3/4"></div>
                                            </div>
                                        </div>
                                    </div>
                                </template>

                            </div>
                        </div>

                        <!-- Info do Modelo -->
                        <div class="p-4 bg-white">
                            <div class="flex items-start justify-between mb-2">
                                <div>
                                    <h4 class="font-bold text-gray-800" x-text="modelo.nome"></h4>
                                    <p class="text-xs text-gray-500 mt-1" x-text="modelo.descricao"></p>
                                </div>
                                <span class="px-2 py-1 rounded-full text-xs font-medium"
                                      :class="modelo.categoria === 'recibo' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'"
                                      x-text="modelo.categoria === 'recibo' ? 'Recibo' : 'Declaração'">
                                </span>
                            </div>

                            <!-- Tipos Suportados -->
                            <div class="flex items-center space-x-2 mt-3 text-xs text-gray-500">
                                <i class="bi bi-check-circle text-green-600"></i>
                                <span x-text="modelo.tiposSuportados.includes('declaracao') ? 'Declaração' : ''"></span>
                                <span x-show="modelo.tiposSuportados.includes('recibo')" class="text-gray-300">|</span>
                                <span x-show="modelo.tiposSuportados.includes('recibo')">Recibo (1-3 meses)</span>
                                <span x-show="modelo.tiposSuportados.includes('combo')" class="text-gray-300">|</span>
                                <span x-show="modelo.tiposSuportados.includes('combo')">Combo</span>
                            </div>

                            <!-- Estilo -->
                            <div class="mt-3 pt-3 border-t">
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-500">
                                        <i class="bi bi-palette mr-1"></i>Estilo: 
                                        <span class="font-medium" x-text="modelo.estilo"></span>
                                    </span>
                                    <button class="text-blue-600 hover:text-blue-700 text-sm font-medium group-hover:underline">
                                        Ver Preview <i class="bi bi-arrow-right ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Informação Adicional -->
            <div class="mt-8 bg-blue-50 border-l-4 border-blue-600 p-4 rounded-r-lg">
                <div class="flex items-start">
                    <i class="bi bi-info-circle text-blue-600 text-xl mr-3 mt-0.5"></i>
                    <div>
                        <h5 class="font-bold text-blue-900 mb-1">Como funciona o sistema de documentos?</h5>
                        <ul class="text-sm text-blue-800 space-y-1">
                            <li><strong>Declaração:</strong> 1 página com dados da empresa + cliente (cargo, salário, etc)</li>
                            <li><strong>Recibo:</strong> 1-3 páginas (1 página por mês trabalhado) com detalhes de pagamento</li>
                            <li><strong>Combo:</strong> Declaração + 3 páginas de recibos mensais = 4 páginas totais</li>
                            <li><strong>Marca d'água:</strong> Logo da empresa com opacidade reduzida (discreta e profissional)</li>
                        </ul>
                        <!-- TODO: Melhorias Futuras -->
                        <!-- 
                            - Adicionar campos de cliente: Nome, BI, Cargo, Salário, Data Admissão
                            - Implementar histórico de salários (3 meses) para recibos
                            - Opção de escolher quantos meses de recibo gerar (1, 2 ou 3)
                            - Preview ao vivo com dados reais da empresa + dados fake do cliente
                        -->
                    </div>
                </div>
            </div>

            <!-- Mensagem se não houver modelos -->
            <div x-show="modelos.length === 0" class="text-center py-16 text-gray-500 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
                <i class="bi bi-file-earmark-text text-7xl mb-4 text-gray-300"></i>
                <p class="text-lg font-medium mb-2">Nenhum modelo disponível</p>
                <p class="text-sm text-gray-400">Os modelos pré-definidos serão carregados automaticamente</p>
            </div>
        </div>

        <!-- TAB: Clientes (Todos) -->
        <div x-show="activeTab === 'clientes'" :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold mb-6" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                <i class="bi bi-people mr-2 text-purple-600"></i>Todos os Clientes
            </h2>
            <p :class="darkMode ? 'text-gray-400' : 'text-gray-600'" class="mb-4">Visualização de todos os clientes cadastrados pelos usuários.</p>
            <div class="text-center py-12" :class="darkMode ? 'text-gray-500' : 'text-gray-500'">
                <i class="bi bi-hourglass-split text-6xl mb-4"></i>
                <p>Funcionalidade em desenvolvimento...</p>
            </div>
        </div>

        <!-- TAB: Configurações -->
        <div x-show="activeTab === 'config'" :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold mb-6" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                <i class="bi bi-gear mr-2 text-gray-600"></i>Configurações do Sistema
            </h2>
            
            <div class="space-y-6">
                <div class="border-b pb-4">
                    <h3 class="font-bold text-lg mb-2">Informações do Repositório</h3>
                    <p><strong>Owner:</strong> <span x-text="config.owner"></span></p>
                    <p><strong>Repo:</strong> <span x-text="config.repo"></span></p>
                    <button @click="verificarRepo()" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded">
                        <i class="bi bi-check-circle mr-2"></i>Verificar Conexão
                    </button>
                </div>

                <div class="border-b pb-4">
                    <h3 class="font-bold text-lg mb-2">Sincronização</h3>
                    <button @click="sincronizarDados()" class="bg-green-600 text-white px-4 py-2 rounded">
                        <i class="bi bi-arrow-repeat mr-2"></i>Sincronizar Agora
                    </button>
                </div>

                <div>
                    <h3 class="font-bold text-lg mb-2">Rate Limit GitHub API</h3>
                    <button @click="verificarRateLimit()" class="bg-orange-600 text-white px-4 py-2 rounded">
                        <i class="bi bi-speedometer2 mr-2"></i>Verificar Limite
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- ===================================================================== -->
    <!-- MODAL: PREVIEW DE MODELO (FULL SCREEN) -->
    <!-- ===================================================================== -->
    <div x-show="modalPreviewModelo" 
         x-transition
         class="fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50">
        
        <div :class="darkMode ? 'bg-gray-800' : 'bg-white'" 
             class="w-full h-full overflow-hidden shadow-2xl flex flex-col">
            
            <!-- HEADER -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="bi bi-file-earmark-richtext text-4xl"></i>
                    <div>
                        <h3 class="text-2xl font-bold" x-text="modeloSelecionado?.nome || 'Modelo'"></h3>
                        <p class="text-blue-100 text-sm" x-text="modeloSelecionado?.descricao || ''"></p>
                    </div>
                </div>
                <button @click="fecharModalPreview()" class="text-white hover:text-gray-200 text-4xl">
                    &times;
                </button>
            </div>

            <!-- TABS: Tipo de Documento + Personalização -->
            <div :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'" 
                 class="px-6 py-3 flex items-center space-x-2 border-b">
                <!-- Tabs de Tipo -->
                <button @click="tipoPreview = 'declaracao'"
                        :class="tipoPreview === 'declaracao' ? 'bg-blue-600 text-white' : (darkMode ? 'bg-gray-600 text-gray-200' : 'bg-white text-gray-700 hover:bg-gray-50')"
                        class="px-4 py-2 rounded-lg font-medium transition-colors">
                    <i class="bi bi-file-earmark-text mr-2"></i>Declaração
                </button>
                <button @click="tipoPreview = 'recibo'"
                        :class="tipoPreview === 'recibo' ? 'bg-green-600 text-white' : (darkMode ? 'bg-gray-600 text-gray-200' : 'bg-white text-gray-700 hover:bg-gray-50')"
                        class="px-4 py-2 rounded-lg font-medium transition-colors"
                        x-show="modeloSelecionado?.tiposSuportados.includes('recibo')">
                    <i class="bi bi-receipt mr-2"></i>Recibo
                </button>
                <button @click="tipoPreview = 'combo'"
                        :class="tipoPreview === 'combo' ? 'bg-purple-600 text-white' : (darkMode ? 'bg-gray-600 text-gray-200' : 'bg-white text-gray-700 hover:bg-gray-50')"
                        class="px-4 py-2 rounded-lg font-medium transition-colors"
                        x-show="modeloSelecionado?.tiposSuportados.includes('combo')">
                    <i class="bi bi-journals mr-2"></i>Combo
                </button>
                
                <div class="flex-1"></div>
                
                <!-- Botão de Personalização -->
                <button @click="mostrarPersonalizacao = !mostrarPersonalizacao"
                        :class="mostrarPersonalizacao ? 'bg-purple-600 text-white' : (darkMode ? 'bg-gray-600 text-gray-200' : 'bg-white text-gray-700')"
                        class="px-4 py-2 rounded-lg font-medium transition-colors hover:shadow-lg">
                    <i class="bi bi-palette mr-2"></i>Personalizar
                </button>
                
                <span :class="darkMode ? 'bg-gray-600 text-gray-300' : 'bg-white text-gray-500'" 
                      class="text-xs px-3 py-1 rounded-full">
                    <i class="bi bi-info-circle mr-1"></i>
                    Dados de exemplo
                </span>
            </div>

            <!-- CONTEÚDO: Preview + Painel Lateral -->
            <div class="flex-1 overflow-hidden flex">
                
                <!-- PAINEL DE PERSONALIZAÇÃO (Lateral Direita) -->
                <div x-show="mostrarPersonalizacao" 
                     x-transition
                     :class="darkMode ? 'bg-gray-800 border-gray-600' : 'bg-white border-gray-300'"
                     class="w-80 border-l overflow-y-auto p-6">
                    
                    <h4 :class="darkMode ? 'text-gray-100' : 'text-gray-800'" 
                        class="text-lg font-bold mb-4 flex items-center">
                        <i class="bi bi-sliders text-purple-600 mr-2"></i>
                        Personalização
                    </h4>

                    <!-- SEÇÃO: PRESETS DE ESTILOS -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            <i class="bi bi-palette mr-1"></i>Estilos Rápidos
                        </label>
                        <div class="grid grid-cols-2 gap-2">
                            <button @click="aplicarPreset('formal')"
                                    class="px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg text-xs font-medium transition-colors flex flex-col items-center">
                                <i class="bi bi-mortarboard text-lg mb-1"></i>
                                <span>Formal</span>
                            </button>
                            <button @click="aplicarPreset('moderno')"
                                    class="px-3 py-2 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg text-xs font-medium transition-colors flex flex-col items-center">
                                <i class="bi bi-lightning text-lg mb-1"></i>
                                <span>Moderno</span>
                            </button>
                            <button @click="aplicarPreset('minimalista')"
                                    class="px-3 py-2 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-lg text-xs font-medium transition-colors flex flex-col items-center">
                                <i class="bi bi-dash-circle text-lg mb-1"></i>
                                <span>Minimalista</span>
                            </button>
                            <button @click="aplicarPreset('executivo')"
                                    class="px-3 py-2 bg-green-50 hover:bg-green-100 text-green-700 rounded-lg text-xs font-medium transition-colors flex flex-col items-center">
                                <i class="bi bi-briefcase text-lg mb-1"></i>
                                <span>Executivo</span>
                            </button>
                        </div>
                    </div>

                    <!-- SEÇÃO: GERENCIAR PERSONALIZAÇÕES -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700">
                                <i class="bi bi-save mr-1"></i>Gerenciar Personalizações
                            </label>
                            <div class="flex items-center space-x-2">
                                <label class="text-xs text-gray-600">
                                    <input type="checkbox" x-model="autosaveEnabled" class="mr-1">
                                    Autosave
                                </label>
                            </div>
                        </div>

                        <!-- Slots de Personalização -->
                        <div class="space-y-2 mb-3">
                            <template x-for="i in [1, 2, 3]" :key="i">
                                <div class="flex items-center space-x-2">
                                    <div class="flex-1 px-3 py-2 bg-gray-50 rounded border border-gray-200">
                                        <div class="flex items-center justify-between">
                                            <div class="flex-1">
                                                <template x-if="personalizacoes['slot' + i]">
                                                    <div>
                                                        <p class="text-xs font-medium text-gray-700" x-text="personalizacoes['slot' + i].nome"></p>
                                                        <p class="text-xs text-gray-400" x-text="'Slot ' + i"></p>
                                                    </div>
                                                </template>
                                                <template x-if="!personalizacoes['slot' + i]">
                                                    <p class="text-xs text-gray-400">Slot vazio</p>
                                                </template>
                                            </div>
                                            <div class="flex space-x-1">
                                                <button @click="abrirModalSalvar('slot' + i)"
                                                        class="px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs"
                                                        title="Salvar">
                                                    <i class="bi bi-save"></i>
                                                </button>
                                                <button @click="carregarPersonalizacao('slot' + i)"
                                                        class="px-2 py-1 bg-green-500 hover:bg-green-600 text-white rounded text-xs"
                                                        title="Carregar"
                                                        x-bind:disabled="!personalizacoes['slot' + i]">
                                                    <i class="bi bi-upload"></i>
                                                </button>
                                                <button @click="deletarPersonalizacao('slot' + i)"
                                                        class="px-2 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-xs"
                                                        title="Deletar"
                                                        x-bind:disabled="!personalizacoes['slot' + i]">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- Ações Adicionais -->
                        <div class="grid grid-cols-2 gap-2">
                            <button @click="exportarPersonalizacao()"
                                    class="px-3 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded text-xs font-medium">
                                <i class="bi bi-download mr-1"></i>Exportar JSON
                            </button>
                            <label class="px-3 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded text-xs font-medium text-center cursor-pointer">
                                <i class="bi bi-upload mr-1"></i>Importar JSON
                                <input type="file" accept=".json" @change="importarPersonalizacao($event)" class="hidden">
                            </label>
                        </div>

                        <!-- Última Salvagem -->
                        <template x-if="lastSaved">
                            <p class="text-xs text-gray-400 mt-2 text-center">
                                <i class="bi bi-clock mr-1"></i>
                                Último save: <span x-text="new Date(lastSaved).toLocaleTimeString('pt-AO')"></span>
                            </p>
                        </template>
                    </div>

                    <!-- SEÇÃO: EDIÇÃO DE CONTEÚDO -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            <i class="bi bi-pencil mr-1"></i>Editar Conteúdo
                        </label>
                        
                        <!-- Título do Documento -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">Título do Documento</label>
                            <input type="text" 
                                   x-model="previewConfig.tituloDocumento"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
                                   placeholder="DECLARAÇÃO DE TRABALHO">
                        </div>

                        <!-- Texto Introdutório -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">Texto Introdutório</label>
                            <textarea 
                                x-model="previewConfig.textoIntro"
                                rows="3"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
                                placeholder="Declara-se, para os devidos efeitos..."></textarea>
                        </div>

                        <!-- Alinhamento do Texto -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">Alinhamento do Texto</label>
                            <select x-model="previewConfig.alinhamentoTexto" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                                <option value="left">Esquerda</option>
                                <option value="center">Centro</option>
                                <option value="right">Direita</option>
                                <option value="justify">Justificado</option>
                            </select>
                        </div>

                        <!-- Alinhamento do Cabeçalho -->
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">Alinhamento do Cabeçalho</label>
                            <select x-model="previewConfig.alinhamentoCabecalho" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm">
                                <option value="left">Esquerda</option>
                                <option value="center">Centro</option>
                                <option value="right">Direita</option>
                            </select>
                        </div>
                    </div>

                    <!-- SEÇÃO: CONTROLES AVANÇADOS DO CABEÇALHO -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700">
                                <i class="bi bi-layout-text-window mr-1"></i>Layout do Cabeçalho
                            </label>
                            <button @click="previewConfig.cabecalhoMaxWidth = 450; previewConfig.cabecalhoMarginEntreLogoTexto = 20; previewConfig.cabecalhoJustify = 'space-between'; previewConfig.cabecalhoPaddingBottom = 15; previewConfig.cabecalhoBordaLargura = 4; previewConfig.cabecalhoLogoSize = 80; previewConfig.cabecalhoPaddingHorizontal = 0; previewConfig.cabecalhoLineHeight = 1.4;" 
                                    class="text-xs text-blue-600 hover:text-blue-700">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>

                        <!-- Padding Horizontal do Container -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Espaço Lateral (Logo ↔ Bordas): <span class="font-bold" x-text="previewConfig.cabecalhoPaddingHorizontal + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoPaddingHorizontal" min="0" max="100" step="5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                            <div class="flex justify-between text-xs text-gray-400 mt-1">
                                <span>Sem espaço</span>
                                <span>Muito espaço</span>
                            </div>
                        </div>

                        <!-- Espaço entre Logo e Texto -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Espaço Logo ↔ Texto: <span class="font-bold" x-text="previewConfig.cabecalhoMarginEntreLogoTexto + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoMarginEntreLogoTexto" min="0" max="1000" step="10"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                            <div class="flex justify-between text-xs text-gray-400 mt-1">
                                <span>0px</span>
                                <span>1000px</span>
                            </div>
                        </div>

                        <!-- Line Height do Texto do Cabeçalho -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Espaçamento Entre Linhas: <span class="font-bold" x-text="previewConfig.cabecalhoLineHeight"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoLineHeight" min="1.0" max="2.5" step="0.1"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                            <div class="flex justify-between text-xs text-gray-400 mt-1">
                                <span>Compacto</span>
                                <span>Espaçado</span>
                            </div>
                        </div>

                        <!-- Tamanho do Logo -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Tamanho do Logo: <span class="font-bold" x-text="previewConfig.cabecalhoLogoSize + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoLogoSize" min="50" max="150" step="10"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                        </div>

                        <!-- Padding Inferior -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Espaço Inferior: <span class="font-bold" x-text="previewConfig.cabecalhoPaddingBottom + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoPaddingBottom" min="0" max="40" step="5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                        </div>

                        <!-- Largura da Borda -->
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">
                                Largura da Borda: <span class="font-bold" x-text="previewConfig.cabecalhoBordaLargura + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoBordaLargura" min="0" max="10" step="1"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                        </div>
                    </div>

                    <!-- SEÇÃO: CONTROLES DO CARIMBO -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700">
                                <i class="bi bi-award mr-1"></i>Carimbo e Assinatura
                            </label>
                            <button @click="previewConfig.carimboWidth = 110; previewConfig.carimboHeight = 110;" 
                                    class="text-xs text-blue-600 hover:text-blue-700">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>

                        <!-- Largura do Carimbo -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Largura: <span class="font-bold" x-text="previewConfig.carimboWidth + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.carimboWidth" min="50" max="300" step="5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600">
                            <div class="flex justify-between text-xs text-gray-400 mt-1">
                                <span>50px</span>
                                <span>300px</span>
                            </div>
                        </div>

                        <!-- Altura do Carimbo -->
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">
                                Altura: <span class="font-bold" x-text="previewConfig.carimboHeight + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.carimboHeight" min="50" max="300" step="5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600">
                            <div class="flex justify-between text-xs text-gray-400 mt-1">
                                <span>50px</span>
                                <span>300px</span>
                            </div>
                        </div>
                    </div>

                    <!-- SEÇÃO: ZOOM -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="bi bi-zoom-in mr-1"></i>Zoom: 
                            <span class="font-bold" x-text="previewConfig.zoom + '%'"></span>
                        </label>
                        <input type="range" x-model="previewConfig.zoom" min="50" max="150" step="5"
                               class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
                        <div class="flex justify-between items-center mt-2">
                            <div class="flex space-x-1">
                                <button @click="previewConfig.zoom = 75" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded">75%</button>
                                <button @click="previewConfig.zoom = 100" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded">100%</button>
                                <button @click="previewConfig.zoom = 125" class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded">125%</button>
                            </div>
                        </div>
                    </div>

                    <!-- SEÇÃO: FONTES -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700">
                                <i class="bi bi-fonts mr-1"></i>Tipografia
                            </label>
                            <button @click="resetFontes()" class="text-xs text-blue-600 hover:text-blue-700">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>
                        
                        <!-- Fonte -->
                        <div class="mb-4">
                            <label class="block text-xs text-gray-600 mb-1">Família</label>
                            <select x-model="previewConfig.fontFamily" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-sm">
                                <option value="Times New Roman, serif">Times New Roman</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="Calibri, sans-serif">Calibri</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="Verdana, sans-serif">Verdana</option>
                            </select>
                        </div>
                        
                        <!-- Tamanho Base -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Corpo do Texto: <span class="font-bold" x-text="previewConfig.fontSize + 'pt'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.fontSize" min="10" max="16" step="1"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>

                        <!-- Título Principal -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Título Principal: <span class="font-bold" x-text="previewConfig.tamanhoTitulo + 'pt'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.tamanhoTitulo" min="20" max="36" step="2"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        </div>

                        <!-- Subtítulos -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Subtítulos: <span class="font-bold" x-text="previewConfig.tamanhoSubtitulo + 'pt'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.tamanhoSubtitulo" min="14" max="24" step="1"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        </div>

                        <!-- Dados Empresa -->
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">
                                Dados Empresa: <span class="font-bold" x-text="previewConfig.tamanhoEmpresa + 'pt'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.tamanhoEmpresa" min="8" max="14" step="0.5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        </div>
                    </div>

                    <!-- SEÇÃO: CORES -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700">
                                <i class="bi bi-palette mr-1"></i>Cores
                            </label>
                            <button @click="resetCores()" class="text-xs text-blue-600 hover:text-blue-700">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>
                        
                        <!-- Cor de Destaque -->
                        <div>
                            <label class="block text-xs text-gray-600 mb-2">Cor de Destaque</label>
                            <div class="flex items-center space-x-2">
                                <input type="color" x-model="previewConfig.corDestaque"
                                       class="w-12 h-10 rounded border border-gray-300 cursor-pointer">
                                <input type="text" x-model="previewConfig.corDestaque"
                                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-mono">
                            </div>
                        </div>
                    </div>

                    <!-- SEÇÃO: MARCA D'ÁGUA -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700">
                                <i class="bi bi-droplet mr-1"></i>Marca d'água
                            </label>
                            <button @click="resetMarcaDagua()" class="text-xs text-blue-600 hover:text-blue-700">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>
                        
                        <!-- Opacidade -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Opacidade: <span class="font-bold" x-text="previewConfig.marcaDaguaOpacidade + '%'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.marcaDaguaOpacidade" min="5" max="30" step="5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>

                        <!-- Rotação -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Rotação: <span class="font-bold" x-text="previewConfig.marcaDaguaRotacao + '°'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.marcaDaguaRotacao" min="-45" max="45" step="5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>

                        <!-- Width -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Largura: <span class="font-bold" x-text="previewConfig.marcaDaguaWidth + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.marcaDaguaWidth" min="200" max="600" step="25"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>

                        <!-- Height -->
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">
                                Altura: <span class="font-bold" x-text="previewConfig.marcaDaguaHeight + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.marcaDaguaHeight" min="200" max="600" step="25"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                    </div>

                    <!-- SEÇÃO: ESPAÇAMENTO -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            <i class="bi bi-text-indent-left mr-1"></i>Espaçamento
                        </label>
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">
                                Entre linhas: <span class="font-bold" x-text="previewConfig.espacamentoLinhas.toFixed(1)"></span>
                            </label>
                            <input type="range" x-model.number="previewConfig.espacamentoLinhas" min="1.0" max="2.0" step="0.1"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                    </div>

                    <!-- Botão Resetar Tudo -->
                    <button @click="previewConfig = {
                                fontFamily: 'Times New Roman, serif', 
                                fontSize: 12, 
                                tamanhoTitulo: 28,
                                tamanhoSubtitulo: 18,
                                tamanhoEmpresa: 9,
                                corTexto: '#000000', 
                                corDestaque: '#1e40af', 
                                marcaDaguaOpacidade: 10,
                                marcaDaguaRotacao: -45,
                                marcaDaguaWidth: 400,
                                marcaDaguaHeight: 400,
                                espacamentoLinhas: 1.6,
                                zoom: 100,
                                tituloDocumento: 'DECLARAÇÃO DE TRABALHO',
                                textoIntro: 'Declara-se, para os devidos efeitos, que',
                                alinhamentoTexto: 'justify',
                                alinhamentoCabecalho: 'left',
                                cabecalhoMaxWidth: 450,
                                cabecalhoMarginEntreLogoTexto: 20,
                                cabecalhoJustify: 'space-between',
                                cabecalhoPaddingBottom: 15,
                                cabecalhoBordaLargura: 4,
                                cabecalhoLogoSize: 80,
                                cabecalhoPaddingHorizontal: 0,
                                cabecalhoLineHeight: 1.4,
                                carimboWidth: 110,
                                carimboHeight: 110
                            }"
                            class="w-full px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all text-sm font-medium shadow-lg">
                        <i class="bi bi-arrow-counterclockwise mr-2"></i>Resetar Tudo
                    </button>

                </div>

                <!-- ÁREA DE PREVIEW (Scrollable) -->
                <div :class="darkMode ? 'bg-gray-900' : 'bg-gray-200'" 
                     class="flex-1 overflow-y-auto p-8 flex items-start justify-center">
                    
                    <!-- PREVIEW: DECLARAÇÃO (Modular) -->
                    <template x-if="tipoPreview === 'declaracao'">
                        <div id="preview-render"
                             x-html="renderizarModelo()" 
                             class="w-full max-w-[210mm] transition-transform duration-300"
                             :style="'transform: scale(' + (previewConfig.zoom / 100) + '); transform-origin: top center;'"></div>
                    </template>

                    <!-- PREVIEW: RECIBO (3 MESES) -->
                    <template x-if="tipoPreview === 'recibo'">
                        <div class="text-center py-12 w-full max-w-[210mm]">
                            <i class="bi bi-receipt text-6xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 text-lg font-medium">Preview de Recibo</p>
                            <p class="text-gray-500 text-sm mt-2">Modelo de Recibo em desenvolvimento</p>
                            <p class="text-xs text-gray-400 mt-4">Em breve: Recibo com 1-3 meses de salário</p>
                        </div>
                    </template>

                    <!-- PREVIEW: COMBO (Declaração + 3 Recibos = 4 páginas) -->
                    <template x-if="tipoPreview === 'combo'">
                        <div class="text-center py-12 w-full max-w-[210mm]">
                            <i class="bi bi-journals text-6xl text-gray-400 mb-4"></i>
                            <p class="text-gray-600 text-lg font-medium">Preview do Combo</p>
                            <p class="text-gray-500 text-sm mt-2">1 Declaração + 3 Recibos Mensais = 4 Páginas Totais</p>
                            <p class="text-xs text-gray-400 mt-4">Selecione as abas individualmente para visualizar</p>
                        </div>
                    </template>

                </div>
            
            </div>

            <!-- FOOTER: Ações de PDF -->
            <div :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'" 
                 class="px-6 py-4 flex items-center justify-between border-t">
                <div :class="darkMode ? 'text-gray-300' : 'text-gray-600'" 
                     class="text-sm">
                    <i class="bi bi-lightbulb mr-2 text-yellow-500"></i>
                    <span>Dados de exemplo: 
                        <strong x-text="getEmpresaExemplo().nome"></strong> + 
                        <strong x-text="getClienteExemplo().nome"></strong>
                    </span>
                </div>
                <div class="flex space-x-3">
                    <button @click="fecharModalPreview()" 
                            :class="darkMode ? 'bg-gray-600 text-gray-200 hover:bg-gray-500' : 'bg-gray-300 text-gray-700 hover:bg-gray-400'"
                            class="px-4 py-2 rounded-lg transition-colors">
                        <i class="bi bi-x-circle mr-2"></i>Fechar
                    </button>
                    
                    <!-- Botão: Visualizar em Nova Aba -->
                    <button @click="visualizarPDFNovaAba()" 
                            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors font-medium shadow-md hover:shadow-lg">
                        <i class="bi bi-window mr-2"></i>Nova Aba
                    </button>
                    
                    <!-- Botão: Imprimir -->
                    <button @click="imprimirPDF()" 
                            class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors font-medium shadow-md hover:shadow-lg">
                        <i class="bi bi-printer mr-2"></i>Imprimir
                    </button>
                    
                    <!-- Botão Principal: Baixar PDF -->
                    <button @click="gerarPDF()" 
                            class="px-6 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all font-medium shadow-lg hover:shadow-xl">
                        <i class="bi bi-download mr-2"></i>Baixar PDF
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal: Nova Empresa -->
    <div x-show="modalNovaEmpresa" 
         x-transition
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl max-w-7xl w-full max-h-[95vh] overflow-hidden shadow-2xl flex">
            
            <!-- FORMULÁRIO (Lado Esquerdo) -->
            <div class="w-full lg:w-3/5 overflow-y-auto p-8">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-3xl font-bold text-gray-800">
                        <i class="bi bi-building-add mr-3 text-blue-600"></i>
                        <span x-text="empresaForm.id ? 'Editar Empresa' : 'Nova Empresa'"></span>
                    </h3>
                    <button @click="fecharModalEmpresa()" class="text-gray-400 hover:text-gray-600 text-3xl">
                        &times;
                    </button>
                </div>

                <form @submit.prevent="salvarEmpresa()">
                    
                    <!-- SEÇÃO 1: Identificação -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-gray-700 mb-4 pb-2 border-b-2 border-blue-600">
                            <i class="bi bi-info-circle mr-2"></i>Identificação
                        </h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Nome da Empresa <span class="text-red-500">*</span>
                                </label>
                                <input type="text" 
                                       x-model="empresaForm.nome"
                                       required
                                       placeholder="Ex: EMFC Consulting, S.A."
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    NIF/CC <span class="text-red-500">*</span>
                                </label>
                                <input type="text" 
                                       x-model="empresaForm.nif"
                                       required
                                       placeholder="Ex: 5480023446"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- SEÇÃO 2: Endereço Completo -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-gray-700 mb-4 pb-2 border-b-2 border-green-600">
                            <i class="bi bi-geo-alt mr-2"></i>Endereço da Sede
                        </h4>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Rua/Avenida <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.rua"
                                           required
                                           placeholder="Ex: Avenida 4 de Fevereiro"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Edifício</label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.edificio"
                                           placeholder="Ex: Edifício Summit Tower"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Andar</label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.andar"
                                           placeholder="Ex: 5.º andar"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Sala</label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.sala"
                                           placeholder="Ex: Sala 502"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Bairro <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.bairro"
                                           required
                                           placeholder="Ex: Kinaxixe"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Município <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.municipio"
                                           required
                                           placeholder="Ex: Luanda"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Província <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.provincia"
                                           required
                                           placeholder="Ex: Luanda"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        País <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.pais"
                                           required
                                           placeholder="Ex: Angola"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SEÇÃO 3: Contatos (Opcional) -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-gray-700 mb-4 pb-2 border-b-2 border-purple-600">
                            <i class="bi bi-telephone mr-2"></i>Contatos <span class="text-sm text-gray-500 font-normal">(Opcional)</span>
                        </h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Telefone</label>
                                <input type="tel" 
                                       x-model="empresaForm.telefone"
                                       placeholder="Ex: +244 XXX XXX XXX"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" 
                                       x-model="empresaForm.email"
                                       placeholder="Ex: contato@empresa.ao"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                                <input type="url" 
                                       x-model="empresaForm.website"
                                       placeholder="Ex: www.empresa.ao"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- SEÇÃO 4: Elementos Visuais -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-gray-700 mb-4 pb-2 border-b-2 border-orange-600">
                            <i class="bi bi-image mr-2"></i>Elementos Visuais
                        </h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    URL do Logo <span class="text-red-500">*</span>
                                </label>
                                <input type="url" 
                                       x-model="empresaForm.logo"
                                       @input="validarImagemURL('logo', empresaForm.logo)"
                                       required
                                       placeholder="https://exemplo.com/logo.png"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">Cole o link direto da imagem (PNG, JPG, SVG)</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    URL do Carimbo <span class="text-red-500">*</span>
                                </label>
                                <input type="url" 
                                       x-model="empresaForm.carimbo"
                                       @input="validarImagemURL('carimbo', empresaForm.carimbo)"
                                       required
                                       placeholder="https://exemplo.com/carimbo.png"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">Imagem do carimbo com assinatura (fundo transparente recomendado)</p>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cor Primária</label>
                                    <div class="flex items-center space-x-3">
                                        <input type="color" 
                                               x-model="empresaForm.corPrimaria"
                                               class="h-12 w-20 rounded cursor-pointer">
                                        <input type="text" 
                                               x-model="empresaForm.corPrimaria"
                                               placeholder="#1e40af"
                                               class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cor Secundária</label>
                                    <div class="flex items-center space-x-3">
                                        <input type="color" 
                                               x-model="empresaForm.corSecundaria"
                                               class="h-12 w-20 rounded cursor-pointer">
                                        <input type="text" 
                                               x-model="empresaForm.corSecundaria"
                                               placeholder="#64748b"
                                               class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Marca d'água <span class="text-sm text-gray-500">(Opcional)</span></label>
                                <input type="text" 
                                       x-model="empresaForm.marcaDagua"
                                       placeholder="Ex: CONSULTING, S.A."
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">Texto que aparecerá em diagonal no fundo do documento</p>
                            </div>
                        </div>
                    </div>

                    <!-- BOTÕES -->
                    <div class="flex items-center justify-between pt-6 border-t">
                        <button type="button" 
                                @click="fecharModalEmpresa()"
                                class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                            <i class="bi bi-x-circle mr-2"></i>Cancelar
                        </button>
                        <button type="submit"
                                class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg">
                            <i class="bi bi-check-circle mr-2"></i>
                            <span x-text="empresaForm.id ? 'Salvar Alterações' : 'Cadastrar Empresa'"></span>
                        </button>
                    </div>

                </form>
            </div>

            <!-- PREVIEW (Lado Direito) -->
            <div class="hidden lg:block lg:w-2/5 bg-gradient-to-br from-gray-50 to-gray-100 p-8 overflow-y-auto border-l">
                <h4 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="bi bi-eye mr-2 text-purple-600"></i>Preview
                </h4>

                <!-- Preview Card -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <div class="flex items-start justify-between mb-4">
                        <!-- Logo Preview -->
                        <div class="w-24 h-24 border-2 border-gray-200 rounded-lg flex items-center justify-center bg-gray-50">
                            <img x-show="empresaForm.logo" 
                                 :src="empresaForm.logo" 
                                 alt="Logo"
                                 class="max-w-full max-h-full object-contain"
                                 @error="$el.style.display='none'">
                            <i x-show="!empresaForm.logo" class="bi bi-image text-4xl text-gray-300"></i>
                        </div>
                    </div>

                    <!-- Dados da Empresa -->
                    <div class="space-y-2 mb-4">
                        <h5 class="font-bold text-lg" 
                            :style="'color: ' + (empresaForm.corPrimaria || '#1e40af')"
                            x-text="empresaForm.nome || 'Nome da Empresa'"></h5>
                        <p class="text-sm text-gray-600">
                            <strong>NIF:</strong> <span x-text="empresaForm.nif || 'XXXXXXXXXX'"></span>
                        </p>
                        <p class="text-sm text-gray-600">
                            <strong>Sede:</strong> 
                            <span x-text="empresaForm.endereco.rua || 'Endereço'"></span>
                            <span x-show="empresaForm.endereco.edificio" x-text="', ' + empresaForm.endereco.edificio"></span>
                            <span x-show="empresaForm.endereco.andar" x-text="', ' + empresaForm.endereco.andar"></span>
                            <span x-show="empresaForm.endereco.sala" x-text="', ' + empresaForm.endereco.sala"></span>
                        </p>
                        <p class="text-sm text-gray-600">
                            <span x-text="empresaForm.endereco.bairro || 'Bairro'"></span> — 
                            <span x-text="empresaForm.endereco.municipio || 'Município'"></span>
                        </p>
                        <p class="text-sm text-gray-600">
                            <span x-text="empresaForm.endereco.provincia || 'Província'"></span> — 
                            <span x-text="empresaForm.endereco.pais || 'País'"></span>
                        </p>
                        
                        <div x-show="empresaForm.telefone || empresaForm.email || empresaForm.website" class="pt-2 mt-2 border-t">
                            <p x-show="empresaForm.telefone" class="text-xs text-gray-500">
                                <i class="bi bi-telephone mr-1"></i><span x-text="empresaForm.telefone"></span>
                            </p>
                            <p x-show="empresaForm.email" class="text-xs text-gray-500">
                                <i class="bi bi-envelope mr-1"></i><span x-text="empresaForm.email"></span>
                            </p>
                            <p x-show="empresaForm.website" class="text-xs text-gray-500">
                                <i class="bi bi-globe mr-1"></i><span x-text="empresaForm.website"></span>
                            </p>
                        </div>
                    </div>

                    <!-- Carimbo Preview -->
                    <div class="pt-4 border-t">
                        <p class="text-xs text-gray-500 mb-2 font-medium">Carimbo:</p>
                        <div class="w-24 h-24 border-2 border-gray-200 rounded-lg flex items-center justify-center bg-gray-50">
                            <img x-show="empresaForm.carimbo" 
                                 :src="empresaForm.carimbo" 
                                 alt="Carimbo"
                                 class="max-w-full max-h-full object-contain"
                                 @error="$el.style.display='none'">
                            <i x-show="!empresaForm.carimbo" class="bi bi-stamp text-4xl text-gray-300"></i>
                        </div>
                    </div>

                    <!-- Cores -->
                    <div x-show="empresaForm.corPrimaria || empresaForm.corSecundaria" class="pt-4 border-t mt-4">
                        <p class="text-xs text-gray-500 mb-2 font-medium">Cores:</p>
                        <div class="flex space-x-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded border border-gray-300" 
                                     :style="'background-color: ' + (empresaForm.corPrimaria || '#1e40af')"></div>
                                <span class="text-xs text-gray-600">Primária</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-8 h-8 rounded border border-gray-300" 
                                     :style="'background-color: ' + (empresaForm.corSecundaria || '#64748b')"></div>
                                <span class="text-xs text-gray-600">Secundária</span>
                            </div>
                        </div>
                    </div>

                    <!-- Marca d'água -->
                    <div x-show="empresaForm.marcaDagua" class="pt-4 border-t mt-4">
                        <p class="text-xs text-gray-500 mb-2 font-medium">Marca d'água:</p>
                        <p class="text-2xl font-bold text-gray-200 transform -rotate-45 text-center" 
                           x-text="empresaForm.marcaDagua"></p>
                    </div>
                </div>

                <!-- Dica -->
                <div class="bg-blue-50 border-l-4 border-blue-600 p-4 rounded">
                    <p class="text-sm text-blue-800">
                        <i class="bi bi-lightbulb mr-2"></i>
                        <strong>Dica:</strong> Este preview mostra como sua empresa aparecerá nos documentos PDF gerados.
                    </p>
                </div>
            </div>

        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/github-api.js"></script>
    <script src="js/auth-manager.js"></script>
    <script src="js/user-manager.js"></script>
    <script src="js/notification-system.js"></script>
    <script src="js/image-uploader.js"></script>
    <!-- Modelos de Documentos (Modulares) -->
    <script src="js/modelos/declaracao-executivo.js"></script>
    
    <!-- Controllers -->
    <script src="js/admin-controller.js"></script>
    <!-- MODAL: SALVAR PERSONALIZAÇÃO -->
    <div x-show="modalSalvarPersonalizacao" 
         x-cloak
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6"
             @click.stop>
            
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-gray-800">
                    <i class="bi bi-save mr-2"></i>Salvar Personalização
                </h3>
                <button @click="modalSalvarPersonalizacao = false" 
                        class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="bi bi-x"></i>
                </button>
            </div>

            <p class="text-sm text-gray-600 mb-4">
                Salvando no <strong x-text="'Slot ' + slotSelecionado?.replace('slot', '')"></strong>
            </p>

            <!-- Nome da Personalização -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Nome da Personalização
                </label>
                <input type="text" 
                       x-model="nomePersonalizacaoTemp"
                       @keyup.enter="salvarPersonalizacao(slotSelecionado)"
                       placeholder="Ex: Declaração Formal Azul"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       autofocus>
            </div>

            <!-- Informações -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                <p class="text-xs text-blue-700">
                    <i class="bi bi-info-circle mr-1"></i>
                    Esta personalização será salva localmente no seu navegador e ficará disponível para uso posterior.
                </p>
            </div>

            <!-- Botões -->
            <div class="flex space-x-2">
                <button @click="modalSalvarPersonalizacao = false"
                        class="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors">
                    Cancelar
                </button>
                <button @click="salvarPersonalizacao(slotSelecionado)"
                        class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                    <i class="bi bi-check-lg mr-1"></i>Salvar
                </button>
            </div>
        </div>
    </div>

    <script src="js/dark-mode.js"></script>

    <!-- Inicialização do Sistema de Notificações -->
    <script>
        // Inicializa notificações quando a página carregar
        document.addEventListener('DOMContentLoaded', async () => {
            await notificationSystem.init();
            // Exibe notificações em camadas (timing diferente)
            await notificationSystem.notifyWithLayers();
        });
    </script>

</body>
</html>
