<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Gerador de Declara√ß√µes</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <!-- html2pdf.js - Gera√ß√£o de PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Cropper.js - Editor de Imagens -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" integrity="sha512-hvNR0F/e2J7zPPfLC9auFe3/SE0yG4aJCOd/qxew74NN7eyiSKjr7xJJMu1Jy2wf7FXITpWS1E/RY8yzuXN7VA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js" integrity="sha512-9KkIqdfN7ipEW6B6k+Aq20PV31bjODg4AA52W+tYtAE0jE0kMx49bjJ3FgvS56wzmyfMUHbQ4Km2b7l9+Y/+Eg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Swiper.js - Carross√©is Profissionais -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <!-- jsPDF - Gera√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- CSS Custom -->
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    
    <!-- Anima√ß√µes Personalizadas -->
    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
            opacity: 0;
        }
        
        /* Pulse suave para badges de limite */
        @keyframes pulse-soft {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        /* Smooth transitions globais */
        * {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Scrollbar customizada para √°rea de conte√∫do */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.8);
        }
    </style>
    
    <!-- ‚ö†Ô∏è VERIFICA√á√ÉO CR√çTICA DE SEGURAN√áA - Executada ANTES do Alpine.js carregar -->
    <script>
        // Bloqueia acesso ao painel se n√£o houver token v√°lido
        (function() {
            // ‚úÖ Sistema simplificado: apenas 'token' no localStorage
            const token = localStorage.getItem('token');
            
            if (!token || token.trim() === '') {
                console.warn('üö´ Acesso negado: Token n√£o encontrado');
                console.warn('‚Ü©Ô∏è  Redirecionando para p√°gina de login...');
                window.location.href = 'index.html';
                return;
            }
            
            // Token existe, prosseguir
            console.log('‚úÖ Token encontrado - Carregando painel admin...');
        })();
    </script>
</head>
<body class="transition-colors duration-300" x-data="adminApp()" :class="darkMode ? 'bg-gray-900 text-gray-100' : 'bg-gray-100 text-gray-900'">
    
    <!-- Loading Overlay Profissional -->
    <div x-show="loading" 
         x-transition.opacity
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-[9999]">
        <div class="bg-white rounded-2xl p-8 shadow-2xl max-w-md w-full mx-4">
            <!-- Anima√ß√£o de Upload -->
            <div class="flex flex-col items-center">
                <!-- √çcone Animado -->
                <div class="relative mb-6">
                    <!-- C√≠rculo Externo Girando -->
                    <div class="w-24 h-24 border-4 border-blue-200 rounded-full animate-spin border-t-blue-600"></div>
                    
                    <!-- √çcone Central -->
                    <div class="absolute inset-0 flex items-center justify-center">
                        <template x-if="loadingMessage.includes('upload') || loadingMessage.includes('Upload') || loadingMessage.includes('Enviando')">
                            <i class="bi bi-cloud-upload text-4xl text-blue-600 animate-pulse"></i>
                        </template>
                        <template x-if="loadingMessage.includes('Verificando') || loadingMessage.includes('verificando')">
                            <i class="bi bi-search text-4xl text-blue-600 animate-pulse"></i>
                        </template>
                        <template x-if="loadingMessage.includes('Preparando') || loadingMessage.includes('preparando')">
                            <i class="bi bi-gear text-4xl text-blue-600 animate-spin"></i>
                        </template>
                        <template x-if="!loadingMessage.includes('upload') && !loadingMessage.includes('Upload') && !loadingMessage.includes('Enviando') && !loadingMessage.includes('Verificando') && !loadingMessage.includes('verificando') && !loadingMessage.includes('Preparando') && !loadingMessage.includes('preparando')">
                            <i class="bi bi-hourglass-split text-4xl text-blue-600 animate-pulse"></i>
                        </template>
                    </div>
                </div>
                
                <!-- Mensagem -->
                <p class="text-gray-800 font-semibold text-lg text-center mb-2" x-text="loadingMessage"></p>
                
                <!-- Barra de Progresso (se houver uploadProgress) -->
                <template x-if="uploadProgress !== null && uploadProgress >= 0">
                    <div class="w-full mt-4">
                        <!-- Texto de Progresso -->
                        <div class="flex justify-between text-sm text-gray-600 mb-2">
                            <span>Progresso</span>
                            <span x-text="`${uploadProgress}%`"></span>
                        </div>
                        
                        <!-- Barra -->
                        <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-full rounded-full transition-all duration-300 ease-out"
                                 :style="`width: ${uploadProgress}%`">
                            </div>
                        </div>
                        
                        <!-- Status -->
                        <div class="flex items-center justify-center mt-3 text-sm text-gray-500">
                            <template x-if="uploadProgress < 30">
                                <span>üîÑ Validando arquivo...</span>
                            </template>
                            <template x-if="uploadProgress >= 30 && uploadProgress < 70">
                                <span>üì§ Enviando para GitHub...</span>
                            </template>
                            <template x-if="uploadProgress >= 70 && uploadProgress < 100">
                                <span>‚úçÔ∏è Commitando altera√ß√µes...</span>
                            </template>
                            <template x-if="uploadProgress === 100">
                                <span>‚úÖ Conclu√≠do!</span>
                            </template>
                        </div>
                    </div>
                </template>
                
                <!-- Anima√ß√£o de Pontos -->
                <div class="mt-4 flex space-x-2">
                    <div class="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style="animation-delay: 0s"></div>
                    <div class="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                    <div class="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Header Responsivo -->
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-3 md:py-4">
            <div class="flex items-center justify-between">
                <!-- Logo e t√≠tulo -->
                <div class="flex items-center space-x-2 md:space-x-4">
                    <!-- Menu hamburger (mobile only) -->
                    <button @click="mobileMenuOpen = !mobileMenuOpen" 
                            class="lg:hidden p-2 hover:bg-blue-700 rounded-lg transition-colors">
                        <div class="w-6 h-5 flex flex-col justify-between">
                            <span :class="mobileMenuOpen ? 'rotate-45 translate-y-2' : ''"
                                  class="block h-0.5 w-full bg-white transition-all duration-300"></span>
                            <span :class="mobileMenuOpen ? 'opacity-0' : ''"
                                  class="block h-0.5 w-full bg-white transition-all duration-300"></span>
                            <span :class="mobileMenuOpen ? '-rotate-45 -translate-y-2' : ''"
                                  class="block h-0.5 w-full bg-white transition-all duration-300"></span>
                        </div>
                    </button>
                    
                    <i class="bi bi-shield-check text-2xl md:text-3xl"></i>
                    <div>
                        <h1 class="text-lg md:text-2xl font-bold">Painel Admin</h1>
                        <p class="text-blue-200 text-xs md:text-sm hidden sm:block">Gerador de Declara√ß√µes</p>
                    </div>
                </div>
                
                <!-- A√ß√µes do header (desktop) -->
                <div class="hidden lg:flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-sm text-blue-200">Administrador</p>
                        <p class="font-medium" x-text="usuario ? usuario.login : 'Carregando...'"></p>
                    </div>
                    <img x-show="usuario" :src="usuario?.avatar_url" alt="Avatar" class="w-10 h-10 rounded-full border-2 border-white">
                    <button @click="toggleDarkMode()" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg transition-colors">
                        <i :class="darkMode ? 'bi-sun-fill' : 'bi-moon-fill'" class="mr-2"></i>
                        <span x-text="darkMode ? 'Claro' : 'Escuro'"></span>
                    </button>
                    <button @click="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition-colors">
                        <i class="bi bi-box-arrow-right mr-2"></i>Sair
                    </button>
                </div>
                
                <!-- A√ß√µes mobile (compactas) -->
                <div class="flex lg:hidden items-center space-x-2">
                    <img x-show="usuario" :src="usuario?.avatar_url" alt="Avatar" class="w-8 h-8 rounded-full border-2 border-white">
                    <button @click="toggleDarkMode()" class="p-2 bg-blue-500 hover:bg-blue-600 rounded-lg transition-colors">
                        <i :class="darkMode ? 'bi-sun-fill' : 'bi-moon-fill'"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Menu Mobile Slide-in -->
    <div x-show="mobileMenuOpen" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @click="mobileMenuOpen = false"
         class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 lg:hidden">
    </div>
    
    <nav x-show="mobileMenuOpen"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="-translate-x-full"
         x-transition:enter-end="translate-x-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="translate-x-0"
         x-transition:leave-end="-translate-x-full"
         :class="darkMode ? 'bg-gray-900' : 'bg-white'"
         class="fixed top-0 left-0 h-full w-80 max-w-[85vw] shadow-2xl z-50 lg:hidden overflow-y-auto">
        
        <!-- Header do Menu -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold">Menu</h2>
                <button @click="mobileMenuOpen = false" class="p-2 hover:bg-blue-700 rounded-lg transition-colors">
                    <i class="bi bi-x-lg text-xl"></i>
                </button>
            </div>
            <div class="flex items-center space-x-3">
                <img x-show="usuario" :src="usuario?.avatar_url" alt="Avatar" class="w-12 h-12 rounded-full border-2 border-white">
                <div>
                    <p class="font-medium" x-text="usuario ? usuario.login : 'Carregando...'"></p>
                    <p class="text-blue-200 text-sm">Administrador</p>
                </div>
            </div>
        </div>
        
        <!-- Itens do Menu -->
        <div class="py-4">
            <button @click="activeTab = 'empresas'; mobileMenuOpen = false" 
                    :class="[activeTab === 'empresas' ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-l-4 border-blue-600' : 'text-gray-700 dark:text-gray-300', darkMode ? 'hover:bg-gray-800' : 'hover:bg-gray-50']"
                    class="w-full px-6 py-4 flex items-center space-x-3 transition-colors">
                <i class="bi bi-building text-xl"></i>
                <span class="font-medium">Empresas</span>
            </button>
            
            <button @click="activeTab = 'clientes'; mobileMenuOpen = false" 
                    :class="[activeTab === 'clientes' ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-l-4 border-blue-600' : 'text-gray-700 dark:text-gray-300', darkMode ? 'hover:bg-gray-800' : 'hover:bg-gray-50']"
                    class="w-full px-6 py-4 flex items-center space-x-3 transition-colors">
                <i class="bi bi-people text-xl"></i>
                <span class="font-medium">Clientes</span>
            </button>
            
            <button @click="abrirFluxoGeracao(); mobileMenuOpen = false" 
                    :class="[modalFluxoGeracao ? 'bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 border-l-4 border-purple-600' : 'text-gray-700 dark:text-gray-300', darkMode ? 'hover:bg-gray-800' : 'hover:bg-gray-50']"
                    class="w-full px-6 py-4 flex items-center space-x-3 transition-colors">
                <i class="bi bi-magic text-xl"></i>
                <span class="font-medium">Gerar PDF</span>
            </button>
            
            <a href="users.html"
               :class="darkMode ? 'hover:bg-gray-800 text-gray-300' : 'hover:bg-gray-50 text-gray-700'"
               class="w-full px-6 py-4 flex items-center space-x-3 transition-colors relative">
                <i class="bi bi-person-gear text-xl"></i>
                <span class="font-medium">Usu√°rios</span>
                <span id="users-badge-mobile" class="hidden ml-auto bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center">0</span>
            </a>
            
            <button @click="activeTab = 'config'; mobileMenuOpen = false" 
                    :class="[activeTab === 'config' ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 border-l-4 border-blue-600' : 'text-gray-700 dark:text-gray-300', darkMode ? 'hover:bg-gray-800' : 'hover:bg-gray-50']"
                    class="w-full px-6 py-4 flex items-center space-x-3 transition-colors">
                <i class="bi bi-gear text-xl"></i>
                <span class="font-medium">Configura√ß√µes</span>
            </button>
        </div>
        
        <!-- Footer do Menu -->
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t" :class="darkMode ? 'border-gray-700' : 'border-gray-200'">
            <button @click="logout()" 
                    class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg transition-colors flex items-center justify-center space-x-2">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sair</span>
            </button>
        </div>
    </nav>

    <!-- Alert System - Fixed Position Above Everything -->
    <div x-show="alert.show" 
         x-transition
         class="fixed top-20 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-2xl px-4">
        <div :class="alert.type === 'error' ? 'bg-red-100 border-red-400 text-red-700' : 'bg-green-100 border-green-400 text-green-700'"
             class="border-l-4 p-4 rounded-lg shadow-2xl" role="alert">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i :class="alert.type === 'error' ? 'bi-exclamation-triangle-fill' : 'bi-check-circle-fill'" class="text-xl mr-3"></i>
                    <p x-text="alert.message" class="font-medium"></p>
                </div>
                <button @click="alert.show = false" class="text-2xl font-bold hover:opacity-70 transition-opacity ml-4">&times;</button>
            </div>
        </div>
    </div>

    <!-- Main Content Responsivo -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8">
        
        <!-- Dashboard Stats - Carrossel Responsivo -->
        <div class="mb-6 lg:mb-8">
            <!-- Desktop: Grid normal (lg+) -->
            <div class="hidden lg:grid grid-cols-6 gap-6">
                <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Empresas</p>
                            <p class="text-3xl font-bold text-blue-600" x-text="stats.empresas"></p>
                        </div>
                        <i class="bi bi-building text-4xl text-blue-200"></i>
                    </div>
                </div>

                <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Modelos</p>
                            <p class="text-3xl font-bold text-green-600" x-text="stats.modelos"></p>
                        </div>
                        <i class="bi bi-file-earmark-text text-4xl text-green-200"></i>
                    </div>
                </div>

                <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Users Ativos</p>
                            <p class="text-3xl font-bold text-purple-600" x-text="stats.users"></p>
                        </div>
                        <i class="bi bi-people text-4xl text-purple-200"></i>
                    </div>
                </div>

                <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">PDFs Hoje</p>
                            <p class="text-3xl font-bold text-orange-600" x-text="stats.declaracoesHoje"></p>
                        </div>
                        <i class="bi bi-file-earmark-pdf text-4xl text-orange-200"></i>
                    </div>
                </div>

                <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Total Clientes</p>
                            <p class="text-3xl font-bold text-cyan-600" x-text="stats.totalClientes || 0"></p>
                        </div>
                        <i class="bi bi-briefcase text-4xl text-cyan-200"></i>
                    </div>
                </div>

                <div :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p :class="darkMode ? 'text-gray-400' : 'text-gray-500'" class="text-sm">Total PDFs</p>
                            <p class="text-3xl font-bold text-pink-600" x-text="stats.totalDeclaracoes || 0"></p>
                        </div>
                        <i class="bi bi-graph-up-arrow text-4xl text-pink-200"></i>
                    </div>
                </div>
            </div>

            <!-- Mobile/Tablet: Carrossel Swiper Profissional (at√© lg) -->
            <div class="lg:hidden stats-carousel-wrapper">
                <div class="swiper statsSwiper">
                    <div class="swiper-wrapper">
                        <!-- Slide 1: Empresas -->
                        <div class="swiper-slide">
                            <div :class="darkMode ? 'bg-gradient-to-br from-gray-800 to-gray-900 text-white border-gray-700' : 'bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200'" 
                                 class="stat-card-swiper border">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-10 h-10 rounded-lg bg-blue-500 flex items-center justify-center">
                                            <i class="bi bi-building text-white text-xl"></i>
                                        </div>
                                        <p :class="darkMode ? 'text-gray-300' : 'text-gray-700'" class="text-sm font-medium">Empresas</p>
                                    </div>
                                </div>
                                <p class="text-4xl font-bold text-blue-600 dark:text-blue-400" x-text="stats.empresas"></p>
                                <p :class="darkMode ? 'text-gray-400' : 'text-gray-600'" class="text-xs mt-2">Total cadastradas</p>
                            </div>
                        </div>

                        <!-- Slide 2: Modelos -->
                        <div class="swiper-slide">
                            <div :class="darkMode ? 'bg-gradient-to-br from-gray-800 to-gray-900 text-white border-gray-700' : 'bg-gradient-to-br from-green-50 to-green-100 border-green-200'" 
                                 class="stat-card-swiper border">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-10 h-10 rounded-lg bg-green-500 flex items-center justify-center">
                                            <i class="bi bi-file-earmark-text text-white text-xl"></i>
                                        </div>
                                        <p :class="darkMode ? 'text-gray-300' : 'text-gray-700'" class="text-sm font-medium">Modelos</p>
                                    </div>
                                </div>
                                <p class="text-4xl font-bold text-green-600 dark:text-green-400" x-text="stats.modelos"></p>
                                <p :class="darkMode ? 'text-gray-400' : 'text-gray-600'" class="text-xs mt-2">Templates dispon√≠veis</p>
                            </div>
                        </div>

                        <!-- Slide 3: Users Ativos -->
                        <div class="swiper-slide">
                            <div :class="darkMode ? 'bg-gradient-to-br from-gray-800 to-gray-900 text-white border-gray-700' : 'bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200'" 
                                 class="stat-card-swiper border">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center">
                                            <i class="bi bi-people text-white text-xl"></i>
                                        </div>
                                        <p :class="darkMode ? 'text-gray-300' : 'text-gray-700'" class="text-sm font-medium">Usu√°rios</p>
                                    </div>
                                </div>
                                <p class="text-4xl font-bold text-purple-600 dark:text-purple-400" x-text="stats.users"></p>
                                <p :class="darkMode ? 'text-gray-400' : 'text-gray-600'" class="text-xs mt-2">Ativos no sistema</p>
                            </div>
                        </div>

                        <!-- Slide 4: PDFs Hoje -->
                        <div class="swiper-slide">
                            <div :class="darkMode ? 'bg-gradient-to-br from-gray-800 to-gray-900 text-white border-gray-700' : 'bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200'" 
                                 class="stat-card-swiper border">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-10 h-10 rounded-lg bg-orange-500 flex items-center justify-center">
                                            <i class="bi bi-file-earmark-pdf text-white text-xl"></i>
                                        </div>
                                        <p :class="darkMode ? 'text-gray-300' : 'text-gray-700'" class="text-sm font-medium">PDFs Hoje</p>
                                    </div>
                                </div>
                                <p class="text-4xl font-bold text-orange-600 dark:text-orange-400" x-text="stats.declaracoesHoje"></p>
                                <p :class="darkMode ? 'text-gray-400' : 'text-gray-600'" class="text-xs mt-2">Gerados hoje</p>
                            </div>
                        </div>

                        <!-- Slide 5: Total Clientes -->
                        <div class="swiper-slide">
                            <div :class="darkMode ? 'bg-gradient-to-br from-gray-800 to-gray-900 text-white border-gray-700' : 'bg-gradient-to-br from-cyan-50 to-cyan-100 border-cyan-200'" 
                                 class="stat-card-swiper border">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-10 h-10 rounded-lg bg-cyan-500 flex items-center justify-center">
                                            <i class="bi bi-briefcase text-white text-xl"></i>
                                        </div>
                                        <p :class="darkMode ? 'text-gray-300' : 'text-gray-700'" class="text-sm font-medium">Clientes</p>
                                    </div>
                                </div>
                                <p class="text-4xl font-bold text-cyan-600 dark:text-cyan-400" x-text="stats.totalClientes || 0"></p>
                                <p :class="darkMode ? 'text-gray-400' : 'text-gray-600'" class="text-xs mt-2">Total cadastrados</p>
                            </div>
                        </div>

                        <!-- Slide 6: Total PDFs -->
                        <div class="swiper-slide">
                            <div :class="darkMode ? 'bg-gradient-to-br from-gray-800 to-gray-900 text-white border-gray-700' : 'bg-gradient-to-br from-pink-50 to-pink-100 border-pink-200'" 
                                 class="stat-card-swiper border">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="flex items-center gap-2">
                                        <div class="w-10 h-10 rounded-lg bg-pink-500 flex items-center justify-center">
                                            <i class="bi bi-graph-up-arrow text-white text-xl"></i>
                                        </div>
                                        <p :class="darkMode ? 'text-gray-300' : 'text-gray-700'" class="text-sm font-medium">Total PDFs</p>
                                    </div>
                                </div>
                                <p class="text-4xl font-bold text-pink-600 dark:text-pink-400" x-text="stats.totalDeclaracoes || 0"></p>
                                <p :class="darkMode ? 'text-gray-400' : 'text-gray-600'" class="text-xs mt-2">Gerados no total</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pagina√ß√£o -->
                    <div class="swiper-pagination"></div>
                </div>
                
                <!-- Indicador de scroll para mobile muito pequeno -->
                <div class="stats-scroll-indicator">
                    <i class="bi bi-arrow-left-right"></i>
                    <span>Deslize para ver mais</span>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation - Responsivo -->
        <div :class="darkMode ? 'bg-gray-800' : 'bg-white'" class="rounded-lg shadow-md mb-6">
            <div class="tabs-container flex border-b overflow-x-auto hide-scrollbar" :class="darkMode ? 'border-gray-700' : ''">
                <button @click="activeTab = 'empresas'" 
                        :class="activeTab === 'empresas' ? 'border-blue-600 text-blue-600' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="tab-item flex-shrink-0 px-4 md:px-6 py-3 border-b-2 font-medium transition-colors whitespace-nowrap text-sm md:text-base">
                    <i class="bi bi-building mr-1 md:mr-2"></i><span class="hidden sm:inline">Empresas</span><span class="sm:hidden">Emp.</span>
                </button>
         
                <button @click="activeTab = 'clientes'" 
                        :class="activeTab === 'clientes' ? 'border-blue-600 text-blue-600' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="tab-item flex-shrink-0 px-4 md:px-6 py-3 border-b-2 font-medium transition-colors whitespace-nowrap text-sm md:text-base">
                    <i class="bi bi-people mr-1 md:mr-2"></i><span class="hidden sm:inline">Clientes</span><span class="sm:hidden">Cli.</span>
                </button>
                
                <button @click="activeTab = 'colaboradores'" 
                        :class="activeTab === 'colaboradores' ? 'border-blue-600 text-blue-600' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="tab-item flex-shrink-0 px-4 md:px-6 py-3 border-b-2 font-medium transition-colors whitespace-nowrap text-sm md:text-base">
                    <i class="bi bi-person-plus mr-1 md:mr-2"></i><span class="hidden sm:inline">Colaboradores</span><span class="sm:hidden">Colab.</span>
                </button>
                
                <button @click="activeTab = 'historico'; carregarHistoricoAdmin()" 
                        :class="activeTab === 'historico' ? 'border-blue-600 text-blue-600' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="tab-item flex-shrink-0 px-4 md:px-6 py-3 border-b-2 font-medium transition-colors whitespace-nowrap text-sm md:text-base">
                    <i class="bi bi-clock-history mr-1 md:mr-2"></i><span class="hidden sm:inline">Hist√≥rico</span><span class="sm:hidden">Hist.</span>
                </button>
                
                <button @click="abrirFluxoGeracao()" 
                        :class="modalFluxoGeracao ? 'border-purple-600 text-purple-600 font-bold bg-purple-50 dark:bg-purple-900/20' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="tab-item flex-shrink-0 px-4 md:px-6 py-3 border-b-2 font-medium transition-colors whitespace-nowrap hover:text-purple-500 text-sm md:text-base">
                    <i class="bi bi-magic mr-1 md:mr-2"></i><span class="hidden md:inline">Gerar PDF Profissional</span><span class="md:hidden">Gerar PDF</span>
                </button>
                
                <a href="users.html"
                        :class="darkMode ? 'text-gray-400 hover:text-blue-400' : 'text-gray-600 hover:text-blue-600'"
                        class="tab-item flex-shrink-0 px-4 md:px-6 py-3 border-b-2 border-transparent hover:border-blue-300 font-medium transition-colors relative whitespace-nowrap text-sm md:text-base">
                    <i class="bi bi-person-gear mr-1 md:mr-2"></i><span class="hidden sm:inline">Usu√°rios</span><span class="sm:hidden">Users</span>
                    <!-- Badge de notifica√ß√£o -->
                    <span id="users-badge" class="hidden absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full min-w-[20px] text-center">0</span>
                    <!-- √çcone de notifica√ß√£o pulsante -->
                    <i id="users-notification-icon" class="hidden bi bi-bell-fill text-orange-500 absolute -top-2 -right-2 animate-pulse"></i>
                </a>
                
                <button @click="activeTab = 'config'" 
                        :class="activeTab === 'config' ? 'border-blue-600 text-blue-600' : (darkMode ? 'border-transparent text-gray-400' : 'border-transparent text-gray-600')"
                        class="tab-item flex-shrink-0 px-4 md:px-6 py-3 border-b-2 font-medium transition-colors whitespace-nowrap text-sm md:text-base">
                    <i class="bi bi-gear mr-1 md:mr-2"></i><span class="hidden sm:inline">Configura√ß√µes</span><span class="sm:hidden">Config</span>
                </button>
            </div>
        </div>

        <!-- TAB: Empresas -->
        <div x-show="activeTab === 'empresas'" :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-4 sm:p-6">
            <!-- Header Responsivo -->
            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 sm:mb-8 gap-4">
                <div>
                    <h2 class="text-2xl sm:text-3xl font-bold" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                        <i class="bi bi-building mr-2 sm:mr-3 text-blue-600"></i>Gest√£o de Empresas
                    </h2>
                    <p class="text-xs sm:text-sm text-gray-500 mt-1">
                        <span x-text="empresas.length"></span> empresa<span x-show="empresas.length !== 1">s</span> cadastrada<span x-show="empresas.length !== 1">s</span>
                    </p>
                </div>
                <button @click="modalNovaEmpresa = true" 
                        class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-xl transition-all shadow-lg hover:shadow-xl transform hover:scale-105 text-sm sm:text-base w-full sm:w-auto">
                    <i class="bi bi-plus-circle mr-2"></i>Nova Empresa
                </button>
            </div>

            <!-- Grid de Empresas Responsivo -->
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6">
                <template x-for="(empresa, index) in empresas" :key="empresa.id">
                    <div class="bg-gradient-to-br from-white to-gray-50 border-2 border-gray-200 rounded-xl sm:rounded-2xl overflow-hidden hover:shadow-2xl transition-all duration-300 hover:border-blue-400 hover:-translate-y-1 group animate-fade-in-up"
                         :style="`animation-delay: ${index * 50}ms`">
                        
                        <!-- Header do Card com Gradiente -->
                        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 p-4 sm:p-6 relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-16 -mt-16"></div>
                            <div class="absolute bottom-0 left-0 w-24 h-24 bg-white opacity-10 rounded-full -ml-12 -mb-12"></div>
                            
                            <div class="relative flex items-start justify-between gap-3">
                                <!-- Logo -->
                                <div class="flex-shrink-0">
                                    <template x-if="empresa.logoPreview || empresa.logo">
                                        <div class="w-16 h-16 sm:w-20 sm:h-20 rounded-lg sm:rounded-xl bg-white p-1.5 sm:p-2 shadow-xl border-2 sm:border-4 border-white/30">
                                            <img :src="empresa.logoPreview || empresa.logo" 
                                                 :alt="empresa.nome" 
                                                 class="w-full h-full object-contain">
                                        </div>
                                    </template>
                                    <template x-if="!empresa.logoPreview && !empresa.logo">
                                        <div class="w-16 h-16 sm:w-20 sm:h-20 rounded-lg sm:rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center shadow-xl border-2 border-white/30">
                                            <i class="bi bi-building text-2xl sm:text-3xl text-white"></i>
                                        </div>
                                    </template>
                                </div>

                                <!-- Contador Badge com Indicador de Limite -->
                                <div :class="getContador(empresa.id) >= 3 ? 'bg-red-500/90 border-red-400 ring-2 ring-red-300' : (getContador(empresa.id) === 2 ? 'bg-orange-500/90 border-orange-400' : 'bg-white/20 border-white/30')" 
                                     class="backdrop-blur-md rounded-lg sm:rounded-xl px-3 sm:px-4 py-1.5 sm:py-2 border shadow-lg transition-all duration-300">
                                    <p class="text-xs mb-0.5 sm:mb-1 font-medium" :class="getContador(empresa.id) >= 2 ? 'text-white' : 'text-white/80'">
                                        <span x-show="getContador(empresa.id) >= 3" class="mr-1">‚ö†Ô∏è</span>Docs
                                    </p>
                                    <p class="text-xl sm:text-2xl font-bold" :class="getContador(empresa.id) >= 3 ? 'text-white' : 'text-white'">
                                        <span x-text="getContador(empresa.id)"></span>
                                        <span class="text-xs sm:text-sm" :class="getContador(empresa.id) >= 3 ? 'text-white/90' : 'text-white/70'"> / 3</span>
                                    </p>
                                    <p x-show="getContador(empresa.id) >= 3" class="text-[10px] sm:text-xs text-white/90 mt-1 font-semibold animate-pulse">
                                        LIMITE
                                    </p>
                                </div>
                            </div>

                            <!-- Nome da Empresa -->
                            <h3 class="text-white text-lg sm:text-xl font-bold mt-3 sm:mt-4 mb-1 line-clamp-2" x-text="empresa.nome"></h3>
                            <p class="text-blue-100 text-xs sm:text-sm flex items-center">
                                <i class="bi bi-credit-card mr-1.5 sm:mr-2"></i>
                                NIF: <span x-text="empresa.nif" class="ml-1 font-medium"></span>
                            </p>
                        </div>

                        <!-- Corpo do Card -->
                        <div class="p-4 sm:p-6">
                            <!-- Informa√ß√µes Principais -->
                            <div class="space-y-2.5 sm:space-y-3 mb-3 sm:mb-4">
                                <!-- Endere√ßo -->
                                <div class="flex items-start">
                                    <div class="flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-green-100 flex items-center justify-center mr-2 sm:mr-3">
                                        <i class="bi bi-geo-alt-fill text-green-600 text-sm sm:text-lg"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-xs text-gray-500 mb-0.5 sm:mb-1">Endere√ßo</p>
                                        <p class="text-xs sm:text-sm text-gray-800 font-medium line-clamp-2" x-text="empresa.endereco.rua + ', ' + empresa.endereco.municipio"></p>
                                        <p class="text-xs text-gray-600" x-show="empresa.endereco.bairro" x-text="empresa.endereco.bairro"></p>
                                    </div>
                                </div>

                                <!-- Contatos -->
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-2.5 sm:gap-3">
                                    <div x-show="empresa.telefone" class="flex items-center">
                                        <div class="w-8 h-8 rounded-lg bg-orange-100 flex items-center justify-center mr-2">
                                            <i class="bi bi-telephone-fill text-orange-600 text-sm"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-xs text-gray-500">Telefone</p>
                                            <p class="text-xs sm:text-sm text-gray-800 font-medium truncate" x-text="empresa.telefone"></p>
                                        </div>
                                    </div>
                                    <div x-show="empresa.email" class="flex items-center">
                                        <div class="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center mr-2">
                                            <i class="bi bi-envelope-fill text-purple-600 text-sm"></i>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p class="text-xs text-gray-500">Email</p>
                                            <p class="text-xs sm:text-sm text-gray-800 font-medium truncate" x-text="empresa.email"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Carimbo e Cores -->
                            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 pt-3 sm:pt-4 border-t border-gray-200">
                                <!-- Carimbo -->
                                <div x-show="empresa.carimboPreview || empresa.carimbo" class="flex items-center space-x-2">
                                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-lg border-2 border-gray-200 bg-white p-1 shadow-sm">
                                        <img :src="empresa.carimboPreview || empresa.carimbo" 
                                             :alt="empresa.nome + ' - Carimbo'" 
                                             class="w-full h-full object-contain">
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">Carimbo</p>
                                        <p class="text-xs text-green-600 font-medium"><i class="bi bi-check-circle-fill mr-1"></i>Ativo</p>
                                    </div>
                                </div>

                                <!-- Paleta de Cores -->
                                <div class="flex items-center space-x-2">
                                    <div class="text-left sm:text-right mr-2">
                                        <p class="text-xs text-gray-500">Cores</p>
                                        <p class="text-xs text-gray-600 font-medium hidden sm:block">Identidade</p>
                                    </div>
                                    <div class="flex items-center space-x-1">
                                        <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-lg border-2 border-gray-300 shadow-sm" 
                                             :style="'background-color: ' + empresa.corPrimaria"
                                             :title="'Cor Prim√°ria: ' + empresa.corPrimaria"></div>
                                        <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-lg border-2 border-gray-300 shadow-sm" 
                                             :style="'background-color: ' + empresa.corSecundaria"
                                             :title="'Cor Secund√°ria: ' + empresa.corSecundaria"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bot√µes de A√ß√£o -->
                            <div class="flex items-center gap-2 mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-gray-200">
                                <button @click="editarEmpresa(empresa)" 
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white py-2.5 sm:py-2 px-3 sm:px-4 rounded-lg transition-colors flex items-center justify-center font-medium text-sm sm:text-base touch-manipulation">
                                    <i class="bi bi-pencil-square mr-1.5 sm:mr-2"></i>Editar
                                </button>
                                <button @click="resetarContador(empresa.id)" 
                                        class="bg-orange-100 hover:bg-orange-200 active:bg-orange-300 text-orange-700 p-2.5 sm:p-2 rounded-lg transition-colors touch-manipulation"
                                        title="Resetar contador">
                                    <i class="bi bi-arrow-clockwise text-base sm:text-lg"></i>
                                </button>
                                <button @click="deletarEmpresa(empresa.id)" 
                                        class="bg-red-100 hover:bg-red-200 active:bg-red-300 text-red-700 p-2.5 sm:p-2 rounded-lg transition-colors touch-manipulation"
                                        title="Excluir empresa">
                                    <i class="bi bi-trash text-base sm:text-lg"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Estado Vazio -->
            <div x-show="empresas.length === 0" class="text-center py-20">
                <div class="inline-flex items-center justify-center w-32 h-32 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 mb-6">
                    <i class="bi bi-building text-6xl text-blue-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Nenhuma empresa cadastrada</h3>
                <p class="text-gray-500 mb-6">Comece adicionando sua primeira empresa para gerar documentos profissionais</p>
                <button @click="modalNovaEmpresa = true" 
                        class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-8 py-3 rounded-xl transition-all shadow-lg hover:shadow-xl">
                    <i class="bi bi-plus-circle mr-2"></i>Adicionar Primeira Empresa
                </button>
            </div>
        </div>

        <!-- TAB: Modelos REMOVIDO - C√≥digo migrado para wizard "Gerar PDF Profissional" -->

        <!-- TAB: Clientes (Todos) -->
        <div x-show="activeTab === 'clientes'" :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-4 sm:p-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-3 sm:gap-0">
                <h2 class="text-xl sm:text-2xl font-bold" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                    <i class="bi bi-people mr-2 text-purple-600"></i>Trabalhadores
                </h2>
                <button @click="abrirModalNovoTrabalhador()" 
                        class="bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white px-4 py-2.5 sm:py-2 rounded-lg transition-colors w-full sm:w-auto text-sm sm:text-base touch-manipulation">
                    <i class="bi bi-person-plus mr-2"></i>Novo Trabalhador
                </button>
            </div>

            <!-- Filtros Responsivos -->
            <div class="mb-4 sm:mb-6 flex flex-col sm:flex-row gap-3 sm:gap-4">
                <input type="text" 
                       x-model="filtroTrabalhador"
                       @input="filtrarTrabalhadores()"
                       placeholder="üîç Buscar por nome, NIF, fun√ß√£o..."
                       :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'"
                       class="flex-1 border rounded-lg px-3 sm:px-4 py-2.5 sm:py-2 focus:ring-2 focus:ring-blue-500 text-sm sm:text-base">
                
                <select x-model="filtroDepartamento" 
                        @change="filtrarTrabalhadores()"
                        :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'"
                        class="border rounded-lg px-3 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base">
                    <option value="">Todos os Departamentos</option>
                    <template x-for="dept in departamentos" :key="dept">
                        <option :value="dept" x-text="dept"></option>
                    </template>
                </select>

                <select x-model="filtroStatus" 
                        @change="filtrarTrabalhadores()"
                        :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'"
                        class="border rounded-lg px-3 sm:px-4 py-2.5 sm:py-2 text-sm sm:text-base">
                    <option value="ativos">Apenas Ativos</option>
                    <option value="todos">Todos</option>
                    <option value="inativos">Apenas Inativos</option>
                </select>
            </div>

            <!-- View Desktop: Tabela de Trabalhadores -->
            <div class="hidden md:block overflow-x-auto">
                <table class="w-full">
                    <thead :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Nome</th>
                            <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">NIF</th>
                            <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Fun√ß√£o</th>
                            <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Departamento</th>
                            <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Telefone</th>
                            <th class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider">Status</th>
                            <th class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody :class="darkMode ? 'divide-gray-700' : 'divide-gray-200'" class="divide-y">
                        <template x-for="trabalhador in trabalhadoresFiltrados" :key="trabalhador.id">
                            <tr :class="darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-50'" class="transition-colors">
                                <td class="px-4 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold mr-3">
                                            <span x-text="trabalhador.nome.charAt(0)"></span>
                                        </div>
                                        <div>
                                            <div class="text-sm font-medium" x-text="trabalhador.nome"></div>
                                            <div class="text-xs opacity-60" x-text="trabalhador.email"></div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm" x-text="trabalhador.nif"></td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm" x-text="trabalhador.funcao"></td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm" x-text="trabalhador.departamento"></td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm" x-text="trabalhador.telefone"></td>
                                <td class="px-4 py-4 whitespace-nowrap">
                                    <span x-show="trabalhador.ativo !== false" 
                                          class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                        Ativo
                                    </span>
                                    <span x-show="trabalhador.ativo === false" 
                                          class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                        Inativo
                                    </span>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-right text-sm font-medium">
                                    <button @click="verDetalhesTrabalhador(trabalhador)" 
                                            class="text-blue-600 hover:text-blue-900 mr-3"
                                            title="Ver detalhes">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button @click="editarTrabalhador(trabalhador)" 
                                            class="text-green-600 hover:text-green-900 mr-3"
                                            title="Editar">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button @click="excluirTrabalhador(trabalhador.id)" 
                                            class="text-red-600 hover:text-red-900"
                                            title="Excluir">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <!-- View Mobile: Cards de Trabalhadores -->
            <div class="md:hidden space-y-3">
                <template x-for="trabalhador in trabalhadoresFiltrados" :key="trabalhador.id">
                    <div :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-200'" 
                         class="border rounded-xl p-4 hover:shadow-lg transition-all">
                        
                        <!-- Header do Card -->
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center flex-1 min-w-0">
                                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-bold mr-3 flex-shrink-0">
                                    <span x-text="trabalhador.nome.charAt(0)" class="text-lg"></span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-base font-bold truncate" x-text="trabalhador.nome"></h3>
                                    <p class="text-xs opacity-70 truncate" x-text="trabalhador.email"></p>
                                </div>
                            </div>
                            <span x-show="trabalhador.ativo !== false" 
                                  class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 ml-2 flex-shrink-0">
                                Ativo
                            </span>
                            <span x-show="trabalhador.ativo === false" 
                                  class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 ml-2 flex-shrink-0">
                                Inativo
                            </span>
                        </div>

                        <!-- Info Grid -->
                        <div class="grid grid-cols-2 gap-2 mb-3 text-sm">
                            <div>
                                <p class="text-xs opacity-60 mb-0.5">NIF</p>
                                <p class="font-medium truncate" x-text="trabalhador.nif"></p>
                            </div>
                            <div>
                                <p class="text-xs opacity-60 mb-0.5">Fun√ß√£o</p>
                                <p class="font-medium truncate" x-text="trabalhador.funcao"></p>
                            </div>
                            <div>
                                <p class="text-xs opacity-60 mb-0.5">Departamento</p>
                                <p class="font-medium truncate" x-text="trabalhador.departamento"></p>
                            </div>
                            <div>
                                <p class="text-xs opacity-60 mb-0.5">Telefone</p>
                                <p class="font-medium truncate" x-text="trabalhador.telefone"></p>
                            </div>
                        </div>

                        <!-- Bot√µes de A√ß√£o -->
                        <div class="flex gap-2 pt-3 border-t" :class="darkMode ? 'border-gray-600' : 'border-gray-200'">
                            <button @click="verDetalhesTrabalhador(trabalhador)" 
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white py-2 px-3 rounded-lg transition-colors flex items-center justify-center text-sm touch-manipulation">
                                <i class="bi bi-eye mr-1.5"></i>Ver
                            </button>
                            <button @click="editarTrabalhador(trabalhador)" 
                                    class="flex-1 bg-green-600 hover:bg-green-700 active:bg-green-800 text-white py-2 px-3 rounded-lg transition-colors flex items-center justify-center text-sm touch-manipulation">
                                <i class="bi bi-pencil mr-1.5"></i>Editar
                            </button>
                            <button @click="excluirTrabalhador(trabalhador.id)" 
                                    class="bg-red-600 hover:bg-red-700 active:bg-red-800 text-white py-2 px-3 rounded-lg transition-colors flex items-center justify-center touch-manipulation">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Estado vazio -->
            <div x-show="trabalhadoresFiltrados.length === 0" 
                 class="text-center py-12"
                 :class="darkMode ? 'text-gray-500' : 'text-gray-400'">
                <i class="bi bi-inbox text-6xl mb-4"></i>
                <p>Nenhum trabalhador encontrado</p>
            </div>

            <!-- MODAIS DO TAB CLIENTES -->
            
            <!-- MODAL: NOVO TRABALHADOR -->
            <div x-show="modalNovoTrabalhador" 
                 x-cloak
                 class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 flex items-center justify-between sticky top-0">
                        <h3 class="text-2xl font-bold">
                            <i class="bi bi-person-plus mr-2"></i>Novo Trabalhador
                        </h3>
                        <button @click="modalNovoTrabalhador = false" class="text-white hover:text-gray-200 text-3xl">
                            &times;
                        </button>
                    </div>

                    <div class="p-6">
                        <form @submit.prevent="salvarNovoTrabalhador()">
                            <!-- Dados Pessoais -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">
                                    <i class="bi bi-person mr-2 text-blue-600"></i>Dados Pessoais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome Completo *</label>
                                        <input type="text" x-model="novoTrabalhador.nome" required 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="Jo√£o Pedro Silva">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">NIF *</label>
                                        <input type="text" x-model="novoTrabalhador.nif" required 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="123456789" maxlength="9">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">BI/CC</label>
                                        <input type="text" x-model="novoTrabalhador.documento" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="BA001234567">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Data Nascimento</label>
                                        <input type="text" x-model="novoTrabalhador.data_nascimento" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="DD/MM/AAAA">
                                    </div>
                                </div>
                            </div>

                            <!-- Contato -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">
                                    <i class="bi bi-telephone mr-2 text-green-600"></i>Contato
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                        <input type="tel" x-model="novoTrabalhador.telefone" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="+244 923 456 789">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input type="email" x-model="novoTrabalhador.email" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="joao@email.com">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Morada</label>
                                        <input type="text" x-model="novoTrabalhador.morada" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="Rua da Independ√™ncia, Luanda">
                                    </div>
                                </div>
                            </div>

                            <!-- Dados Profissionais -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">
                                    <i class="bi bi-briefcase mr-2 text-purple-600"></i>Dados Profissionais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Fun√ß√£o/Cargo</label>
                                        <input type="text" x-model="novoTrabalhador.funcao" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="Desenvolvedor Full Stack">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Departamento</label>
                                        <input type="text" x-model="novoTrabalhador.departamento" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="Tecnologia da Informa√ß√£o">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Data Admiss√£o</label>
                                        <input type="text" x-model="novoTrabalhador.data_admissao" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="DD/MM/AAAA">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Contrato</label>
                                        <select x-model="novoTrabalhador.tipo_contrato" 
                                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                            <option value="Contrato sem termo">Contrato sem termo</option>
                                            <option value="Contrato a termo certo">Contrato a termo certo</option>
                                            <option value="Contrato a termo incerto">Contrato a termo incerto</option>
                                            <option value="Est√°gio">Est√°gio</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Dados Salariais -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">
                                    <i class="bi bi-cash mr-2 text-green-600"></i>Dados Salariais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Sal√°rio Bruto (AKZ)</label>
                                        <input type="number" x-model="novoTrabalhador.salario_bruto" step="0.01"
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="250000.00">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Sal√°rio L√≠quido (AKZ)</label>
                                        <input type="number" x-model="novoTrabalhador.salario_liquido" step="0.01"
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="200000.00">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">IBAN</label>
                                        <input type="text" x-model="novoTrabalhador.iban" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="AO06...">
                                    </div>
                                </div>
                            </div>

                            <!-- Bot√µes -->
                            <div class="flex justify-end gap-3 pt-4 border-t">
                                <button type="button" @click="modalNovoTrabalhador = false" 
                                        class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Cancelar
                                </button>
                                <button type="submit" 
                                        class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                    <i class="bi bi-check-lg mr-2"></i>Salvar Trabalhador
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- MODAL: VISUALIZAR TRABALHADOR -->
            <div x-show="modalVisualizarTrabalhador" 
                 x-cloak
                 class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6 flex items-center justify-between sticky top-0">
                        <h3 class="text-2xl font-bold">
                            <i class="bi bi-person-badge mr-2"></i>Detalhes do Trabalhador
                        </h3>
                        <button @click="modalVisualizarTrabalhador = false" class="text-white hover:text-gray-200 text-3xl">
                            &times;
                        </button>
                    </div>

                    <div class="p-6" x-show="visualizarTrabalhador">
                        <div class="space-y-6">
                            <!-- Cabe√ßalho com Avatar -->
                            <div class="flex items-center gap-6 pb-6 border-b">
                                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white text-3xl font-bold">
                                    <span x-text="visualizarTrabalhador?.nome?.charAt(0) || '?'"></span>
                                </div>
                                <div>
                                    <h4 class="text-2xl font-bold text-gray-800" x-text="visualizarTrabalhador?.nome"></h4>
                                    <p class="text-gray-600" x-text="visualizarTrabalhador?.funcao"></p>
                                    <span x-show="visualizarTrabalhador?.ativo !== false" 
                                          class="inline-block mt-2 px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                        Ativo
                                    </span>
                                </div>
                            </div>

                            <!-- Informa√ß√µes -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">NIF</label>
                                    <p class="text-gray-900 font-medium" x-text="visualizarTrabalhador?.nif || '-'"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">BI/CC</label>
                                    <p class="text-gray-900 font-medium" x-text="visualizarTrabalhador?.documento || '-'"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Data Nascimento</label>
                                    <p class="text-gray-900 font-medium" x-text="visualizarTrabalhador?.data_nascimento || '-'"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Telefone</label>
                                    <p class="text-gray-900 font-medium" x-text="visualizarTrabalhador?.telefone || '-'"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Email</label>
                                    <p class="text-gray-900 font-medium" x-text="visualizarTrabalhador?.email || '-'"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Departamento</label>
                                    <p class="text-gray-900 font-medium" x-text="visualizarTrabalhador?.departamento || '-'"></p>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="text-sm font-medium text-gray-500">Morada</label>
                                    <p class="text-gray-900 font-medium" x-text="visualizarTrabalhador?.morada || '-'"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Data Admiss√£o</label>
                                    <p class="text-gray-900 font-medium" x-text="visualizarTrabalhador?.data_admissao || '-'"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Tipo Contrato</label>
                                    <p class="text-gray-900 font-medium" x-text="visualizarTrabalhador?.tipo_contrato || '-'"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Sal√°rio Bruto</label>
                                    <p class="text-gray-900 font-medium" x-text="(visualizarTrabalhador?.salario_bruto || '0') + ' AKZ'"></p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Sal√°rio L√≠quido</label>
                                    <p class="text-gray-900 font-medium" x-text="(visualizarTrabalhador?.salario_liquido || '0') + ' AKZ'"></p>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end gap-3 pt-6 border-t mt-6">
                            <button @click="modalVisualizarTrabalhador = false" 
                                    class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                Fechar
                            </button>
                            <button @click="modalVisualizarTrabalhador = false; editarTrabalhador(visualizarTrabalhador)" 
                                    class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
                                <i class="bi bi-pencil mr-2"></i>Editar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL: EDITAR TRABALHADOR -->
            <div x-show="modalEditarTrabalhador" 
                 x-cloak
                 class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="bg-gradient-to-r from-green-600 to-teal-600 text-white p-6 flex items-center justify-between sticky top-0">
                        <h3 class="text-2xl font-bold">
                            <i class="bi bi-pencil-square mr-2"></i>Editar Trabalhador
                        </h3>
                        <button @click="modalEditarTrabalhador = false" class="text-white hover:text-gray-200 text-3xl">
                            &times;
                        </button>
                    </div>

                    <div class="p-6" x-show="editarTrabalhadorObj">
                        <form @submit.prevent="salvarEdicaoTrabalhador()">
                            <!-- Dados Pessoais -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">
                                    <i class="bi bi-person mr-2 text-blue-600"></i>Dados Pessoais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nome Completo *</label>
                                        <input type="text" x-model="editarTrabalhadorObj.nome" required 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">NIF *</label>
                                        <input type="text" x-model="editarTrabalhadorObj.nif" required 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               maxlength="9">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">BI/CC</label>
                                        <input type="text" x-model="editarTrabalhadorObj.documento" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Data Nascimento</label>
                                        <input type="text" x-model="editarTrabalhadorObj.data_nascimento" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="DD/MM/AAAA">
                                    </div>
                                </div>
                            </div>

                            <!-- Contato -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">
                                    <i class="bi bi-telephone mr-2 text-green-600"></i>Contato
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Telefone</label>
                                        <input type="tel" x-model="editarTrabalhadorObj.telefone" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input type="email" x-model="editarTrabalhadorObj.email" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Morada</label>
                                        <input type="text" x-model="editarTrabalhadorObj.morada" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Dados Profissionais -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">
                                    <i class="bi bi-briefcase mr-2 text-purple-600"></i>Dados Profissionais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Fun√ß√£o/Cargo</label>
                                        <input type="text" x-model="editarTrabalhadorObj.funcao" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Departamento</label>
                                        <input type="text" x-model="editarTrabalhadorObj.departamento" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Data Admiss√£o</label>
                                        <input type="text" x-model="editarTrabalhadorObj.data_admissao" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500"
                                               placeholder="DD/MM/AAAA">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Contrato</label>
                                        <select x-model="editarTrabalhadorObj.tipo_contrato" 
                                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                            <option value="Contrato sem termo">Contrato sem termo</option>
                                            <option value="Contrato a termo certo">Contrato a termo certo</option>
                                            <option value="Contrato a termo incerto">Contrato a termo incerto</option>
                                            <option value="Est√°gio">Est√°gio</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Dados Salariais -->
                            <div class="mb-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">
                                    <i class="bi bi-cash mr-2 text-green-600"></i>Dados Salariais
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Sal√°rio Bruto (AKZ)</label>
                                        <input type="number" x-model="editarTrabalhadorObj.salario_bruto" step="0.01"
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Sal√°rio L√≠quido (AKZ)</label>
                                        <input type="number" x-model="editarTrabalhadorObj.salario_liquido" step="0.01"
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">IBAN</label>
                                        <input type="text" x-model="editarTrabalhadorObj.iban" 
                                               class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Bot√µes -->
                            <div class="flex justify-end gap-3 pt-4 border-t">
                                <button type="button" @click="modalEditarTrabalhador = false" 
                                        class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Cancelar
                                </button>
                                <button type="submit" 
                                        class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                                    <i class="bi bi-check-lg mr-2"></i>Salvar Altera√ß√µes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </div>

        <!-- TAB: Configura√ß√µes -->
        <div x-show="activeTab === 'config'" :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-4 sm:p-6">
            <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                <i class="bi bi-gear mr-2 text-gray-600"></i>Configura√ß√µes do Sistema
            </h2>
            
            <div class="space-y-4 sm:space-y-6">
                <div class="border-b pb-3 sm:pb-4" :class="darkMode ? 'border-gray-700' : 'border-gray-200'">
                    <h3 class="font-bold text-base sm:text-lg mb-2">Informa√ß√µes do Reposit√≥rio</h3>
                    <div class="space-y-1 mb-3 text-sm sm:text-base">
                        <p><strong>Owner:</strong> <span x-text="config.owner" class="break-all"></span></p>
                        <p><strong>Repo:</strong> <span x-text="config.repo" class="break-all"></span></p>
                    </div>
                    <button @click="verificarRepo()" 
                            class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white px-4 py-2.5 sm:py-2 rounded-lg transition-colors text-sm sm:text-base touch-manipulation">
                        <i class="bi bi-check-circle mr-2"></i>Verificar Conex√£o
                    </button>
                </div>

                <div class="border-b pb-3 sm:pb-4" :class="darkMode ? 'border-gray-700' : 'border-gray-200'">
                    <h3 class="font-bold text-base sm:text-lg mb-2">Sincroniza√ß√£o</h3>
                    <button @click="sincronizarDados()" 
                            class="w-full sm:w-auto bg-green-600 hover:bg-green-700 active:bg-green-800 text-white px-4 py-2.5 sm:py-2 rounded-lg transition-colors text-sm sm:text-base touch-manipulation">
                        <i class="bi bi-arrow-repeat mr-2"></i>Sincronizar Agora
                    </button>
                </div>

                <div>
                    <h3 class="font-bold text-base sm:text-lg mb-2">Rate Limit GitHub API</h3>
                    <button @click="verificarRateLimit()" 
                            class="w-full sm:w-auto bg-orange-600 hover:bg-orange-700 active:bg-orange-800 text-white px-4 py-2.5 sm:py-2 rounded-lg transition-colors text-sm sm:text-base touch-manipulation">
                        <i class="bi bi-speedometer2 mr-2"></i>Verificar Limite
                    </button>
                </div>
            </div>
        </div>

        <!-- TAB: Colaboradores e Testes -->
        <div x-show="activeTab === 'colaboradores'" :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'" class="rounded-lg shadow-md p-4 sm:p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl sm:text-2xl font-bold" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                    <i class="bi bi-person-plus mr-2 text-blue-600"></i>Gerenciamento de Colaboradores
                </h2>
                <button @click="modalGuiaTokens = true" 
                        class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm">
                    <i class="bi bi-question-circle mr-1"></i>Guia de Tokens
                </button>
            </div>

            <!-- Se√ß√£o: Adicionar Colaborador -->
            <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'" class="rounded-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <i class="bi bi-person-plus-fill text-blue-600"></i>
                    Adicionar Novo Colaborador
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Username do GitHub:</label>
                        <input type="text" 
                               x-model="novoColaborador.username"
                               placeholder="exemplo: Maicky42"
                               :class="darkMode ? 'bg-gray-600 border-gray-500' : 'bg-white border-gray-300'"
                               class="w-full border rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">N√≠vel de Permiss√£o:</label>
                        <select x-model="novoColaborador.permission"
                                :class="darkMode ? 'bg-gray-600 border-gray-500' : 'bg-white border-gray-300'"
                                class="w-full border rounded-lg px-4 py-2">
                            <option value="push">push - Usu√°rio Normal (Recomendado)</option>
                            <option value="pull">pull - Apenas Leitura</option>
                            <option value="admin">admin - Administrador Total</option>
                        </select>
                    </div>
                </div>

                <div :class="darkMode ? 'bg-blue-900/30' : 'bg-blue-50'" class="p-3 rounded-lg mb-4 text-sm">
                    <p class="font-semibold mb-2">üìã Permiss√µes:</p>
                    <template x-if="novoColaborador.permission === 'push'">
                        <p>‚úÖ Pode ler empresas + Criar/editar SEUS trabalhadores</p>
                    </template>
                    <template x-if="novoColaborador.permission === 'pull'">
                        <p>‚ö†Ô∏è Pode apenas ler empresas (sem editar)</p>
                    </template>
                    <template x-if="novoColaborador.permission === 'admin'">
                        <p class="text-red-600 dark:text-red-400">‚ö†Ô∏è Controle total (cuidado!)</p>
                    </template>
                </div>

                <button @click="adicionarColaborador()" 
                        :disabled="!novoColaborador.username || loadingColab"
                        class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-2 rounded-lg transition-colors">
                    <span x-show="!loadingColab">
                        <i class="bi bi-person-plus mr-2"></i>Adicionar Colaborador
                    </span>
                    <span x-show="loadingColab">
                        <i class="bi bi-hourglass-split animate-spin mr-2"></i>Adicionando...
                    </span>
                </button>
            </div>

            <!-- Se√ß√£o: Testar Colaboradores em Tempo Real -->
            <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'" class="rounded-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold flex items-center gap-2">
                        <i class="bi bi-check2-circle text-purple-600"></i>
                        Testar Colaboradores em Tempo Real
                    </h3>
                    <div class="flex gap-2">
                        <button @click="carregarColaboradores()" 
                                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
                            <i class="bi bi-arrow-clockwise mr-1"></i>Atualizar
                        </button>
                        <button @click="limparLogTestes()" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm">
                            <i class="bi bi-trash mr-1"></i>Limpar Log
                        </button>
                    </div>
                </div>

                <!-- Input de Pesquisa -->
                <div class="mb-4">
                    <div class="relative">
                        <input type="text" 
                               x-model="pesquisaColaborador"
                               placeholder="üîç Pesquisar colaborador por nome ou username..."
                               :class="darkMode ? 'bg-gray-600 border-gray-500 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900'"
                               class="w-full pl-10 pr-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        <i class="bi bi-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                        <span x-text="colaboradoresFiltrados.length"></span> colaborador(es) encontrado(s)
                    </p>
                </div>

                <!-- Loading State -->
                <div x-show="loadingColab" class="text-center py-8">
                    <i class="bi bi-hourglass-split animate-spin text-4xl text-blue-600"></i>
                    <p class="mt-2 text-gray-500 dark:text-gray-400">Carregando colaboradores...</p>
                </div>

                <!-- Grid de Colaboradores -->
                <div x-show="!loadingColab && colaboradoresFiltrados.length > 0" 
                     class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 max-h-96 overflow-y-auto p-1">
                    <template x-for="colab in colaboradoresFiltrados" :key="colab.login">
                        <div :class="darkMode ? 'bg-gray-600' : 'bg-white'" 
                             class="rounded-lg p-4 border-2 shadow-sm hover:shadow-md transition-all"
                             :class="{
                                 'border-yellow-500': colab.permissions.admin,
                                 'border-green-500': colab.permissions.push && !colab.permissions.admin,
                                 'border-blue-500': !colab.permissions.push && !colab.permissions.admin
                             }">
                            <!-- Header com Avatar -->
                            <div class="flex items-start gap-3 mb-3">
                                <img :src="colab.avatar_url" 
                                     :alt="colab.login"
                                     class="w-12 h-12 rounded-full border-2"
                                     :class="{
                                         'border-yellow-400': colab.permissions.admin,
                                         'border-green-400': colab.permissions.push && !colab.permissions.admin,
                                         'border-blue-400': !colab.permissions.push && !colab.permissions.admin
                                     }">
                                <div class="flex-1 min-w-0">
                                    <h4 class="font-semibold truncate" x-text="colab.name || colab.login"></h4>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 truncate" x-text="'@' + colab.login"></p>
                                    <span class="inline-block mt-1 px-2 py-1 rounded text-xs font-semibold"
                                          :class="{
                                              'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200': colab.permissions.admin,
                                              'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200': colab.permissions.push && !colab.permissions.admin,
                                              'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200': !colab.permissions.push && !colab.permissions.admin
                                          }">
                                        <i class="bi" :class="{
                                            'bi-crown-fill': colab.permissions.admin,
                                            'bi-pencil-fill': colab.permissions.push && !colab.permissions.admin,
                                            'bi-eye-fill': !colab.permissions.push && !colab.permissions.admin
                                        }"></i>
                                        <span x-text="colab.permissions.admin ? 'Admin' : (colab.permissions.push ? 'Write' : 'Read')"></span>
                                    </span>
                                </div>
                            </div>

                            <!-- Bot√µes de A√ß√£o -->
                            <div class="flex gap-2">
                                <button @click="testarUsuario(colab.login)" 
                                        class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                    <i class="bi bi-play-circle-fill mr-1"></i>Testar
                                </button>
                                <button @click="abrirPainelColaborador(colab.login)" 
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                                    <i class="bi bi-box-arrow-up-right mr-1"></i>Abrir
                                </button>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Empty State com Pesquisa -->
                <div x-show="!loadingColab && colaboradoresFiltrados.length === 0 && pesquisaColaborador !== ''" 
                     class="text-center py-8">
                    <i class="bi bi-search text-4xl text-gray-400 mb-2"></i>
                    <p class="text-gray-500 dark:text-gray-400">Nenhum colaborador encontrado com "<span class="font-semibold" x-text="pesquisaColaborador"></span>"</p>
                    <button @click="pesquisaColaborador = ''" 
                            class="mt-3 text-purple-600 hover:text-purple-700 text-sm">
                        Limpar pesquisa
                    </button>
                </div>

                <!-- Empty State sem Colaboradores -->
                <div x-show="!loadingColab && colaboradores.length === 0 && pesquisaColaborador === ''" 
                     class="text-center py-8">
                    <i class="bi bi-inbox text-4xl text-gray-400 mb-2"></i>
                    <p class="text-gray-500 dark:text-gray-400">Nenhum colaborador encontrado. Adicione o primeiro colaborador acima.</p>
                </div>

                <!-- Log de Testes Melhorado -->
                <div x-show="logTestes.length > 0" 
                     :class="darkMode ? 'bg-gray-800' : 'bg-gray-900'" 
                     class="mt-4 rounded-lg p-4 font-mono text-xs max-h-80 overflow-y-auto border-2 border-gray-700">
                    <div class="flex items-center justify-between mb-3 pb-2 border-b border-gray-700">
                        <span class="text-gray-400 font-semibold flex items-center gap-2">
                            <i class="bi bi-terminal"></i>LOG DE TESTES
                        </span>
                        <span class="text-gray-500 text-xs" x-text="logTestes.length + ' entrada(s)'"></span>
                    </div>
                    <template x-for="(log, index) in logTestes" :key="index">
                        <div class="mb-1 hover:bg-gray-700 px-2 py-1 rounded transition-colors" :class="{
                            'text-green-400': log.type === 'success',
                            'text-red-400': log.type === 'error',
                            'text-yellow-400': log.type === 'warning',
                            'text-blue-400': log.type === 'info'
                        }">
                            <span class="text-gray-500 text-xs" x-text="log.timestamp"></span> 
                            <span x-text="log.message"></span>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- TAB: Hist√≥rico e Analytics -->
        <div x-show="activeTab === 'historico'" class="space-y-6">
            
            <!-- Estat√≠sticas Resumidas -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm">Total Documentos</p>
                            <p class="text-4xl font-bold" x-text="statsHistoricoAdmin.totalDocumentos"></p>
                        </div>
                        <i class="bi bi-file-earmark-pdf text-5xl text-blue-300"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-md p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm">Declara√ß√µes</p>
                            <p class="text-4xl font-bold" x-text="statsHistoricoAdmin.porTipo.declaracao || 0"></p>
                        </div>
                        <i class="bi bi-file-text text-5xl text-green-300"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-md p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm">Recibos</p>
                            <p class="text-4xl font-bold" x-text="statsHistoricoAdmin.porTipo.recibo || 0"></p>
                        </div>
                        <i class="bi bi-receipt text-5xl text-purple-300"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg shadow-md p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-100 text-sm">Usu√°rios Ativos</p>
                            <p class="text-4xl font-bold" x-text="Object.keys(statsHistoricoAdmin.porUsuario || {}).length"></p>
                        </div>
                        <i class="bi bi-people text-5xl text-orange-300"></i>
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Gr√°fico: Documentos por Dia -->
                <div :class="darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'" 
                     class="rounded-lg shadow-md p-6 border">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="bi bi-graph-up text-blue-600"></i>
                        Documentos por Dia (√öltimos 30 dias)
                    </h3>
                    <canvas id="chartDocumentosPorDiaAdmin" class="w-full" height="250"></canvas>
                </div>

                <!-- Gr√°fico: Tipos de Documentos -->
                <div :class="darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'" 
                     class="rounded-lg shadow-md p-6 border">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="bi bi-pie-chart text-green-600"></i>
                        Distribui√ß√£o por Tipo
                    </h3>
                    <canvas id="chartTiposDocumentosAdmin" class="w-full" height="250"></canvas>
                </div>

                <!-- Gr√°fico: Top Empresas -->
                <div :class="darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'" 
                     class="rounded-lg shadow-md p-6 border">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="bi bi-building text-purple-600"></i>
                        Top 5 Empresas
                    </h3>
                    <canvas id="chartEmpresasAdmin" class="w-full" height="250"></canvas>
                </div>

                <!-- Gr√°fico: Top Usu√°rios -->
                <div :class="darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'" 
                     class="rounded-lg shadow-md p-6 border">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="bi bi-person-circle text-orange-600"></i>
                        Top 5 Usu√°rios
                    </h3>
                    <canvas id="chartUsuariosAdmin" class="w-full" height="250"></canvas>
                </div>
            </div>

            <!-- Tabela de Documentos Recentes -->
            <div :class="darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'" 
                 class="rounded-lg shadow-md border">
                <div class="p-6">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="bi bi-clock-history text-blue-600"></i>
                        Documentos Recentes
                    </h3>
                    
                    <!-- Loading -->
                    <div x-show="loadingHistoricoAdmin" class="text-center py-8">
                        <i class="bi bi-hourglass-split animate-spin text-4xl text-blue-600"></i>
                        <p class="mt-2 text-gray-500">Carregando hist√≥rico...</p>
                    </div>

                    <!-- Tabela -->
                    <div x-show="!loadingHistoricoAdmin" class="overflow-x-auto">
                        <table class="w-full">
                            <thead :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Data</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Tipo</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Empresa</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Trabalhador</th>
                                    <th class="px-4 py-3 text-left text-xs font-semibold uppercase">Usu√°rio</th>
                                </tr>
                            </thead>
                            <tbody :class="darkMode ? 'divide-gray-700' : 'divide-gray-200'" class="divide-y">
                                <template x-for="doc in historicoAdminRecente.slice(0, 10)" :key="doc.id">
                                    <tr :class="darkMode ? 'hover:bg-gray-700' : 'hover:bg-gray-50'" class="transition-colors">
                                        <td class="px-4 py-3 text-sm whitespace-nowrap" x-text="formatarDataSimples(doc.data || doc.created_at)"></td>
                                        <td class="px-4 py-3 text-sm">
                                            <span class="px-2 py-1 rounded-full text-xs font-semibold"
                                                  :class="{
                                                      'bg-green-100 text-green-800': (doc.tipo_documento || doc.tipo) === 'declaracao',
                                                      'bg-blue-100 text-blue-800': (doc.tipo_documento || doc.tipo) === 'recibo',
                                                      'bg-purple-100 text-purple-800': (doc.tipo_documento || doc.tipo) === 'combo'
                                                  }"
                                                  x-text="doc.tipo_documento || doc.tipo || 'N/A'">
                                            </span>
                                        </td>
                                        <td class="px-4 py-3 text-sm" x-text="doc.dados_documento?.empresa_nome || doc.empresa_nome || 'N/A'"></td>
                                        <td class="px-4 py-3 text-sm" x-text="doc.dados_documento?.trabalhador_nome || doc.trabalhador_nome || 'N/A'"></td>
                                        <td class="px-4 py-3 text-sm">
                                            <span class="font-semibold" x-text="'@' + (doc.usuario || doc.criado_por || 'N/A')"></span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        
                        <div x-show="historicoAdminRecente.length === 0" class="text-center py-8">
                            <i class="bi bi-inbox text-4xl text-gray-400"></i>
                            <p class="mt-2 text-gray-500">Nenhum documento encontrado no hist√≥rico</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- ===================================================================== -->
    <!-- MODAL: GUIA DE TOKENS (Educacional)                                  -->
    <!-- ===================================================================== -->
    <div x-show="modalGuiaTokens" 
         x-cloak
         @click.self="modalGuiaTokens = false"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
        <div :class="darkMode ? 'bg-gray-800' : 'bg-white'" 
             class="rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            
            <!-- Header -->
            <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-6 sticky top-0 z-10">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="bi bi-key-fill text-3xl"></i>
                        <div>
                            <h3 class="text-2xl font-bold">Guia Completo de Tokens GitHub</h3>
                            <p class="text-purple-100 text-sm">Como criar e configurar tokens para o sistema</p>
                        </div>
                    </div>
                    <button @click="modalGuiaTokens = false" class="text-white hover:text-gray-200 text-3xl">
                        &times;
                    </button>
                </div>
            </div>

            <!-- Conte√∫do -->
            <div class="p-6 space-y-6">
                
                <!-- Introdu√ß√£o -->
                <div :class="darkMode ? 'bg-blue-900/30 border-blue-700' : 'bg-blue-50 border-blue-200'" 
                     class="border-l-4 p-4 rounded-r-lg">
                    <h4 class="font-bold text-lg mb-2 flex items-center gap-2">
                        <i class="bi bi-info-circle-fill text-blue-600"></i>
                        O que √© um Token GitHub?
                    </h4>
                    <p :class="darkMode ? 'text-gray-300' : 'text-gray-700'">
                        Um <strong>Personal Access Token (PAT)</strong> √© como uma senha especial que d√° acesso ao sistema. 
                        Cada usu√°rio precisa do seu pr√≥prio token para acessar e gerenciar seus trabalhadores.
                    </p>
                </div>

                <!-- Passo a Passo -->
                <div>
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="bi bi-list-ol text-green-600"></i>
                        Como Criar um Token (Passo a Passo)
                    </h4>

                    <!-- Passo 1 -->
                    <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'" class="rounded-lg p-4 mb-3">
                        <div class="flex items-start gap-3">
                            <span class="bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">1</span>
                            <div class="flex-1">
                                <h5 class="font-semibold mb-2">Acesse a p√°gina de Tokens do GitHub</h5>
                                <p :class="darkMode ? 'text-gray-300' : 'text-gray-600'" class="text-sm mb-2">
                                    Abra esta URL no seu navegador:
                                </p>
                                <a href="https://github.com/settings/tokens/new" target="_blank"
                                   class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                    <i class="bi bi-box-arrow-up-right"></i>
                                    https://github.com/settings/tokens/new
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Passo 2 -->
                    <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'" class="rounded-lg p-4 mb-3">
                        <div class="flex items-start gap-3">
                            <span class="bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">2</span>
                            <div class="flex-1">
                                <h5 class="font-semibold mb-2">Preencha os dados b√°sicos</h5>
                                <ul :class="darkMode ? 'text-gray-300' : 'text-gray-600'" class="text-sm space-y-2 ml-4">
                                    <li><strong>Note (descri√ß√£o):</strong> "Gerador PDF - User Token"</li>
                                    <li><strong>Expiration:</strong> 90 days (3 meses)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Passo 3 -->
                    <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'" class="rounded-lg p-4 mb-3">
                        <div class="flex items-start gap-3">
                            <span class="bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">3</span>
                            <div class="flex-1">
                                <h5 class="font-semibold mb-2">Selecione as Permiss√µes Corretas</h5>
                                <p :class="darkMode ? 'text-gray-300' : 'text-gray-600'" class="text-sm mb-3">
                                    <strong>‚ö†Ô∏è IMPORTANTE:</strong> Marque apenas estas op√ß√µes:
                                </p>
                                <div :class="darkMode ? 'bg-gray-800 border-gray-600' : 'bg-white border-gray-300'" 
                                     class="border-2 rounded-lg p-3 space-y-2">
                                    <div class="flex items-center gap-2">
                                        <i class="bi bi-check-square-fill text-green-600"></i>
                                        <code class="bg-purple-100 dark:bg-purple-900 px-2 py-1 rounded text-sm">repo</code>
                                        <span class="text-sm">- Controle total de reposit√≥rios</span>
                                    </div>
                                    <p class="text-xs ml-8 text-gray-500">
                                        Ou se o reposit√≥rio for p√∫blico, apenas:
                                    </p>
                                    <div class="flex items-center gap-2 ml-8">
                                        <i class="bi bi-check-square text-blue-600"></i>
                                        <code class="bg-blue-100 dark:bg-blue-900 px-2 py-1 rounded text-sm">public_repo</code>
                                        <span class="text-sm">- Acesso a reposit√≥rios p√∫blicos</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Passo 4 -->
                    <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'" class="rounded-lg p-4 mb-3">
                        <div class="flex items-start gap-3">
                            <span class="bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">4</span>
                            <div class="flex-1">
                                <h5 class="font-semibold mb-2">Gerar e Copiar o Token</h5>
                                <p :class="darkMode ? 'text-gray-300' : 'text-gray-600'" class="text-sm mb-2">
                                    1. Clique no bot√£o verde <strong>"Generate token"</strong><br>
                                    2. <strong>‚ö†Ô∏è COPIE O TOKEN IMEDIATAMENTE!</strong> (s√≥ aparece uma vez)<br>
                                    3. Token come√ßa com <code class="bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded">ghp_...</code>
                                </p>
                                <div class="bg-yellow-100 dark:bg-yellow-900/30 border-l-4 border-yellow-500 p-3 rounded-r text-sm mt-2">
                                    <strong>üí° Dica:</strong> Guarde o token em um local seguro (gestor de senhas)
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Passo 5 -->
                    <div :class="darkMode ? 'bg-gray-700' : 'bg-gray-50'" class="rounded-lg p-4">
                        <div class="flex items-start gap-3">
                            <span class="bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">5</span>
                            <div class="flex-1">
                                <h5 class="font-semibold mb-2">Usar o Token no Sistema</h5>
                                <p :class="darkMode ? 'text-gray-300' : 'text-gray-600'" class="text-sm mb-2">
                                    1. Abra <strong>index.html</strong> (p√°gina de login)<br>
                                    2. Cole o token quando solicitado<br>
                                    3. O sistema salva automaticamente no navegador
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compara√ß√£o de Permiss√µes -->
                <div>
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="bi bi-table text-purple-600"></i>
                        O que cada Permiss√£o Permite
                    </h4>
                    <div class="overflow-x-auto">
                        <table :class="darkMode ? 'bg-gray-700' : 'bg-white'" class="w-full text-sm">
                            <thead :class="darkMode ? 'bg-gray-600' : 'bg-gray-100'">
                                <tr>
                                    <th class="px-4 py-2 text-left">Funcionalidade</th>
                                    <th class="px-4 py-2 text-center">User (push)</th>
                                    <th class="px-4 py-2 text-center">Admin</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr :class="darkMode ? 'border-gray-600' : 'border-gray-200'" class="border-b">
                                    <td class="px-4 py-2">Ver empresas</td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                </tr>
                                <tr :class="darkMode ? 'border-gray-600' : 'border-gray-200'" class="border-b">
                                    <td class="px-4 py-2">Ver SEUS trabalhadores</td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                </tr>
                                <tr :class="darkMode ? 'border-gray-600' : 'border-gray-200'" class="border-b">
                                    <td class="px-4 py-2">Adicionar/Editar seus trabalhadores</td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                </tr>
                                <tr :class="darkMode ? 'border-gray-600' : 'border-gray-200'" class="border-b">
                                    <td class="px-4 py-2">Gerar PDFs</td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                </tr>
                                <tr :class="darkMode ? 'border-gray-600' : 'border-gray-200'" class="border-b">
                                    <td class="px-4 py-2">Ver trabalhadores de outros</td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-x-circle-fill text-red-600"></i></td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                </tr>
                                <tr :class="darkMode ? 'border-gray-600' : 'border-gray-200'" class="border-b">
                                    <td class="px-4 py-2">Criar/Editar empresas</td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-x-circle-fill text-red-600"></i></td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                </tr>
                                <tr>
                                    <td class="px-4 py-2">Adicionar colaboradores</td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-x-circle-fill text-red-600"></i></td>
                                    <td class="px-4 py-2 text-center"><i class="bi bi-check-circle-fill text-green-600"></i></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Problemas Comuns -->
                <div>
                    <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="bi bi-exclamation-triangle text-red-600"></i>
                        Problemas Comuns e Solu√ß√µes
                    </h4>
                    
                    <div class="space-y-3">
                        <!-- Erro 403 -->
                        <div :class="darkMode ? 'bg-red-900/30 border-red-700' : 'bg-red-50 border-red-200'" 
                             class="border-l-4 p-4 rounded-r-lg">
                            <h5 class="font-semibold mb-1">‚ùå Erro "403 Forbidden"</h5>
                            <p class="text-sm mb-2"><strong>Causa:</strong> Token sem permiss√µes necess√°rias</p>
                            <p class="text-sm"><strong>Solu√ß√£o:</strong> Crie novo token com permiss√£o <code>repo</code> ou <code>public_repo</code></p>
                        </div>

                        <!-- Erro 401 -->
                        <div :class="darkMode ? 'bg-red-900/30 border-red-700' : 'bg-red-50 border-red-200'" 
                             class="border-l-4 p-4 rounded-r-lg">
                            <h5 class="font-semibold mb-1">‚ùå Erro "401 Unauthorized"</h5>
                            <p class="text-sm mb-2"><strong>Causa:</strong> Token expirou ou est√° inv√°lido</p>
                            <p class="text-sm"><strong>Solu√ß√£o:</strong> Gere um novo token e atualize no sistema</p>
                        </div>

                        <!-- Erro 404 -->
                        <div :class="darkMode ? 'bg-red-900/30 border-red-700' : 'bg-red-50 border-red-200'" 
                             class="border-l-4 p-4 rounded-r-lg">
                            <h5 class="font-semibold mb-1">‚ùå Erro "404 Not Found"</h5>
                            <p class="text-sm mb-2"><strong>Causa:</strong> Ainda n√£o foi adicionado como colaborador</p>
                            <p class="text-sm"><strong>Solu√ß√£o:</strong> Aguarde o admin adicionar voc√™, depois aceite o convite por email</p>
                        </div>
                    </div>
                </div>

                <!-- Seguran√ßa -->
                <div :class="darkMode ? 'bg-yellow-900/30 border-yellow-700' : 'bg-yellow-50 border-yellow-400'" 
                     class="border-l-4 p-4 rounded-r-lg">
                    <h4 class="font-bold text-lg mb-2 flex items-center gap-2">
                        <i class="bi bi-shield-lock text-yellow-600"></i>
                        ‚ö†Ô∏è Regras de Seguran√ßa
                    </h4>
                    <ul class="text-sm space-y-1 ml-4 list-disc">
                        <li><strong>NUNCA</strong> compartilhe seu token com outras pessoas</li>
                        <li><strong>NUNCA</strong> poste o token em chats, emails ou redes sociais</li>
                        <li><strong>SEMPRE</strong> revogue tokens suspeitos imediatamente</li>
                        <li><strong>SEMPRE</strong> use gestores de senha para guardar tokens</li>
                    </ul>
                </div>

            </div>

            <!-- Footer -->
            <div :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-50 border-gray-200'" 
                 class="border-t p-4 flex justify-end gap-3">
                <button @click="modalGuiaTokens = false" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                    Entendi!
                </button>
            </div>
        </div>
    </div>

    <!-- ===================================================================== -->
    <!-- MODAL: AVISO DE LIMITE DE DECLARA√á√ïES -->
    <!-- ===================================================================== -->
    <div x-show="modalLimiteEmpresa" 
         x-transition
         @click.self="modalLimiteEmpresa = false"
         class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4">
        <div @click.stop 
             :class="darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'"
             class="rounded-2xl max-w-md w-full border-2 shadow-2xl overflow-hidden transform transition-all">
            
            <!-- Header com Gradiente de Alerta -->
            <div class="bg-gradient-to-r from-orange-500 to-red-600 p-6 text-center">
                <div class="w-20 h-20 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                    <i class="bi bi-exclamation-triangle-fill text-white text-4xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">
                    Limite Atingido!
                </h3>
                <p class="text-white/90 text-sm">
                    Esta empresa j√° atingiu o limite de documentos
                </p>
            </div>

            <!-- Corpo -->
            <div class="p-6">
                <!-- Informa√ß√µes da Empresa -->
                <div :class="darkMode ? 'bg-gray-700/50 border-gray-600' : 'bg-orange-50 border-orange-200'" 
                     class="rounded-xl p-4 mb-6 border-2">
                    <div class="flex items-start gap-3">
                        <div class="flex-shrink-0 w-12 h-12 bg-orange-500 rounded-lg flex items-center justify-center">
                            <i class="bi bi-building text-white text-xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p :class="darkMode ? 'text-gray-300' : 'text-gray-700'" class="text-sm font-medium mb-1">Empresa</p>
                            <p class="font-bold text-lg truncate" :class="darkMode ? 'text-white' : 'text-gray-900'" x-text="empresaLimiteAtingido?.nome"></p>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="inline-flex items-center px-2 py-1 rounded-md bg-red-100 text-red-700 text-xs font-semibold">
                                    <i class="bi bi-file-earmark-text mr-1"></i>
                                    <span x-text="getContador(empresaLimiteAtingido?.id)"></span> / 3 Documentos
                                </span>
                                <span class="inline-flex items-center px-2 py-1 rounded-md bg-orange-100 text-orange-700 text-xs font-semibold animate-pulse">
                                    ‚ö†Ô∏è LIMITE
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mensagem -->
                <div :class="darkMode ? 'text-gray-300' : 'text-gray-700'" class="mb-6 text-center">
                    <p class="text-base leading-relaxed">
                        A empresa <strong x-text="empresaLimiteAtingido?.nome"></strong> j√° gerou 
                        <strong class="text-orange-600">3 declara√ß√µes</strong> (limite m√°ximo).
                    </p>
                    <p class="text-sm mt-2" :class="darkMode ? 'text-gray-400' : 'text-gray-600'">
                        Deseja continuar mesmo assim ou selecionar outra empresa?
                    </p>
                </div>

                <!-- Bot√µes de A√ß√£o -->
                <div class="flex flex-col sm:flex-row gap-3">
                    <button @click="cancelarEmpresaComLimite()" 
                            :class="darkMode ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'"
                            class="flex-1 px-6 py-3.5 rounded-xl font-semibold transition-all duration-300 flex items-center justify-center gap-2 group">
                        <i class="bi bi-arrow-left-circle group-hover:-translate-x-1 transition-transform"></i>
                        <span>Selecionar Outra</span>
                    </button>
                    <button @click="confirmarEmpresaComLimite()" 
                            class="flex-1 px-6 py-3.5 rounded-xl font-semibold transition-all duration-300 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white shadow-lg hover:shadow-xl flex items-center justify-center gap-2 group">
                        <i class="bi bi-check-circle group-hover:scale-110 transition-transform"></i>
                        <span>Continuar Assim</span>
                    </button>
                </div>

                <!-- Aviso Extra -->
                <div :class="darkMode ? 'bg-gray-700/30 border-gray-600' : 'bg-blue-50 border-blue-200'" 
                     class="mt-4 p-3 rounded-lg border text-xs" :class="darkMode ? 'text-gray-400' : 'text-blue-700'">
                    <i class="bi bi-info-circle mr-1"></i>
                    <span>Voc√™ pode resetar o contador no card da empresa para liberar novas gera√ß√µes.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ===================================================================== -->
    <!-- MODAL: FLUXO DE GERA√á√ÉO DE DOCUMENTO (Tela Cheia 100vh) - RESPONSIVO -->
    <!-- ===================================================================== -->
    <div x-show="modalFluxoGeracao" 
         x-transition
         :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white'"
         class="fixed inset-0 z-50 flex flex-col overflow-hidden">
            
            <!-- Header Responsivo -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 sm:p-6 flex items-center justify-between">
                <div class="flex-1 min-w-0 mr-3">
                    <h3 class="text-lg sm:text-2xl font-bold truncate">
                        <i class="bi bi-magic mr-1.5 sm:mr-2"></i>Gerar Documento
                    </h3>
                    <p class="text-blue-100 text-xs sm:text-sm mt-0.5 sm:mt-1">
                        Passo <span x-text="fluxoEtapa"></span> de 4: 
                        <span x-show="fluxoEtapa === 1">Empresa</span>
                        <span x-show="fluxoEtapa === 2">Cliente</span>
                        <span x-show="fluxoEtapa === 3">Tipo</span>
                        <span x-show="fluxoEtapa === 4">Preview</span>
                    </p>
                </div>
                <button @click="fecharFluxoGeracao()" 
                        class="text-white hover:text-gray-200 text-3xl sm:text-4xl flex-shrink-0 w-10 h-10 flex items-center justify-center touch-manipulation">
                    &times;
                </button>
            </div>

            <!-- Progresso Responsivo -->
            <div class="bg-gray-100 dark:bg-gray-700 px-3 sm:px-6 py-2 sm:py-3">
                <div class="flex items-center justify-between text-xs sm:text-sm">
                    <!-- Empresa -->
                    <div class="flex flex-col sm:flex-row items-center space-y-0.5 sm:space-y-0 sm:space-x-2" 
                         :class="fluxoEtapa >= 1 ? 'text-blue-600 font-bold' : 'text-gray-400'">
                        <i class="bi bi-building text-base sm:text-lg"></i>
                        <span class="hidden sm:inline">Empresa</span>
                    </div>
                    <div class="flex-1 h-0.5 sm:h-1 mx-1 sm:mx-2 rounded" :class="fluxoEtapa >= 2 ? 'bg-blue-600' : 'bg-gray-300'"></div>
                    
                    <!-- Cliente -->
                    <div class="flex flex-col sm:flex-row items-center space-y-0.5 sm:space-y-0 sm:space-x-2" 
                         :class="fluxoEtapa >= 2 ? 'text-blue-600 font-bold' : 'text-gray-400'">
                        <i class="bi bi-person text-base sm:text-lg"></i>
                        <span class="hidden sm:inline">Cliente</span>
                    </div>
                    <div class="flex-1 h-0.5 sm:h-1 mx-1 sm:mx-2 rounded" :class="fluxoEtapa >= 3 ? 'bg-blue-600' : 'bg-gray-300'"></div>
                    
                    <!-- Tipo -->
                    <div class="flex flex-col sm:flex-row items-center space-y-0.5 sm:space-y-0 sm:space-x-2" 
                         :class="fluxoEtapa >= 3 ? 'text-blue-600 font-bold' : 'text-gray-400'">
                        <i class="bi bi-file-earmark-text text-base sm:text-lg"></i>
                        <span class="hidden sm:inline">Tipo</span>
                    </div>
                    <div class="flex-1 h-0.5 sm:h-1 mx-1 sm:mx-2 rounded" :class="fluxoEtapa >= 4 ? 'bg-blue-600' : 'bg-gray-300'"></div>
                    
                    <!-- Preview -->
                    <div class="flex flex-col sm:flex-row items-center space-y-0.5 sm:space-y-0 sm:space-x-2" 
                         :class="fluxoEtapa >= 4 ? 'text-blue-600 font-bold' : 'text-gray-400'">
                        <i class="bi bi-eye text-base sm:text-lg"></i>
                        <span class="hidden sm:inline">Preview</span>
                    </div>
                </div>
            </div>

            <!-- Conte√∫do Scrollable Responsivo -->
            <div class="flex-1 overflow-y-auto p-4 sm:p-6">
                
                <!-- ETAPA 1: Selecionar Empresa -->
                <div x-show="fluxoEtapa === 1" class="space-y-3 sm:space-y-4">
                    <h4 class="text-base sm:text-lg md:text-xl font-bold mb-3 sm:mb-4">Selecione a Empresa:</h4>
                    
                    <!-- Busca Responsiva -->
                    <input type="text" 
                           x-model="fluxoBuscaEmpresa"
                           placeholder="üîç Buscar empresa..."
                           :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'"
                           class="w-full border rounded-lg px-3 sm:px-4 py-2.5 sm:py-3 md:py-4 mb-3 sm:mb-4 focus:ring-2 focus:ring-blue-500 text-sm sm:text-base md:text-lg">
                    
                    <!-- Lista de Empresas - Grid Responsivo -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">
                        <template x-for="empresa in empresasFiltradas" :key="empresa.id">
                            <div @click="selecionarEmpresa(empresa)"
                                 :class="fluxoEmpresaSelecionada?.id === empresa.id ? 'border-blue-600 bg-blue-50 dark:bg-blue-900/20 ring-2 ring-blue-300' : (darkMode ? 'border-gray-600' : 'border-gray-300')"
                                 class="border-2 rounded-lg p-3 sm:p-4 md:p-5 cursor-pointer hover:border-blue-400 transition-all hover:shadow-lg active:scale-[0.98] touch-manipulation">
                                <div class="flex items-start justify-between gap-2 sm:gap-3">
                                    <div class="flex-1 min-w-0">
                                        <h5 class="font-bold text-sm sm:text-base md:text-lg truncate" x-text="empresa.nome"></h5>
                                        <p class="text-xs md:text-sm text-gray-500 truncate">NIF: <span x-text="empresa.nif"></span></p>
                                        <p class="text-xs text-gray-400 mt-0.5 sm:mt-1 truncate" x-text="empresa.endereco.municipio"></p>
                                    </div>
                                    <div x-show="empresa.logoPreview || empresa.logo" class="w-10 h-10 sm:w-12 sm:h-12 md:w-14 md:h-14 rounded border flex-shrink-0">
                                        <img :src="empresa.logoPreview || empresa.logo" class="w-full h-full object-contain">
                                    </div>
                                </div>
                                <i x-show="fluxoEmpresaSelecionada?.id === empresa.id" class="bi bi-check-circle-fill text-blue-600 text-lg sm:text-xl md:text-2xl mt-1.5 sm:mt-2 block"></i>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- ETAPA 2: Selecionar Cliente -->
                <div x-show="fluxoEtapa === 2" class="space-y-3 sm:space-y-4">
                    <div class="bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-600 p-3 sm:p-4 rounded-r-lg mb-3 sm:mb-4">
                        <p class="text-xs sm:text-sm break-words">
                            <strong>Empresa selecionada:</strong> 
                            <span x-text="fluxoEmpresaSelecionada?.nome"></span>
                        </p>
                    </div>
                    
                    <h4 class="text-base sm:text-lg font-bold mb-3 sm:mb-4">Selecione o Cliente/Trabalhador:</h4>
                    
                    <!-- Busca -->
                    <input type="text" 
                           x-model="fluxoBuscaCliente"
                           placeholder="üîç Buscar por nome, NIF, fun√ß√£o..."
                           :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'"
                           class="w-full border rounded-lg px-3 sm:px-4 py-2.5 sm:py-3 mb-3 sm:mb-4 focus:ring-2 focus:ring-blue-500 text-sm sm:text-base">
                    
                    <!-- Lista de Clientes -->
                    <div class="space-y-2.5 sm:space-y-3">
                        <template x-for="cliente in clientesFiltrados" :key="cliente.id">
                            <div @click="selecionarCliente(cliente)"
                                 :class="fluxoClienteSelecionado?.id === cliente.id ? 'border-green-600 bg-green-50 dark:bg-green-900/20 ring-2 ring-green-300' : (darkMode ? 'border-gray-600' : 'border-gray-300')"
                                 class="border-2 rounded-lg p-3 sm:p-4 cursor-pointer hover:border-green-400 transition-all hover:shadow-lg active:scale-[0.99] touch-manipulation">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1 min-w-0">
                                        <h5 class="font-bold text-sm sm:text-base md:text-lg truncate" x-text="cliente.nome"></h5>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-1.5 sm:gap-2 mt-1.5 sm:mt-2 text-xs sm:text-sm">
                                            <div class="truncate"><span class="text-gray-500">NIF:</span> <span x-text="cliente.nif"></span></div>
                                            <div class="truncate"><span class="text-gray-500">Fun√ß√£o:</span> <span x-text="cliente.funcao"></span></div>
                                            <div class="truncate"><span class="text-gray-500">Departamento:</span> <span x-text="cliente.departamento"></span></div>
                                            <div class="truncate"><span class="text-gray-500">Sal√°rio:</span> <span x-text="cliente.salario_bruto + ' ' + cliente.moeda"></span></div>
                                        </div>
                                    </div>
                                    <i x-show="fluxoClienteSelecionado?.id === cliente.id" class="bi bi-check-circle-fill text-green-600 text-3xl ml-4"></i>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- ETAPA 3: Tipo de Documento -->
                <div x-show="fluxoEtapa === 3" class="space-y-4">
                    <div class="bg-gradient-to-r from-blue-50 to-green-50 dark:from-blue-900/20 dark:to-green-900/20 border-l-4 border-purple-600 p-4 rounded-r-lg mb-4">
                        <p class="text-sm"><strong>Empresa:</strong> <span x-text="fluxoEmpresaSelecionada?.nome"></span></p>
                        <p class="text-sm"><strong>Cliente:</strong> <span x-text="fluxoClienteSelecionado?.nome"></span></p>
                    </div>
                    
                    <h4 class="text-lg font-bold mb-4">Escolha o Tipo de Documento:</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Declara√ß√£o (Edit√°vel) -->
                        <div @click="fluxoTipoDocumento = 'declaracao'; fluxoEtapa = 3.5"
                             :class="fluxoTipoDocumento === 'declaracao' ? 'border-green-600 bg-green-50 dark:bg-green-900/20 scale-105' : (darkMode ? 'border-gray-600' : 'border-gray-300')"
                             class="border-2 rounded-xl p-6 cursor-pointer hover:border-green-400 hover:shadow-lg transition-all text-center group">
                            <i class="bi bi-file-text text-5xl text-green-600 mb-3 group-hover:scale-110 transition-transform"></i>
                            <h5 class="font-bold text-lg mb-2">Declara√ß√£o</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">1 p√°gina com dados da empresa e cliente</p>
                            <span class="inline-flex items-center text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">
                                <i class="bi bi-pencil mr-1"></i>Edit√°vel - 3 modelos
                            </span>
                        </div>
                        
                        <!-- Recibo (Edit√°vel) -->
                        <div @click="fluxoTipoDocumento = 'recibo'; fluxoEtapa = 3.5"
                             :class="fluxoTipoDocumento === 'recibo' ? 'border-orange-600 bg-orange-50 dark:bg-orange-900/20 scale-105' : (darkMode ? 'border-gray-600' : 'border-gray-300')"
                             class="border-2 rounded-xl p-6 cursor-pointer hover:border-orange-400 hover:shadow-lg transition-all text-center group">
                            <i class="bi bi-receipt text-5xl text-orange-600 mb-3 group-hover:scale-110 transition-transform"></i>
                            <h5 class="font-bold text-lg mb-2">Recibo</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">1-3 p√°ginas (1 por m√™s trabalhado)</p>
                            <span class="inline-flex items-center text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full">
                                <i class="bi bi-pencil mr-1"></i>Edit√°vel - 2 modelos
                            </span>
                        </div>
                        
                        <!-- Combo (Edit√°vel) -->
                        <div @click="fluxoTipoDocumento = 'combo'; fluxoEtapa = 3.5"
                             :class="fluxoTipoDocumento === 'combo' ? 'border-purple-600 bg-purple-50 dark:bg-purple-900/20 scale-105' : (darkMode ? 'border-gray-600' : 'border-gray-300')"
                             class="border-2 rounded-xl p-6 cursor-pointer hover:border-purple-400 hover:shadow-lg transition-all text-center group">
                            <i class="bi bi-files text-5xl text-purple-600 mb-3 group-hover:scale-110 transition-transform"></i>
                            <h5 class="font-bold text-lg mb-2">Combo</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Declara√ß√£o + 3 Recibos = 4 p√°ginas</p>
                            <span class="inline-flex items-center text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">
                                <i class="bi bi-pencil mr-1"></i>Edit√°vel
                            </span>
                        </div>
                        
                        <!-- NIF (Auto-Gera√ß√£o) -->
                        <div @click="gerarDocumentoAutomatico('nif')"
                             class="border-2 rounded-xl p-6 cursor-pointer hover:border-blue-400 hover:shadow-lg transition-all text-center group"
                             :class="darkMode ? 'border-gray-600' : 'border-gray-300'">
                            <i class="bi bi-card-text text-5xl text-blue-600 mb-3 group-hover:scale-110 transition-transform"></i>
                            <h5 class="font-bold text-lg mb-2">NIF</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">N√∫mero de Identifica√ß√£o Fiscal</p>
                            <span class="inline-flex items-center text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">
                                <i class="bi bi-lightning-charge-fill mr-1"></i>Gera√ß√£o Autom√°tica
                            </span>
                        </div>
                        
                        <!-- Atestado (Auto-Gera√ß√£o) -->
                        <div @click="gerarDocumentoAutomatico('atestado')"
                             class="border-2 rounded-xl p-6 cursor-pointer hover:border-teal-400 hover:shadow-lg transition-all text-center group"
                             :class="darkMode ? 'border-gray-600' : 'border-gray-300'">
                            <i class="bi bi-clipboard-check text-5xl text-teal-600 mb-3 group-hover:scale-110 transition-transform"></i>
                            <h5 class="font-bold text-lg mb-2">Atestado</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Atestado m√©dico ou profissional</p>
                            <span class="inline-flex items-center text-xs bg-teal-100 text-teal-700 px-2 py-1 rounded-full">
                                <i class="bi bi-lightning-charge-fill mr-1"></i>Gera√ß√£o Autom√°tica
                            </span>
                        </div>
                        
                        <!-- BI (Editor de Foto) -->
                        <div @click="abrirEditorBI()"
                             class="border-2 rounded-xl p-6 cursor-pointer hover:border-pink-400 hover:shadow-lg transition-all text-center group"
                             :class="darkMode ? 'border-gray-600' : 'border-gray-300'">
                            <i class="bi bi-person-badge text-5xl text-pink-600 mb-3 group-hover:scale-110 transition-transform"></i>
                            <h5 class="font-bold text-lg mb-2">BI</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Bilhete de Identidade com foto</p>
                            <span class="inline-flex items-center text-xs bg-pink-100 text-pink-700 px-2 py-1 rounded-full">
                                <i class="bi bi-image mr-1"></i>Editor de Foto
                            </span>
                        </div>
                    </div>
                    
                    <!-- Op√ß√µes Adicionais para Recibo -->
                    <div x-show="fluxoTipoDocumento === 'recibo'" x-transition class="bg-orange-50 dark:bg-orange-900/20 border border-orange-200 rounded-lg p-4 mt-4">
                        <label class="block text-sm font-bold mb-2">Quantos meses de recibo deseja gerar?</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" x-model="fluxoMesesRecibo" value="1" class="form-radio">
                                <span>1 m√™s</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" x-model="fluxoMesesRecibo" value="2" class="form-radio">
                                <span>2 meses</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" x-model="fluxoMesesRecibo" value="3" class="form-radio">
                                <span>3 meses</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- ETAPA 3.5: Sele√ß√£o de Modelo (apenas para tipos edit√°veis: declaracao, recibo, combo) -->
                <div x-show="fluxoEtapa === 3.5" class="space-y-4">
                    <div class="bg-gradient-to-r from-blue-50 via-green-50 to-purple-50 dark:from-blue-900/20 dark:via-green-900/20 dark:to-purple-900/20 border-l-4 border-purple-600 p-4 rounded-r-lg mb-4">
                        <p class="text-sm"><strong>Empresa:</strong> <span x-text="fluxoEmpresaSelecionada?.nome || 'N/A'"></span></p>
                        <p class="text-sm"><strong>Cliente:</strong> <span x-text="fluxoClienteSelecionado?.nome || 'N/A'"></span></p>
                        <p class="text-sm"><strong>Tipo:</strong> <span x-text="fluxoTipoDocumento ? fluxoTipoDocumento.toUpperCase() : 'N/A'"></span></p>
                    </div>
                    
                    <h4 class="text-lg font-bold mb-4">Escolha o Modelo:</h4>
                    
                    <!-- Modelos de DECLARA√á√ÉO (3 op√ß√µes) -->
                    <div x-show="fluxoTipoDocumento === 'declaracao'" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <template x-for="modelo in modelos.filter(m => m.categoria === 'declaracao' || m.tiposSuportados.includes('declaracao'))" :key="modelo.id">
                            <div @click="fluxoModeloSelecionado = modelo; fluxoEtapa = 4"
                                 :class="fluxoModeloSelecionado?.id === modelo.id ? 'border-green-600 ring-4 ring-green-300' : (darkMode ? 'border-gray-600' : 'border-gray-300')"
                                 class="border-2 rounded-xl overflow-hidden cursor-pointer hover:border-green-400 hover:shadow-xl transition-all group">
                                
                                <!-- Preview Visual Simplificado -->
                                <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800 p-6 h-56 flex items-center justify-center">
                                    <div class="bg-white dark:bg-gray-900 shadow-xl rounded-lg w-40 h-48 p-3 border-l-4"
                                         :class="modelo.id === 'modelo_executivo' ? 'border-blue-600' : modelo.id === 'modelo_classico' ? 'border-gray-400' : 'border-purple-600'">
                                        <div class="space-y-2">
                                            <div class="h-2 bg-gray-300 rounded w-3/4"></div>
                                            <div class="h-1.5 bg-gray-200 rounded"></div>
                                            <div class="h-1.5 bg-gray-200 rounded w-5/6"></div>
                                            <div class="h-1.5 bg-gray-200 rounded w-4/5"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Info do Modelo -->
                                <div class="p-4 bg-white dark:bg-gray-800">
                                    <h5 class="font-bold text-lg mb-1" x-text="modelo.nome"></h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400" x-text="modelo.descricao"></p>
                                    <div class="mt-3 flex items-center justify-between">
                                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full" x-text="modelo.estilo"></span>
                                        <i class="bi bi-check-circle text-green-600 text-xl opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- Modelos de RECIBO (2 op√ß√µes) -->
                    <div x-show="fluxoTipoDocumento === 'recibo'" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <template x-for="modelo in modelos.filter(m => m.categoria === 'recibo' || m.tiposSuportados.includes('recibo'))" :key="modelo.id">
                            <div @click="fluxoModeloSelecionado = modelo; fluxoEtapa = 4"
                                 :class="fluxoModeloSelecionado?.id === modelo.id ? 'border-orange-600 ring-4 ring-orange-300' : (darkMode ? 'border-gray-600' : 'border-gray-300')"
                                 class="border-2 rounded-xl overflow-hidden cursor-pointer hover:border-orange-400 hover:shadow-xl transition-all group">
                                
                                <!-- Preview Visual Simplificado -->
                                <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800 p-6 h-56 flex items-center justify-center">
                                    <div class="bg-white dark:bg-gray-900 shadow-xl rounded-lg w-40 h-48 p-3 border-t-4 border-orange-600">
                                        <div class="space-y-2">
                                            <div class="h-2 bg-orange-300 rounded w-1/2"></div>
                                            <div class="h-1.5 bg-gray-200 rounded"></div>
                                            <div class="h-1.5 bg-gray-200 rounded w-3/4"></div>
                                            <div class="mt-4 pt-2 border-t border-gray-200">
                                                <div class="h-2 bg-orange-200 rounded w-2/3"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Info do Modelo -->
                                <div class="p-4 bg-white dark:bg-gray-800">
                                    <h5 class="font-bold text-lg mb-1" x-text="modelo.nome"></h5>
                                    <p class="text-sm text-gray-600 dark:text-gray-400" x-text="modelo.descricao"></p>
                                    <div class="mt-3 flex items-center justify-between">
                                        <span class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full" x-text="modelo.estilo"></span>
                                        <i class="bi bi-check-circle text-orange-600 text-xl opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- COMBO (Preview combinado) -->
                    <div x-show="fluxoTipoDocumento === 'combo'" class="text-center">
                        <div @click="fluxoModeloSelecionado = {id: 'combo', nome: 'Combo Completo'}; fluxoEtapa = 4"
                             class="border-2 rounded-xl p-8 cursor-pointer hover:border-purple-400 hover:shadow-xl transition-all inline-block"
                             :class="darkMode ? 'border-gray-600' : 'border-gray-300'">
                            <i class="bi bi-files text-6xl text-purple-600 mb-4"></i>
                            <h5 class="font-bold text-xl mb-2">Combo Completo</h5>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Declara√ß√£o + 3 Recibos Mensais</p>
                            <div class="flex items-center justify-center space-x-2 text-sm">
                                <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full">1 Declara√ß√£o</span>
                                <span class="text-gray-400">+</span>
                                <span class="bg-orange-100 text-orange-700 px-3 py-1 rounded-full">3 Recibos</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ETAPA 4: Abrir Modal de Preview (reutiliza modal existente) -->
                <div x-show="fluxoEtapa === 4" 
                     x-init="$watch('fluxoEtapa', value => { if (value === 4) abrirPreviewDoFluxo() })"
                     class="space-y-4">
                    <div class="text-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
                        <p class="text-lg text-gray-600 dark:text-gray-400">Abrindo preview...</p>
                    </div>
                </div>

            </div>
            
            <!-- Rodap√© Fixo com Bot√µes de Navega√ß√£o - RESPONSIVO -->
            <div :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-50 border-gray-200'" 
                 class="border-t px-3 sm:px-6 py-3 sm:py-4 flex items-center justify-between">
                
                <!-- ETAPA 1: Bot√µes -->
                <div x-show="fluxoEtapa === 1" class="w-full flex flex-col sm:flex-row justify-end gap-2 sm:gap-3">
                    <button @click="fecharFluxoGeracao()" 
                            :class="darkMode ? 'bg-gray-600 hover:bg-gray-500 active:bg-gray-400' : 'bg-gray-200 hover:bg-gray-300 active:bg-gray-400'"
                            class="px-4 sm:px-6 py-2.5 rounded-lg transition-colors font-medium text-sm sm:text-base touch-manipulation order-2 sm:order-1">
                        <i class="bi bi-x-circle mr-2"></i>Cancelar
                    </button>
                    <button @click="avancarParaClientes()" 
                            :disabled="!fluxoEmpresaSelecionada"
                            :class="fluxoEmpresaSelecionada ? 'bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white' : 'bg-gray-400 text-gray-200 cursor-not-allowed'"
                            class="px-4 sm:px-6 py-2.5 rounded-lg transition-colors font-medium shadow-md text-sm sm:text-base touch-manipulation order-1 sm:order-2">
                        <span class="hidden sm:inline">Pr√≥ximo: Selecionar Cliente</span>
                        <span class="sm:hidden">Pr√≥ximo</span>
                        <i class="bi bi-arrow-right ml-2"></i>
                    </button>
                </div>
                
                <!-- ETAPA 2: Bot√µes -->
                <div x-show="fluxoEtapa === 2" class="w-full flex justify-between gap-2">
                    <button @click="fluxoEtapa = 1" 
                            :class="darkMode ? 'bg-gray-600 hover:bg-gray-500' : 'bg-gray-200 hover:bg-gray-300'"
                            class="px-3 sm:px-6 py-2.5 rounded-lg transition-colors font-medium text-sm sm:text-base touch-manipulation">
                        <i class="bi bi-arrow-left mr-1 sm:mr-2"></i><span class="hidden xs:inline">Voltar</span>
                    </button>
                    <button @click="avancarParaTipo()" 
                            :disabled="!fluxoClienteSelecionado"
                            :class="fluxoClienteSelecionado ? 'bg-green-600 hover:bg-green-700 active:bg-green-800 text-white' : 'bg-gray-400 text-gray-200 cursor-not-allowed'"
                            class="flex-1 sm:flex-none px-3 sm:px-6 py-2.5 rounded-lg transition-colors font-medium shadow-md text-sm sm:text-base touch-manipulation">
                        <span class="hidden sm:inline">Pr√≥ximo: Tipo de Documento</span>
                        <span class="sm:hidden">Pr√≥ximo</span>
                        <i class="bi bi-arrow-right ml-1 sm:ml-2"></i>
                    </button>
                </div>
                
                <!-- ETAPA 3: Bot√µes -->
                <div x-show="fluxoEtapa === 3" class="w-full flex justify-between gap-2">
                    <button @click="fluxoEtapa = 2" 
                            :class="darkMode ? 'bg-gray-600 hover:bg-gray-500' : 'bg-gray-200 hover:bg-gray-300'"
                            class="px-3 sm:px-6 py-2.5 rounded-lg transition-colors font-medium text-sm sm:text-base touch-manipulation">
                        <i class="bi bi-arrow-left mr-1 sm:mr-2"></i><span class="hidden xs:inline">Voltar</span>
                    </button>
                    <button @click="gerarPreviewDocumento()" 
                            :disabled="!fluxoTipoDocumento"
                            :class="fluxoTipoDocumento ? 'bg-purple-600 hover:bg-purple-700 active:bg-purple-800 text-white' : 'bg-gray-400 text-gray-200 cursor-not-allowed'"
                            class="flex-1 sm:flex-none px-3 sm:px-6 py-2.5 rounded-lg transition-colors font-medium shadow-md text-sm sm:text-base touch-manipulation">
                        <span class="hidden sm:inline">Gerar Preview</span>
                        <span class="sm:hidden">Preview</span>
                        <i class="bi bi-eye ml-1 sm:ml-2"></i>
                    </button>
                </div>
                
                <!-- ETAPA 3.5: Bot√µes (Sele√ß√£o de Modelo) -->
                <div x-show="fluxoEtapa === 3.5" class="w-full flex flex-col sm:flex-row justify-between items-center gap-2">
                    <button @click="fluxoEtapa = 3; fluxoModeloSelecionado = null" 
                            :class="darkMode ? 'bg-gray-600 hover:bg-gray-500' : 'bg-gray-200 hover:bg-gray-300'"
                            class="w-full sm:w-auto px-4 sm:px-6 py-2.5 rounded-lg transition-colors font-medium text-sm sm:text-base touch-manipulation">
                        <i class="bi bi-arrow-left mr-2"></i>Voltar ao Tipo
                    </button>
                    <div class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 flex items-center text-center sm:text-left">
                        <i class="bi bi-info-circle mr-2"></i>
                        <span>Clique em um modelo</span>
                    </div>
                </div>
                
                <!-- ETAPA 4: Bot√µes -->
                <div x-show="fluxoEtapa === 4" class="w-full flex justify-between gap-2">
                    <button @click="fluxoEtapa = 3" 
                            :class="darkMode ? 'bg-gray-600 hover:bg-gray-500' : 'bg-gray-200 hover:bg-gray-300'"
                            class="px-3 sm:px-6 py-2.5 rounded-lg transition-colors font-medium text-sm sm:text-base touch-manipulation">
                        <i class="bi bi-arrow-left mr-1 sm:mr-2"></i><span class="hidden xs:inline">Voltar</span>
                    </button>
                    <button @click="gerarDocumentoFinal()" 
                            class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 active:from-blue-800 active:to-purple-800 flex-1 sm:flex-none px-4 sm:px-8 py-2.5 text-white rounded-lg transition-colors font-bold shadow-lg text-sm sm:text-base touch-manipulation">
                        <i class="bi bi-file-earmark-pdf mr-1 sm:mr-2"></i>
                        <span class="hidden sm:inline">Gerar PDF Final</span>
                        <span class="sm:hidden">Gerar PDF</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ===================================================================== -->
    <!-- MODAL: PREVIEW DE MODELO (FULL SCREEN) - RESPONSIVO COM ATALHO H -->
    <!-- ===================================================================== -->
    <div x-show="modalPreviewModelo" 
         x-transition
         @keydown.window.h="
             if (modalPreviewModelo) {
                 const area = document.getElementById('preview-area');
                 if (area) {
                     area.style.cursor = area.style.cursor === 'grab' ? 'default' : 'grab';
                     const msg = area.style.cursor === 'grab' ? '‚úã Modo Pan Ativado (H)' : 'üñ±Ô∏è Modo Normal (H)';
                     alert.show = true;
                     alert.type = 'success';
                     alert.message = msg;
                     setTimeout(() => { alert.show = false; }, 1500);
                 }
             }
         "
         class="fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50">
        
        <div :class="darkMode ? 'bg-gray-800' : 'bg-white'" 
             class="w-full h-full overflow-hidden shadow-2xl flex flex-col">
            
            <!-- HEADER RESPONSIVO -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-3 sm:p-6 flex items-center justify-between">
                <div class="flex items-center space-x-2 sm:space-x-4 flex-1 min-w-0">
                    <i class="bi bi-file-earmark-richtext text-2xl sm:text-4xl"></i>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-lg sm:text-2xl font-bold truncate" x-text="modeloSelecionado?.nome || 'Modelo'"></h3>
                        <p class="text-blue-100 text-xs sm:text-sm hidden sm:block truncate" x-text="modeloSelecionado?.descricao || ''"></p>
                    </div>
                </div>
                <button @click="fecharModalPreview()" class="text-white hover:text-gray-200 text-3xl sm:text-4xl ml-2 flex-shrink-0 touch-manipulation">
                    &times;
                </button>
            </div>

            <!-- BARRA DE FERRAMENTAS SIMPLIFICADA - MENU HAMBURGER PROFISSIONAL -->
            <div :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'" 
                 class="px-3 sm:px-6 py-2 sm:py-3 flex items-center justify-between gap-3 border-b">
                
                <!-- Menu Hamburger (Mobile) + Tipo atual (Desktop) -->
                <div class="flex items-center gap-3">
                    <!-- Bot√£o Menu Hamburger Mobile -->
                    <button @click="menuPreviewOpen = !menuPreviewOpen" 
                            class="lg:hidden flex items-center justify-center w-10 h-10 rounded-lg transition-colors touch-manipulation"
                            :class="darkMode ? 'bg-gray-600 hover:bg-gray-500 text-white' : 'bg-white hover:bg-gray-50 text-gray-700'">
                        <i class="bi bi-list text-2xl"></i>
                    </button>
                    
                    <!-- Desktop: Tipo atual + bot√µes -->
                    <div class="hidden lg:flex items-center gap-2">
                        <button @click="tipoPreview = 'declaracao'"
                                :class="tipoPreview === 'declaracao' ? 'bg-blue-600 text-white' : (darkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-200' : 'bg-white hover:bg-gray-50 text-gray-700')"
                                class="px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="bi bi-file-earmark-text mr-2"></i>Declara√ß√£o
                        </button>
                        <button @click="menuPreviewOpen = !menuPreviewOpen"
                                :class="darkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-200' : 'bg-white hover:bg-gray-50 text-gray-700'"
                                class="px-4 py-2 rounded-lg font-medium transition-colors">
                            <i class="bi bi-three-dots-vertical"></i>
                        </button>
                    </div>
                    
                    <!-- Mobile: Nome do tipo atual -->
                    <div class="lg:hidden flex items-center gap-2">
                        <i :class="{
                            'bi-file-earmark-text text-blue-600': tipoPreview === 'declaracao',
                            'bi-receipt text-green-600': tipoPreview === 'recibo',
                            'bi-journals text-purple-600': tipoPreview === 'combo',
                            'bi-card-text text-indigo-600': tipoPreview === 'nif',
                            'bi-clipboard-check text-teal-600': tipoPreview === 'atestado',
                            'bi-person-badge text-pink-600': tipoPreview === 'bi'
                        }" class="text-xl"></i>
                        <span class="font-bold text-sm" :class="darkMode ? 'text-gray-100' : 'text-gray-800'" 
                              x-text="tipoPreview === 'declaracao' ? 'Declara√ß√£o' : tipoPreview === 'recibo' ? 'Recibo' : tipoPreview === 'combo' ? 'Combo' : tipoPreview === 'nif' ? 'NIF' : tipoPreview === 'atestado' ? 'Atestado' : 'BI'"></span>
                    </div>
                </div>
                
                <!-- Bot√µes de A√ß√£o -->
                <div class="flex items-center gap-2">
                    <!-- Bot√£o Personalizar (Desktop) -->
                    <button @click="mostrarPersonalizacao = !mostrarPersonalizacao"
                            :class="mostrarPersonalizacao ? 'bg-purple-600 text-white' : (darkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-200' : 'bg-white hover:bg-gray-50 text-gray-700')"
                            class="hidden lg:flex items-center px-4 py-2 rounded-lg font-medium transition-colors">
                        <i class="bi bi-palette mr-2"></i>Personalizar
                    </button>
                    
                    <!-- Bot√£o Ferramentas de Zoom (Desktop) -->
                    <button @click="mostrarControlesZoom = !mostrarControlesZoom"
                            :class="mostrarControlesZoom ? 'bg-blue-600 text-white' : (darkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-200' : 'bg-white hover:bg-gray-50 text-gray-700')"
                            class="hidden lg:flex items-center px-4 py-2 rounded-lg font-medium transition-colors">
                        <i class="bi bi-search mr-2"></i>Zoom
                    </button>
                    
                    <!-- Bot√£o Personalizar (Mobile - s√≥ √≠cone) -->
                    <button @click="mostrarPersonalizacao = !mostrarPersonalizacao"
                            :class="mostrarPersonalizacao ? 'bg-purple-600 text-white' : (darkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-200' : 'bg-white hover:bg-gray-50 text-gray-700')"
                            class="lg:hidden flex items-center justify-center w-10 h-10 rounded-lg transition-colors touch-manipulation">
                        <i class="bi bi-palette text-xl"></i>
                    </button>
                    
                    <!-- Bot√£o Zoom (Mobile - s√≥ √≠cone) -->
                    <button @click="mostrarControlesZoom = !mostrarControlesZoom"
                            :class="mostrarControlesZoom ? 'bg-blue-600 text-white' : (darkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-200' : 'bg-white hover:bg-gray-50 text-gray-700')"
                            class="lg:hidden flex items-center justify-center w-10 h-10 rounded-lg transition-colors touch-manipulation">
                        <i class="bi bi-search text-xl"></i>
                    </button>
                    
                    <!-- Bot√£o Fechar -->
                    <button @click="fecharModalPreview()" 
                            :class="darkMode ? 'bg-gray-600 hover:bg-gray-500 text-gray-200' : 'bg-white hover:bg-gray-50 text-gray-700'"
                            class="flex items-center justify-center w-10 h-10 rounded-lg transition-colors touch-manipulation">
                        <i class="bi bi-x-lg text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- MENU LATERAL HAMBURGER - Slide from left (Mobile) / Dropdown (Desktop) -->
            <div x-show="menuPreviewOpen" 
                 @click.away="menuPreviewOpen = false"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 -translate-x-full lg:translate-x-0 lg:opacity-0 lg:scale-95"
                 x-transition:enter-end="opacity-100 translate-x-0 lg:scale-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 translate-x-0 lg:scale-100"
                 x-transition:leave-end="opacity-0 -translate-x-full lg:translate-x-0 lg:opacity-0 lg:scale-95"
                 class="fixed lg:absolute top-0 lg:top-14 left-0 lg:left-20 w-72 lg:w-80 h-full lg:h-auto lg:max-h-[80vh] lg:rounded-xl shadow-2xl z-50 overflow-y-auto"
                 :class="darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'"
                 style="max-height: 100vh;">
                
                <!-- Header do Menu -->
                <div class="sticky top-0 z-10 p-4 border-b" :class="darkMode ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'">
                    <div class="flex items-center justify-between">
                        <h3 class="font-bold text-lg" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                            <i class="bi bi-files mr-2 text-blue-600"></i>Tipos de Documento
                        </h3>
                        <button @click="menuPreviewOpen = false" 
                                class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-2 rounded-lg transition-colors touch-manipulation">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Itens do Menu -->
                <div class="p-2">
                    <!-- Declara√ß√£o -->
                    <button @click="tipoPreview = 'declaracao'; menuPreviewOpen = false"
                            :class="tipoPreview === 'declaracao' ? 'bg-blue-50 dark:bg-blue-900/20 text-blue-600 border-l-4 border-blue-600' : (darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-50')"
                            class="w-full p-4 rounded-lg transition-all text-left flex items-center gap-3 touch-manipulation">
                        <i class="bi bi-file-earmark-text text-2xl text-blue-600"></i>
                        <div class="flex-1">
                            <div class="font-bold">Declara√ß√£o</div>
                            <div class="text-xs opacity-75">Documento de declara√ß√£o</div>
                        </div>
                        <i class="bi bi-chevron-right text-sm opacity-50"></i>
                    </button>
                    
                    <!-- Recibo -->
                    <button @click="tipoPreview = 'recibo'; menuPreviewOpen = false"
                            :class="tipoPreview === 'recibo' ? 'bg-green-50 dark:bg-green-900/20 text-green-600 border-l-4 border-green-600' : (darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-50')"
                            class="w-full p-4 rounded-lg transition-all text-left flex items-center gap-3 touch-manipulation">
                        <i class="bi bi-receipt text-2xl text-green-600"></i>
                        <div class="flex-1">
                            <div class="font-bold">Recibo</div>
                            <div class="text-xs opacity-75">Recibos mensais</div>
                        </div>
                        <span class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full">Em breve</span>
                    </button>
                    
                    <!-- Combo -->
                    <button @click="tipoPreview = 'combo'; menuPreviewOpen = false"
                            :class="tipoPreview === 'combo' ? 'bg-purple-50 dark:bg-purple-900/20 text-purple-600 border-l-4 border-purple-600' : (darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-50')"
                            class="w-full p-4 rounded-lg transition-all text-left flex items-center gap-3 touch-manipulation">
                        <i class="bi bi-journals text-2xl text-purple-600"></i>
                        <div class="flex-1">
                            <div class="font-bold">Combo</div>
                            <div class="text-xs opacity-75">Declara√ß√£o + Recibos</div>
                        </div>
                        <span class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full">Em breve</span>
                    </button>
                    
                    <div class="my-2 border-t" :class="darkMode ? 'border-gray-700' : 'border-gray-200'"></div>
                    
                    <!-- NIF -->
                    <button @click="tipoPreview = 'nif'; menuPreviewOpen = false"
                            :class="tipoPreview === 'nif' ? 'bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 border-l-4 border-indigo-600' : (darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-50')"
                            class="w-full p-4 rounded-lg transition-all text-left flex items-center gap-3 touch-manipulation">
                        <i class="bi bi-card-text text-2xl text-indigo-600"></i>
                        <div class="flex-1">
                            <div class="font-bold">NIF</div>
                            <div class="text-xs opacity-75">N√∫mero de Identifica√ß√£o Fiscal</div>
                        </div>
                        <span class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full">Em breve</span>
                    </button>
                    
                    <!-- Atestado -->
                    <button @click="tipoPreview = 'atestado'; menuPreviewOpen = false"
                            :class="tipoPreview === 'atestado' ? 'bg-teal-50 dark:bg-teal-900/20 text-teal-600 border-l-4 border-teal-600' : (darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-50')"
                            class="w-full p-4 rounded-lg transition-all text-left flex items-center gap-3 touch-manipulation">
                        <i class="bi bi-clipboard-check text-2xl text-teal-600"></i>
                        <div class="flex-1">
                            <div class="font-bold">Atestado</div>
                            <div class="text-xs opacity-75">Atestado m√©dico/profissional</div>
                        </div>
                        <span class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full">Em breve</span>
                    </button>
                    
                    <!-- BI -->
                    <button @click="tipoPreview = 'bi'; abrirEditorBI(); menuPreviewOpen = false"
                            :class="tipoPreview === 'bi' ? 'bg-pink-50 dark:bg-pink-900/20 text-pink-600 border-l-4 border-pink-600' : (darkMode ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-50')"
                            class="w-full p-4 rounded-lg transition-all text-left flex items-center gap-3 touch-manipulation">
                        <i class="bi bi-person-badge text-2xl text-pink-600"></i>
                        <div class="flex-1">
                            <div class="font-bold">BI</div>
                            <div class="text-xs opacity-75">Bilhete de Identidade</div>
                        </div>
                        <i class="bi bi-chevron-right text-sm opacity-50"></i>
                    </button>
                </div>
            </div>

            <!-- CONTE√öDO: Preview + Painel Lateral RESPONSIVO -->
            <div class="flex-1 overflow-hidden flex flex-col lg:flex-row">
                
                <!-- PAINEL DE PERSONALIZA√á√ÉO - 100% RESPONSIVO (Bottom Drawer Mobile / Lateral Desktop) -->
                <div x-show="mostrarPersonalizacao" 
                     x-transition
                     :class="darkMode ? 'bg-gray-800 border-gray-600' : 'bg-white border-gray-300'"
                     class="w-full lg:w-96 xl:w-[420px] border-t lg:border-t-0 lg:border-l overflow-y-auto p-3 sm:p-4 lg:p-6 
                            max-h-[60vh] sm:max-h-[55vh] lg:max-h-none 
                            fixed lg:relative bottom-0 left-0 right-0 lg:bottom-auto lg:left-auto lg:right-auto
                            z-30 lg:z-auto
                            rounded-t-3xl lg:rounded-none
                            shadow-2xl lg:shadow-none
                            overscroll-contain">
                    
                    <!-- Handle para arrastar (mobile) -->
                    <div class="lg:hidden flex justify-center mb-3 -mt-1">
                        <div :class="darkMode ? 'bg-gray-600' : 'bg-gray-300'" 
                             class="w-16 h-1.5 rounded-full opacity-50"></div>
                    </div>
                    
                    <div class="flex items-center justify-between mb-3 sm:mb-4 sticky top-0 z-10 pb-2"
                         :class="darkMode ? 'bg-gray-800' : 'bg-white'">
                        <h4 :class="darkMode ? 'text-gray-100' : 'text-gray-800'" 
                            class="text-base sm:text-lg font-bold flex items-center">
                            <i class="bi bi-sliders text-purple-600 mr-2 text-lg sm:text-xl"></i>
                            <span class="hidden xs:inline">Personaliza√ß√£o</span>
                            <span class="xs:hidden">Editar</span>
                        </h4>
                        <button @click="mostrarPersonalizacao = false" 
                                class="lg:hidden text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-2 touch-manipulation active:scale-95 transition-transform">
                            <i class="bi bi-x-lg text-xl"></i>
                        </button>
                    </div>

                    <!-- SE√á√ÉO: PRESETS DE ESTILOS -->
                    <div class="mb-4 sm:mb-6 pb-4 sm:pb-6 border-b" :class="darkMode ? 'border-gray-700' : 'border-gray-300'">
                        <label :class="darkMode ? 'text-gray-300' : 'text-gray-700'" 
                               class="block text-sm font-medium mb-2 sm:mb-3">
                            <i class="bi bi-palette mr-1"></i>Estilos R√°pidos
                        </label>
                        <div class="grid grid-cols-2 gap-2 sm:gap-3">
                            <button @click="aplicarPreset('formal')"
                                    :class="darkMode ? 'bg-blue-900/40 hover:bg-blue-800/60 text-blue-300' : 'bg-blue-50 hover:bg-blue-100 text-blue-700'"
                                    class="px-3 py-3 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors flex flex-col items-center touch-manipulation active:scale-95">
                                <i class="bi bi-mortarboard text-xl sm:text-lg mb-1"></i>
                                <span>Formal</span>
                            </button>
                            <button @click="aplicarPreset('moderno')"
                                    :class="darkMode ? 'bg-purple-900/40 hover:bg-purple-800/60 text-purple-300' : 'bg-purple-50 hover:bg-purple-100 text-purple-700'"
                                    class="px-3 py-3 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors flex flex-col items-center touch-manipulation active:scale-95">
                                <i class="bi bi-lightning text-xl sm:text-lg mb-1"></i>
                                <span>Moderno</span>
                            </button>
                            <button @click="aplicarPreset('minimalista')"
                                    :class="darkMode ? 'bg-gray-700 hover:bg-gray-600 text-gray-300' : 'bg-gray-50 hover:bg-gray-100 text-gray-700'"
                                    class="px-3 py-3 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors flex flex-col items-center touch-manipulation active:scale-95">
                                <i class="bi bi-dash-circle text-xl sm:text-lg mb-1"></i>
                                <span>Minimalista</span>
                            </button>
                            <button @click="aplicarPreset('executivo')"
                                    :class="darkMode ? 'bg-green-900/40 hover:bg-green-800/60 text-green-300' : 'bg-green-50 hover:bg-green-100 text-green-700'"
                                    class="px-3 py-3 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors flex flex-col items-center touch-manipulation active:scale-95">
                                <i class="bi bi-briefcase text-xl sm:text-lg mb-1"></i>
                                <span>Executivo</span>
                            </button>
                        </div>
                    </div>

                    <!-- SE√á√ÉO: GERENCIAR PERSONALIZA√á√ïES -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700">
                                <i class="bi bi-save mr-1"></i>Gerenciar Personaliza√ß√µes
                            </label>
                            <div class="flex items-center space-x-2">
                                <label class="text-xs text-gray-600">
                                    <input type="checkbox" x-model="autosaveEnabled" class="mr-1">
                                    Autosave
                                </label>
                            </div>
                        </div>

                        <!-- Slots de Personaliza√ß√£o -->
                        <div class="space-y-2 mb-3">
                            <template x-for="i in [1, 2, 3]" :key="i">
                                <div class="flex items-center space-x-2">
                                    <div class="flex-1 px-3 py-2 bg-gray-50 rounded border border-gray-200">
                                        <div class="flex items-center justify-between">
                                            <div class="flex-1">
                                                <template x-if="personalizacoes['slot' + i]">
                                                    <div>
                                                        <p class="text-xs font-medium text-gray-700" x-text="personalizacoes['slot' + i].nome"></p>
                                                        <p class="text-xs text-gray-400" x-text="'Slot ' + i"></p>
                                                    </div>
                                                </template>
                                                <template x-if="!personalizacoes['slot' + i]">
                                                    <p class="text-xs text-gray-400">Slot vazio</p>
                                                </template>
                                            </div>
                                            <div class="flex space-x-1">
                                                <button @click="abrirModalSalvar('slot' + i)"
                                                        class="px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs"
                                                        title="Salvar">
                                                    <i class="bi bi-save"></i>
                                                </button>
                                                <button @click="carregarPersonalizacao('slot' + i)"
                                                        class="px-2 py-1 bg-green-500 hover:bg-green-600 text-white rounded text-xs"
                                                        title="Carregar"
                                                        x-bind:disabled="!personalizacoes['slot' + i]">
                                                    <i class="bi bi-upload"></i>
                                                </button>
                                                <button @click="deletarPersonalizacao('slot' + i)"
                                                        class="px-2 py-1 bg-red-500 hover:bg-red-600 text-white rounded text-xs"
                                                        title="Deletar"
                                                        x-bind:disabled="!personalizacoes['slot' + i]">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- A√ß√µes Adicionais -->
                        <div class="grid grid-cols-2 gap-2">
                            <button @click="exportarPersonalizacao()"
                                    class="px-3 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded text-xs font-medium">
                                <i class="bi bi-download mr-1"></i>Exportar JSON
                            </button>
                            <label class="px-3 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded text-xs font-medium text-center cursor-pointer">
                                <i class="bi bi-upload mr-1"></i>Importar JSON
                                <input type="file" accept=".json" @change="importarPersonalizacao($event)" class="hidden">
                            </label>
                        </div>

                        <!-- √öltima Salvagem -->
                        <template x-if="lastSaved">
                            <p class="text-xs text-gray-400 mt-2 text-center">
                                <i class="bi bi-clock mr-1"></i>
                                √öltimo save: <span x-text="new Date(lastSaved).toLocaleTimeString('pt-AO')"></span>
                            </p>
                        </template>
                    </div>

                    <!-- SE√á√ÉO: EDI√á√ÉO DE CONTE√öDO -->
                    <div class="mb-4 sm:mb-6 pb-4 sm:pb-6 border-b" :class="darkMode ? 'border-gray-700' : 'border-gray-300'">
                        <label :class="darkMode ? 'text-gray-300' : 'text-gray-700'" 
                               class="block text-sm font-medium mb-2 sm:mb-3">
                            <i class="bi bi-pencil mr-1"></i>Editar Conte√∫do
                        </label>
                        
                        <!-- T√≠tulo do Documento -->
                        <div class="mb-3">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-1">T√≠tulo do Documento</label>
                            <input type="text" 
                                   x-model="previewConfig.tituloDocumento"
                                   :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900'"
                                   class="w-full px-3 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm touch-manipulation"
                                   placeholder="DECLARA√á√ÉO DE TRABALHO">
                        </div>

                        <!-- Texto Introdut√≥rio -->
                        <div class="mb-3">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-1">Texto Introdut√≥rio</label>
                            <textarea 
                                x-model="previewConfig.textoIntro"
                                rows="3"
                                :class="darkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900'"
                                class="w-full px-3 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm touch-manipulation resize-y"
                                placeholder="Declara-se, para os devidos efeitos..."></textarea>
                        </div>

                        <!-- Alinhamento do Texto -->
                        <div class="mb-3">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-1">Alinhamento do Texto</label>
                            <select x-model="previewConfig.alinhamentoTexto" 
                                    :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'"
                                    class="w-full px-3 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm touch-manipulation">
                                <option value="left">Esquerda</option>
                                <option value="center">Centro</option>
                                <option value="right">Direita</option>
                                <option value="justify">Justificado</option>
                            </select>
                        </div>

                        <!-- Alinhamento do Cabe√ßalho -->
                        <div>
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-1">Alinhamento do Cabe√ßalho</label>
                            <select x-model="previewConfig.alinhamentoCabecalho" 
                                    :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'"
                                    class="w-full px-3 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm touch-manipulation">
                                <option value="left">Esquerda</option>
                                <option value="center">Centro</option>
                                <option value="right">Direita</option>
                            </select>
                        </div>
                    </div>

                    <!-- SE√á√ÉO: CONTROLES AVAN√áADOS DO CABE√áALHO -->
                    <div class="mb-4 sm:mb-6 pb-4 sm:pb-6 border-b" :class="darkMode ? 'border-gray-700' : 'border-gray-300'">
                        <div class="flex items-center justify-between mb-2 sm:mb-3">
                            <label :class="darkMode ? 'text-gray-300' : 'text-gray-700'" 
                                   class="block text-sm font-medium">
                                <i class="bi bi-layout-text-window mr-1"></i><span class="hidden sm:inline">Layout do </span>Cabe√ßalho
                            </label>
                            <button @click="previewConfig.cabecalhoMaxWidth = 450; previewConfig.cabecalhoMarginEntreLogoTexto = 20; previewConfig.cabecalhoJustify = 'space-between'; previewConfig.cabecalhoPaddingBottom = 15; previewConfig.cabecalhoBordaLargura = 4; previewConfig.cabecalhoLogoSize = 80; previewConfig.cabecalhoPaddingHorizontal = 0; previewConfig.cabecalhoLineHeight = 1.4;" 
                                    class="text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 p-2 touch-manipulation">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>

                        <!-- Padding Horizontal do Container -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Espa√ßo Lateral: <span class="font-bold" x-text="previewConfig.cabecalhoPaddingHorizontal + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoPaddingHorizontal" min="0" max="100" step="5"
                                   :class="darkMode ? 'accent-indigo-500' : 'accent-indigo-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation"
                                   style="background: linear-gradient(to right, #818cf8 0%, #818cf8 var(--value), #e5e7eb var(--value), #e5e7eb 100%);">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>0</span>
                                <span>100</span>
                            </div>
                        </div>

                        <!-- Espa√ßo entre Logo e Texto -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Logo ‚Üî Texto: <span class="font-bold" x-text="previewConfig.cabecalhoMarginEntreLogoTexto + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoMarginEntreLogoTexto" min="0" max="1000" step="10"
                                   :class="darkMode ? 'accent-indigo-500' : 'accent-indigo-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>0</span>
                                <span>1000</span>
                            </div>
                        </div>

                        <!-- Line Height do Texto do Cabe√ßalho -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Entre Linhas: <span class="font-bold" x-text="previewConfig.cabecalhoLineHeight"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoLineHeight" min="1.0" max="2.5" step="0.1"
                                   :class="darkMode ? 'accent-indigo-500' : 'accent-indigo-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>1.0</span>
                                <span>2.5</span>
                            </div>
                        </div>

                        <!-- Tamanho do Logo -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Tamanho Logo: <span class="font-bold" x-text="previewConfig.cabecalhoLogoSize + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoLogoSize" min="50" max="150" step="10"
                                   :class="darkMode ? 'accent-indigo-500' : 'accent-indigo-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>50</span>
                                <span>150</span>
                            </div>
                        </div>

                        <!-- Padding Inferior -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Espa√ßo Inferior: <span class="font-bold" x-text="previewConfig.cabecalhoPaddingBottom + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoPaddingBottom" min="0" max="40" step="5"
                                   :class="darkMode ? 'accent-indigo-500' : 'accent-indigo-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>0</span>
                                <span>40</span>
                            </div>
                        </div>

                        <!-- Largura da Borda -->
                        <div>
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Borda: <span class="font-bold" x-text="previewConfig.cabecalhoBordaLargura + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.cabecalhoBordaLargura" min="0" max="10" step="1"
                                   :class="darkMode ? 'accent-indigo-500' : 'accent-indigo-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>0</span>
                                <span>10</span>
                            </div>
                        </div>
                    </div>

                    <!-- SE√á√ÉO: CONTROLES DO CARIMBO -->
                    <div class="mb-4 sm:mb-6 pb-4 sm:pb-6 border-b" :class="darkMode ? 'border-gray-700' : 'border-gray-300'">
                        <div class="flex items-center justify-between mb-2 sm:mb-3">
                            <label :class="darkMode ? 'text-gray-300' : 'text-gray-700'" 
                                   class="block text-sm font-medium">
                                <i class="bi bi-award mr-1"></i>Carimbo
                            </label>
                            <button @click="previewConfig.carimboWidth = 110; previewConfig.carimboHeight = 110;" 
                                    class="text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 p-2 touch-manipulation">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>

                        <!-- Largura do Carimbo -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Largura: <span class="font-bold" x-text="previewConfig.carimboWidth + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.carimboWidth" min="50" max="300" step="5"
                                   :class="darkMode ? 'accent-green-500' : 'accent-green-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>50</span>
                                <span>300</span>
                            </div>
                        </div>

                        <!-- Altura do Carimbo -->
                        <div>
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Altura: <span class="font-bold" x-text="previewConfig.carimboHeight + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.carimboHeight" min="50" max="300" step="5"
                                   :class="darkMode ? 'accent-green-500' : 'accent-green-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>50</span>
                                <span>300</span>
                            </div>
                        </div>
                    </div>

                    <!-- SE√á√ÉO: ZOOM -->
                    <div class="mb-4 sm:mb-6 pb-4 sm:pb-6 border-b" :class="darkMode ? 'border-gray-700' : 'border-gray-300'">
                        <label :class="darkMode ? 'text-gray-300' : 'text-gray-700'" 
                               class="block text-sm font-medium mb-2">
                            <i class="bi bi-zoom-in mr-1"></i>Zoom: 
                            <span class="font-bold" x-text="previewConfig.zoom + '%'"></span>
                        </label>
                        <input type="range" x-model="previewConfig.zoom" min="50" max="150" step="5"
                               :class="darkMode ? 'accent-indigo-500' : 'accent-indigo-600'"
                               class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                        <div class="flex flex-wrap gap-2 mt-3">
                            <button @click="previewConfig.zoom = 75" 
                                    :class="darkMode ? 'bg-gray-700 hover:bg-gray-600 text-gray-200' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'"
                                    class="px-3 py-2 text-xs rounded-lg touch-manipulation active:scale-95 transition-transform">75%</button>
                            <button @click="previewConfig.zoom = 100" 
                                    :class="darkMode ? 'bg-gray-700 hover:bg-gray-600 text-gray-200' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'"
                                    class="px-3 py-2 text-xs rounded-lg touch-manipulation active:scale-95 transition-transform">100%</button>
                            <button @click="previewConfig.zoom = 125" 
                                    :class="darkMode ? 'bg-gray-700 hover:bg-gray-600 text-gray-200' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'"
                                    class="px-3 py-2 text-xs rounded-lg touch-manipulation active:scale-95 transition-transform">125%</button>
                        </div>
                    </div>

                    <!-- SE√á√ÉO: FONTES -->
                    <div class="mb-4 sm:mb-6 pb-4 sm:pb-6 border-b" :class="darkMode ? 'border-gray-700' : 'border-gray-300'">
                        <div class="flex items-center justify-between mb-2 sm:mb-3">
                            <label :class="darkMode ? 'text-gray-300' : 'text-gray-700'" 
                                   class="block text-sm font-medium">
                                <i class="bi bi-fonts mr-1"></i>Tipografia
                            </label>
                            <button @click="resetFontes()" 
                                    class="text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 p-2 touch-manipulation">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>
                        
                        <!-- Fonte -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-1">Fam√≠lia</label>
                            <select x-model="previewConfig.fontFamily" 
                                    :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'"
                                    class="w-full px-3 py-2.5 border rounded-lg focus:ring-2 focus:ring-purple-500 text-sm touch-manipulation">
                                <option value="Times New Roman, serif">Times New Roman</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="Calibri, sans-serif">Calibri</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="Verdana, sans-serif">Verdana</option>
                            </select>
                        </div>
                        
                        <!-- Tamanho Base -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Corpo Texto: <span class="font-bold" x-text="previewConfig.fontSize + 'pt'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.fontSize" min="10" max="16" step="1"
                                   :class="darkMode ? 'accent-purple-500' : 'accent-purple-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>10pt</span>
                                <span>16pt</span>
                            </div>
                        </div>

                        <!-- T√≠tulo Principal -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                T√≠tulo Principal: <span class="font-bold" x-text="previewConfig.tamanhoTitulo + 'pt'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.tamanhoTitulo" min="20" max="36" step="2"
                                   :class="darkMode ? 'accent-blue-500' : 'accent-blue-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>20pt</span>
                                <span>36pt</span>
                            </div>
                        </div>

                        <!-- Subt√≠tulos -->
                        <div class="mb-4">
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Subt√≠tulos: <span class="font-bold" x-text="previewConfig.tamanhoSubtitulo + 'pt'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.tamanhoSubtitulo" min="14" max="24" step="1"
                                   :class="darkMode ? 'accent-blue-500' : 'accent-blue-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>14pt</span>
                                <span>24pt</span>
                            </div>
                        </div>

                        <!-- Dados Empresa -->
                        <div>
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">
                                Dados Empresa: <span class="font-bold" x-text="previewConfig.tamanhoEmpresa + 'pt'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.tamanhoEmpresa" min="8" max="14" step="0.5"
                                   :class="darkMode ? 'accent-blue-500' : 'accent-blue-600'"
                                   class="w-full h-3 sm:h-2 rounded-lg appearance-none cursor-pointer touch-manipulation">
                            <div :class="darkMode ? 'text-gray-500' : 'text-gray-400'" 
                                 class="flex justify-between text-xs mt-1">
                                <span>8pt</span>
                                <span>14pt</span>
                            </div>
                        </div>
                    </div>

                    <!-- SE√á√ÉO: CORES -->
                    <div class="mb-4 sm:mb-6 pb-4 sm:pb-6 border-b" :class="darkMode ? 'border-gray-700' : 'border-gray-300'">
                        <div class="flex items-center justify-between mb-2 sm:mb-3">
                            <label :class="darkMode ? 'text-gray-300' : 'text-gray-700'" 
                                   class="block text-sm font-medium">
                                <i class="bi bi-palette mr-1"></i>Cores
                            </label>
                            <button @click="resetCores()" 
                                    class="text-xs text-blue-600 hover:text-blue-700 dark:text-blue-400 p-2 touch-manipulation">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>
                        
                        <!-- Cor de Destaque -->
                        <div>
                            <label :class="darkMode ? 'text-gray-400' : 'text-gray-600'" 
                                   class="block text-xs mb-2">Cor de Destaque</label>
                            <div class="flex items-center gap-2">
                                <input type="color" x-model="previewConfig.corDestaque"
                                       class="w-14 h-12 rounded-lg border cursor-pointer touch-manipulation"
                                       :class="darkMode ? 'border-gray-600 bg-gray-700' : 'border-gray-300'">
                                <input type="text" x-model="previewConfig.corDestaque"
                                       :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300 text-gray-900'"
                                       class="flex-1 px-3 py-2.5 border rounded-lg text-sm font-mono uppercase touch-manipulation">
                            </div>
                        </div>
                    </div>

                    <!-- SE√á√ÉO: MARCA D'√ÅGUA -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <div class="flex items-center justify-between mb-3">
                            <label class="block text-sm font-medium text-gray-700">
                                <i class="bi bi-droplet mr-1"></i>Marca d'√°gua
                            </label>
                            <button @click="resetMarcaDagua()" class="text-xs text-blue-600 hover:text-blue-700">
                                <i class="bi bi-arrow-counterclockwise mr-1"></i>Reset
                            </button>
                        </div>
                        
                        <!-- Opacidade -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Opacidade: <span class="font-bold" x-text="previewConfig.marcaDaguaOpacidade + '%'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.marcaDaguaOpacidade" min="5" max="30" step="5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>

                        <!-- Rota√ß√£o -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Rota√ß√£o: <span class="font-bold" x-text="previewConfig.marcaDaguaRotacao + '¬∞'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.marcaDaguaRotacao" min="-45" max="45" step="5"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>

                        <!-- Width -->
                        <div class="mb-3">
                            <label class="block text-xs text-gray-600 mb-1">
                                Largura: <span class="font-bold" x-text="previewConfig.marcaDaguaWidth + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.marcaDaguaWidth" min="200" max="600" step="25"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>

                        <!-- Height -->
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">
                                Altura: <span class="font-bold" x-text="previewConfig.marcaDaguaHeight + 'px'"></span>
                            </label>
                            <input type="range" x-model="previewConfig.marcaDaguaHeight" min="200" max="600" step="25"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                    </div>

                    <!-- SE√á√ÉO: ESPA√áAMENTO -->
                    <div class="mb-6 pb-6 border-b border-gray-300">
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            <i class="bi bi-text-indent-left mr-1"></i>Espa√ßamento
                        </label>
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">
                                Entre linhas: <span class="font-bold" x-text="previewConfig.espacamentoLinhas.toFixed(1)"></span>
                            </label>
                            <input type="range" x-model.number="previewConfig.espacamentoLinhas" min="1.0" max="2.0" step="0.1"
                                   class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                    </div>

                    <!-- Bot√£o Resetar Tudo -->
                    <button @click="previewConfig = {
                                fontFamily: 'Times New Roman, serif', 
                                fontSize: 12, 
                                tamanhoTitulo: 28,
                                tamanhoSubtitulo: 18,
                                tamanhoEmpresa: 9,
                                corTexto: '#000000', 
                                corDestaque: '#1e40af', 
                                marcaDaguaOpacidade: 10,
                                marcaDaguaRotacao: -45,
                                marcaDaguaWidth: 400,
                                marcaDaguaHeight: 400,
                                espacamentoLinhas: 1.6,
                                zoom: 100,
                                tituloDocumento: 'DECLARA√á√ÉO DE TRABALHO',
                                textoIntro: 'Declara-se, para os devidos efeitos, que',
                                alinhamentoTexto: 'justify',
                                alinhamentoCabecalho: 'left',
                                cabecalhoMaxWidth: 450,
                                cabecalhoMarginEntreLogoTexto: 20,
                                cabecalhoJustify: 'space-between',
                                cabecalhoPaddingBottom: 15,
                                cabecalhoBordaLargura: 4,
                                cabecalhoLogoSize: 80,
                                cabecalhoPaddingHorizontal: 0,
                                cabecalhoLineHeight: 1.4,
                                carimboWidth: 110,
                                carimboHeight: 110
                            }"
                            class="w-full px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg hover:from-red-600 hover:to-red-700 transition-all text-sm font-medium shadow-lg">
                        <i class="bi bi-arrow-counterclockwise mr-2"></i>Resetar Tudo
                    </button>

                </div>

                <!-- √ÅREA DE PREVIEW - PROFISSIONAL COM SCROLL H+V -->
                <div :class="darkMode ? 'bg-gray-900' : 'bg-gray-200'" 
                     class="flex-1 overflow-auto relative"
                     id="preview-area"
                     style="scroll-behavior: smooth; overflow-x: auto; overflow-y: auto;">
                    
                    <!-- Container com padding para scroll horizontal e vertical -->
                    <div class="inline-block min-w-full min-h-full"
                         :style="'padding: ' + Math.max(40, previewConfig.zoom * 0.5) + 'px ' + Math.max(80, previewConfig.zoom * 0.8) + 'px;'">
                    
                        <!-- CONTROLES DE ZOOM - FLOATING PROFISSIONAL -->
                        <div x-show="mostrarControlesZoom"
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 scale-90"
                             x-transition:enter-end="opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-150"
                             x-transition:leave-start="opacity-100 scale-100"
                             x-transition:leave-end="opacity-0 scale-90"
                             class="fixed top-24 md:top-24 right-4 z-30 flex flex-col gap-2">
                            
                            <!-- Indicador de Zoom com Gradiente -->
                            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl px-4 py-2.5 shadow-2xl backdrop-blur-md">
                                <div class="flex items-center justify-center gap-2">
                                    <i class="bi bi-zoom-in text-lg"></i>
                                    <span class="font-bold text-base" x-text="previewConfig.zoom + '%'"></span>
                                </div>
                            </div>
                            
                            <!-- Bot√£o Zoom In -->
                            <button @click="previewConfig.zoom = Math.min(200, previewConfig.zoom + 10)"
                                    :disabled="previewConfig.zoom >= 200"
                                    :class="previewConfig.zoom >= 200 ? 'opacity-40 cursor-not-allowed' : 'hover:scale-105 active:scale-95'"
                                    class="bg-white dark:bg-gray-800 border-2 border-blue-500 rounded-xl w-14 h-14 flex items-center justify-center shadow-xl transition-all"
                                    title="Aumentar Zoom (+10%)">
                                <i class="bi bi-plus-lg text-2xl text-blue-600 dark:text-blue-400"></i>
                            </button>
                            
                            <!-- Bot√£o Reset Zoom -->
                            <button @click="previewConfig.zoom = 100"
                                    class="bg-white dark:bg-gray-800 border-2 border-gray-400 dark:border-gray-500 rounded-xl w-14 h-14 flex items-center justify-center shadow-xl hover:scale-105 active:scale-95 transition-all"
                                    title="Resetar Zoom (100%)">
                                <i class="bi bi-arrow-counterclockwise text-xl text-gray-600 dark:text-gray-300"></i>
                            </button>
                            
                            <!-- Bot√£o Zoom Out -->
                            <button @click="previewConfig.zoom = Math.max(30, previewConfig.zoom - 10)"
                                    :disabled="previewConfig.zoom <= 30"
                                    :class="previewConfig.zoom <= 30 ? 'opacity-40 cursor-not-allowed' : 'hover:scale-105 active:scale-95'"
                                    class="bg-white dark:bg-gray-800 border-2 border-red-500 rounded-xl w-14 h-14 flex items-center justify-center shadow-xl transition-all"
                                    title="Diminuir Zoom (-10%)">
                                <i class="bi bi-dash-lg text-2xl text-red-600 dark:text-red-400"></i>
                            </button>
                            
                            <!-- Fit to Screen -->
                            <button @click="previewConfig.zoom = 60"
                                    class="bg-white dark:bg-gray-800 border-2 border-green-500 rounded-xl w-14 h-14 flex items-center justify-center shadow-xl hover:scale-105 active:scale-95 transition-all"
                                    title="Ajustar √† Tela (60%)">
                                <i class="bi bi-arrows-angle-contract text-xl text-green-600 dark:text-green-400"></i>
                            </button>
                        </div>
                        
                        <!-- PREVIEW: DECLARA√á√ÉO - PROFISSIONAL -->
                        <template x-if="tipoPreview === 'declaracao'">
                            <div class="w-[210mm] mx-auto transition-transform duration-300" 
                                 :style="'transform: scale(' + (previewConfig.zoom / 100) + '); transform-origin: top center;'">
                                <div id="preview-render"
                                     x-html="renderizarModelo()" 
                                     class="w-full min-h-[297mm] bg-white dark:bg-gray-950 shadow-2xl rounded-lg overflow-hidden"
                                     style="box-shadow: 0 10px 50px rgba(0,0,0,0.25); border: 1px solid rgba(0,0,0,0.1);"></div>
                            </div>
                        </template>

                        <!-- PREVIEW: RECIBO - PROFISSIONAL -->
                        <template x-if="tipoPreview === 'recibo'">
                            <div class="text-center py-12 w-[210mm] mx-auto transition-transform duration-300"
                                 :style="'transform: scale(' + (previewConfig.zoom / 100) + '); transform-origin: top center;'">
                            <div class="bg-gradient-to-br from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 rounded-xl sm:rounded-2xl p-6 sm:p-8 lg:p-12 border-2 border-dashed border-orange-300 dark:border-orange-700">
                                <i class="bi bi-receipt text-5xl sm:text-6xl lg:text-8xl text-orange-400 mb-4 sm:mb-6"></i>
                                <h3 class="text-xl sm:text-2xl font-bold text-gray-700 dark:text-gray-200 mb-2 sm:mb-3">Recibo de Sal√°rio</h3>
                                <p class="text-orange-600 dark:text-orange-400 text-base sm:text-lg font-medium mb-2">üöß Em desenvolvimento brevemente</p>
                                <p class="text-gray-500 dark:text-gray-400 text-xs sm:text-sm">Recibo com 1-3 meses de pagamento</p>
                            </div>
                        </div>
                    </template>

                        <!-- PREVIEW: COMBO - PROFISSIONAL -->
                        <template x-if="tipoPreview === 'combo'">
                            <div class="text-center py-12 w-[210mm] mx-auto transition-transform duration-300"
                                 :style="'transform: scale(' + (previewConfig.zoom / 100) + '); transform-origin: top center;'">
                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl sm:rounded-2xl p-6 sm:p-8 lg:p-12 border-2 border-dashed border-purple-300 dark:border-purple-700">
                                <i class="bi bi-journals text-5xl sm:text-6xl lg:text-8xl text-purple-400 mb-4 sm:mb-6"></i>
                                <h3 class="text-xl sm:text-2xl font-bold text-gray-700 dark:text-gray-200 mb-2 sm:mb-3">Combo Completo</h3>
                                <p class="text-purple-600 dark:text-purple-400 text-base sm:text-lg font-medium mb-2">üöß Em desenvolvimento brevemente</p>
                                <p class="text-gray-500 dark:text-gray-400 text-xs sm:text-sm">Declara√ß√£o + 3 Recibos = 4 p√°ginas</p>
                            </div>
                        </div>
                    </template>
                        
                        <!-- PREVIEW: NIF - PROFISSIONAL -->
                        <template x-if="tipoPreview === 'nif'">
                            <div class="text-center py-12 w-[210mm] mx-auto transition-transform duration-300"
                                 :style="'transform: scale(' + (previewConfig.zoom / 100) + '); transform-origin: top center;'">
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl sm:rounded-2xl p-6 sm:p-8 lg:p-12 border border-blue-200 dark:border-blue-800 shadow-lg">
                                <i class="bi bi-card-text text-5xl sm:text-6xl lg:text-7xl text-blue-500 mb-4 sm:mb-6 animate-pulse"></i>
                                <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold mb-3 sm:mb-4" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                                    <span class="hidden sm:inline">N√∫mero de Identifica√ß√£o Fiscal</span>
                                    <span class="sm:hidden">NIF</span>
                                </h3>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded-lg p-3 sm:p-4 mb-3 sm:mb-4 inline-block">
                                    <p class="text-blue-700 dark:text-blue-300 text-xs sm:text-sm font-medium">
                                        <i class="bi bi-tools mr-1 sm:mr-2"></i>Funcionalidade em desenvolvimento
                                    </p>
                                </div>
                                <p class="text-gray-600 dark:text-gray-400 mb-2 text-sm sm:text-base">
                                    Documento fiscal com gera√ß√£o autom√°tica
                                </p>
                                <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-500">
                                    Em breve: Gera√ß√£o instant√¢nea de documento NIF profissional
                                </p>
                            </div>
                        </div>
                    </template>
                    
                        <!-- PREVIEW: ATESTADO - PROFISSIONAL -->
                        <template x-if="tipoPreview === 'atestado'">
                            <div class="text-center py-12 w-[210mm] mx-auto transition-transform duration-300"
                                 :style="'transform: scale(' + (previewConfig.zoom / 100) + '); transform-origin: top center;'">
                            <div class="bg-gradient-to-br from-teal-50 to-green-50 dark:from-teal-900/20 dark:to-green-900/20 rounded-xl sm:rounded-2xl p-6 sm:p-8 lg:p-12 border border-teal-200 dark:border-teal-800 shadow-lg">
                                <i class="bi bi-clipboard-check text-5xl sm:text-6xl lg:text-7xl text-teal-500 mb-4 sm:mb-6 animate-pulse"></i>
                                <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold mb-3 sm:mb-4" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                                    <span class="hidden sm:inline">Atestado M√©dico/Profissional</span>
                                    <span class="sm:hidden">Atestado</span>
                                </h3>
                                <div class="bg-teal-100 dark:bg-teal-900/30 rounded-lg p-3 sm:p-4 mb-3 sm:mb-4 inline-block">
                                    <p class="text-teal-700 dark:text-teal-300 text-xs sm:text-sm font-medium">
                                        <i class="bi bi-tools mr-1 sm:mr-2"></i>Funcionalidade em desenvolvimento
                                    </p>
                                </div>
                                <p class="text-gray-600 dark:text-gray-400 mb-2 text-sm sm:text-base">
                                    Atestado com valida√ß√£o autom√°tica de dados
                                </p>
                                <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-500">
                                    Em breve: Templates profissionais para atestados m√©dicos e de trabalho
                                </p>
                            </div>
                        </div>
                    </template>
                    
                    <!-- PREVIEW: BI (Editor de Fotos) - 100% RESPONSIVO -->
                    <template x-if="tipoPreview === 'bi'">
                        <div class="w-full h-full p-3 sm:p-6 lg:p-8 overflow-y-auto" 
                             x-init="if (biFoto1Editada) { biFoto1Preview = biFoto1Editada; } if (biFoto2Editada) { biFoto2Preview = biFoto2Editada; }">
                            <div class="max-w-4xl mx-auto">
                                <h3 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-center" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                                    <i class="bi bi-person-badge text-pink-600 mr-2"></i>
                                    <span class="hidden sm:inline">Editor de Bilhete de Identidade</span>
                                    <span class="sm:hidden">Editor de BI</span>
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                                    <!-- FOTO 1 (Superior) -->
                                    <div class="space-y-2 sm:space-y-3">
                                        <label class="block text-sm font-bold" :class="darkMode ? 'text-gray-200' : 'text-gray-700'">
                                            <i class="bi bi-image mr-1"></i>Foto 1 (Superior)
                                        </label>
                                        <div @click="$refs.inputFoto1.click()" 
                                             class="relative w-full h-56 sm:h-80 border-2 border-dashed rounded-xl cursor-pointer transition-all hover:border-pink-500 hover:bg-pink-50 dark:hover:bg-pink-900/10 group"
                                             :class="biFoto1Preview ? 'border-pink-500 bg-pink-50 dark:bg-pink-900/20' : 'border-gray-300 dark:border-gray-600'">
                                            <div x-show="biFoto1Preview" class="absolute inset-0 overflow-hidden rounded-xl">
                                                <img :src="biFoto1Preview" 
                                                     id="preview-foto1"
                                                     class="w-full h-full object-contain bg-gray-100 dark:bg-gray-800">
                                            </div>
                                            <div x-show="!biFoto1Preview" class="absolute inset-0 flex flex-col items-center justify-center text-gray-400 group-hover:text-pink-500 transition-colors">
                                                <i class="bi bi-cloud-upload text-5xl sm:text-6xl mb-2 sm:mb-4"></i>
                                                <p class="font-medium">Clique para adicionar foto</p>
                                                <p class="text-xs mt-1 sm:mt-2">JPG, PNG - M√°x 5MB</p>
                                            </div>
                                            <div x-show="biFoto1Preview" 
                                                 class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-xl">
                                                <div class="text-white text-center">
                                                    <i class="bi bi-pencil-square text-2xl sm:text-4xl mb-1 sm:mb-2"></i>
                                                    <p class="font-medium">Clique para trocar/editar</p>
                                                </div>
                                            </div>
                                        </div>
                                        <input type="file" 
                                               x-ref="inputFoto1"
                                               @change="carregarFotoBI(1, $event)"
                                               accept="image/*"
                                               class="hidden">
                                        <div x-show="biFoto1Preview" class="flex gap-2 mt-2">
                                            <button @click.stop="abrirCropperBI(1)" 
                                                    class="flex-1 px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors text-base font-medium touch-manipulation">
                                                <i class="bi bi-crop mr-1"></i>Cortar
                                            </button>
                                            <button @click.stop="removerFotoBI(1)" 
                                                    class="px-4 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors text-base font-medium touch-manipulation">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <!-- FOTO 2 (Inferior) -->
                                    <div class="space-y-2 sm:space-y-3">
                                        <label class="block text-sm font-bold" :class="darkMode ? 'text-gray-200' : 'text-gray-700'">
                                            <i class="bi bi-image mr-1"></i>Foto 2 (Inferior)
                                        </label>
                                        <div @click="$refs.inputFoto2.click()" 
                                             class="relative w-full h-56 sm:h-80 border-2 border-dashed rounded-xl cursor-pointer transition-all hover:border-pink-500 hover:bg-pink-50 dark:hover:bg-pink-900/10 group"
                                             :class="biFoto2Preview ? 'border-pink-500 bg-pink-50 dark:bg-pink-900/20' : 'border-gray-300 dark:border-gray-600'">
                                            <div x-show="biFoto2Preview" class="absolute inset-0 overflow-hidden rounded-xl">
                                                <img :src="biFoto2Preview" 
                                                     id="preview-foto2"
                                                     class="w-full h-full object-contain bg-gray-100 dark:bg-gray-800">
                                            </div>
                                            <div x-show="!biFoto2Preview" class="absolute inset-0 flex flex-col items-center justify-center text-gray-400 group-hover:text-pink-500 transition-colors">
                                                <i class="bi bi-cloud-upload text-5xl sm:text-6xl mb-2 sm:mb-4"></i>
                                                <p class="font-medium">Clique para adicionar foto</p>
                                                <p class="text-xs mt-1 sm:mt-2">JPG, PNG - M√°x 5MB</p>
                                            </div>
                                            <div x-show="biFoto2Preview" 
                                                 class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-xl">
                                                <div class="text-white text-center">
                                                    <i class="bi bi-pencil-square text-2xl sm:text-4xl mb-1 sm:mb-2"></i>
                                                    <p class="font-medium">Clique para trocar/editar</p>
                                                </div>
                                            </div>
                                        </div>
                                        <input type="file" 
                                               x-ref="inputFoto2"
                                               @change="carregarFotoBI(2, $event)"
                                               accept="image/*"
                                               class="hidden">
                                        <div x-show="biFoto2Preview" class="flex gap-2 mt-2">
                                            <button @click.stop="abrirCropperBI(2)" 
                                                    class="flex-1 px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors text-base font-medium touch-manipulation">
                                                <i class="bi bi-crop mr-1"></i>Cortar
                                            </button>
                                            <button @click.stop="removerFotoBI(2)" 
                                                    class="px-4 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors text-base font-medium touch-manipulation">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <!-- Toggle Modo Manual -->
                                <div class="mt-8 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-xl">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" 
                                               x-model="biModoManual"
                                               class="w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500">
                                        <span class="ml-3 font-medium" :class="darkMode ? 'text-gray-200' : 'text-gray-800'">
                                            <i class="bi bi-pencil-square mr-1"></i>Modo Manual
                                        </span>
                                        <span class="ml-2 text-xs text-gray-500">(Preencher dados manualmente)</span>
                                    </label>
                                </div>
                                <!-- Campos Manuais (aparecem quando modo manual ativado) -->
                                <div x-show="biModoManual" 
                                     x-transition
                                     class="mt-4 p-6 bg-white dark:bg-gray-800 border-2 border-blue-300 dark:border-blue-600 rounded-xl space-y-4">
                                    <h4 class="font-bold text-lg mb-4" :class="darkMode ? 'text-gray-100' : 'text-gray-800'">
                                        <i class="bi bi-person-vcard mr-2 text-blue-600"></i>Dados do Titular
                                    </h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <!-- Nome -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">
                                                Nome Completo
                                            </label>
                                            <input type="text" 
                                                   x-model="biDadosManuais.nome"
                                                   placeholder="Ex: Jo√£o Francisco Silva"
                                                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                                   :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'">
                                        </div>
                                        <!-- BI / NIF (mesmo n√∫mero em Angola) -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">
                                                BI / NIF
                                            </label>
                                            <input type="text" 
                                                   x-model="biDadosManuais.biNif"
                                                   placeholder="Ex: 006789012LA043"
                                                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                                   :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'">
                                            <p class="text-xs text-gray-500 mt-1">Em Angola, BI e NIF s√£o o mesmo n√∫mero</p>
                                        </div>
                                        <!-- Data -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2" :class="darkMode ? 'text-gray-300' : 'text-gray-700'">
                                                Data do Documento
                                            </label>
                                            <input type="text" 
                                                   x-model="biDadosManuais.data"
                                                   placeholder="Ex: 09/11/2025"
                                                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                                   :class="darkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'">
                                        </div>
                                    </div>
                                    <p class="text-xs text-blue-600 dark:text-blue-400 flex items-center">
                                        <i class="bi bi-info-circle mr-1"></i>
                                        Sem modo manual, os dados v√™m da empresa e cliente selecionados no fluxo
                                    </p>
                                </div>
                                <!-- Bot√£o Gerar BI -->
                                <div class="mt-8 text-center">
                                    <button @click="gerarBIPDF()" 
                                            :disabled="!biFoto1Preview || !biFoto2Preview"
                                            :class="(biFoto1Preview && biFoto2Preview) ? 'bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-700 hover:to-purple-700 cursor-pointer' : 'bg-gray-400 cursor-not-allowed'"
                                            class="px-8 py-4 text-white rounded-xl transition-all font-bold shadow-lg hover:shadow-2xl text-lg touch-manipulation">
                                        <i class="bi bi-file-earmark-pdf-fill mr-2"></i>
                                        Gerar BI em PDF
                                    </button>
                                    <p class="text-xs text-gray-500 mt-3" x-show="!biFoto1Preview || !biFoto2Preview">
                                        <i class="bi bi-info-circle mr-1"></i>Adicione as 2 fotos para gerar o BI
                                    </p>
                                </div>
                            </div>
                        </div>
                    </template>
                    
                    </div><!-- Fecha container com padding -->

                </div><!-- Fecha #preview-area -->
            
            </div><!-- Fecha layout principal -->

            <!-- FOOTER: A√ß√µes de PDF - 100% RESPONSIVO COM TOGGLE MOBILE -->
            <div :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'" 
                 class="px-3 sm:px-6 py-3 sm:py-4 flex flex-col lg:flex-row items-stretch lg:items-center justify-between gap-3 border-t">
                
                <!-- Badge de Status - Mobile: Full width, Desktop: Auto -->
                <div :class="(fluxoEmpresaSelecionada && fluxoClienteSelecionado) ? (darkMode ? 'bg-green-900/30 text-green-300 border-green-700' : 'bg-green-50 text-green-700 border-green-300') : (darkMode ? 'bg-yellow-900/30 text-yellow-300 border-yellow-700' : 'bg-yellow-50 text-yellow-700 border-yellow-300')" 
                     class="text-xs sm:text-sm px-3 sm:px-4 py-2 rounded-lg border flex items-center justify-center lg:justify-start order-2 lg:order-1">
                    <i :class="(fluxoEmpresaSelecionada && fluxoClienteSelecionado) ? 'bi bi-check-circle-fill text-green-500' : 'bi bi-lightbulb text-yellow-500'" class="mr-2 flex-shrink-0"></i>
                    <span x-show="fluxoEmpresaSelecionada && fluxoClienteSelecionado" class="truncate">
                        <strong class="hidden sm:inline">Dados Reais: </strong>
                        <strong x-text="fluxoEmpresaSelecionada?.nome || 'N/A'" class="hidden sm:inline"></strong>
                        <strong class="hidden sm:inline"> + </strong>
                        <strong x-text="fluxoClienteSelecionado?.nome || 'N/A'" class="hidden sm:inline"></strong>
                        <strong class="sm:hidden">Dados Reais</strong>
                    </span>
                    <span x-show="!fluxoEmpresaSelecionada || !fluxoClienteSelecionado" class="truncate text-center">
                        <strong class="hidden sm:inline">Preview com dados de exemplo</strong>
                        <strong class="sm:hidden">Dados de Exemplo</strong>
                    </span>
                </div>
                
                <!-- Bot√µes de A√ß√£o - Responsivos -->
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 order-1 lg:order-2">
                    
                    <!-- Bot√£o Voltar/Fechar -->
                    <button @click="fluxoEtapa === 4 ? voltarParaEscolhaModelo() : fecharModalPreview()" 
                            :class="darkMode ? 'bg-gray-600 text-gray-200 hover:bg-gray-500 active:bg-gray-400' : 'bg-gray-300 text-gray-700 hover:bg-gray-400 active:bg-gray-500'"
                            class="px-4 py-2.5 sm:py-2 rounded-lg transition-colors font-medium touch-manipulation text-sm sm:text-base">
                        <i :class="fluxoEtapa === 4 ? 'bi bi-arrow-left' : 'bi bi-x-circle'" class="mr-2"></i>
                        <span x-text="fluxoEtapa === 4 ? 'Voltar' : 'Fechar'"></span>
                    </button>
                    
                    <!-- Bot√µes de a√ß√£o (ocultos para tipos em desenvolvimento) -->
                    <template x-if="!['nif', 'atestado', 'recibo', 'combo'].includes(tipoPreview)">
                        <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 w-full sm:w-auto">
                            
                            <!-- MOBILE: Toggle + A√ß√µes Dropdown -->
                            <div class="sm:hidden flex flex-col gap-2">
                                <!-- Bot√£o Toggle A√ß√µes (Controla zoom E a√ß√µes PDF) -->
                                <button @click="mostrarAcoesPDF = !mostrarAcoesPDF; mostrarControlesZoom = !mostrarControlesZoom"
                                        :class="mostrarAcoesPDF ? 'from-indigo-600 to-purple-600' : 'from-purple-600 to-indigo-600'"
                                        class="px-4 py-3 bg-gradient-to-r text-white rounded-lg transition-all font-bold shadow-lg active:scale-95 touch-manipulation flex items-center justify-center gap-2">
                                    <i :class="mostrarAcoesPDF ? 'bi bi-chevron-up' : 'bi bi-tools'" class="text-lg"></i>
                                    <span x-text="mostrarAcoesPDF ? 'Ocultar Ferramentas' : 'Mostrar Ferramentas'"></span>
                                </button>
                                
                                <!-- Menu de A√ß√µes (Toggle) -->
                                <div x-show="mostrarAcoesPDF"
                                     x-transition:enter="transition ease-out duration-200"
                                     x-transition:enter-start="opacity-0 scale-95"
                                     x-transition:enter-end="opacity-100 scale-100"
                                     x-transition:leave="transition ease-in duration-150"
                                     x-transition:leave-start="opacity-100 scale-100"
                                     x-transition:leave-end="opacity-0 scale-95"
                                     class="grid grid-cols-2 gap-2">
                                    
                                    <!-- Bot√£o: Nova Aba -->
                                    <button @click="visualizarPDFNovaAba(); mostrarAcoesPDF = false" 
                                            class="px-3 py-3 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white rounded-lg transition-colors font-medium shadow-md touch-manipulation text-sm">
                                        <i class="bi bi-window mr-1"></i>Nova Aba
                                    </button>
                                    
                                    <!-- Bot√£o: Imprimir -->
                                    <button @click="imprimirPDF(); mostrarAcoesPDF = false" 
                                            class="px-3 py-3 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white rounded-lg transition-colors font-medium shadow-md touch-manipulation text-sm">
                                        <i class="bi bi-printer mr-1"></i>Imprimir
                                    </button>
                                    
                                    <!-- Bot√£o: Baixar PDF (Full Width) -->
                                    <button @click="(fluxoEtapa === 4 ? gerarPDFFluxo() : gerarPDF()); mostrarAcoesPDF = false" 
                                            class="col-span-2 px-4 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 active:from-purple-800 active:to-indigo-800 transition-all font-bold shadow-lg touch-manipulation text-sm">
                                        <i class="bi bi-download mr-2"></i>
                                        <span x-text="fluxoEtapa === 4 ? 'Gerar PDF' : 'Baixar PDF'"></span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- DESKTOP: Bot√µes inline -->
                            <div class="hidden sm:flex items-center gap-3">
                                <button @click="visualizarPDFNovaAba()" 
                                        class="px-4 py-2 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white rounded-lg transition-colors font-medium shadow-md hover:shadow-lg touch-manipulation">
                                    <i class="bi bi-window mr-2"></i>Nova Aba
                                </button>
                                
                                <button @click="imprimirPDF()" 
                                        class="px-4 py-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white rounded-lg transition-colors font-medium shadow-md hover:shadow-lg touch-manipulation">
                                    <i class="bi bi-printer mr-2"></i>Imprimir
                                </button>
                                
                                <!-- Bot√£o Principal: Gerar/Baixar PDF -->
                                <button @click="fluxoEtapa === 4 ? gerarPDFFluxo() : gerarPDF()" 
                                        class="px-6 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg hover:from-purple-700 hover:to-indigo-700 active:from-purple-800 active:to-indigo-800 transition-all font-bold shadow-lg hover:shadow-xl touch-manipulation">
                                    <i class="bi bi-download mr-2"></i>
                                    <span x-text="fluxoEtapa === 4 ? 'Gerar PDF' : 'Baixar PDF'"></span>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

        </div>
    </div>

    <!-- ===================================================================== -->
    <!-- MODAL: CROPPER BI (Editor de Corte de Fotos) - 100% RESPONSIVO -->
    <!-- ===================================================================== -->
    <div x-show="modalCropperBI" 
         x-transition
         class="fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50 p-0 sm:p-4">
        
        <div :class="darkMode ? 'bg-gray-800' : 'bg-white'" 
             class="w-full sm:max-w-4xl h-full sm:h-[90vh] sm:rounded-2xl shadow-2xl flex flex-col overflow-hidden">
            
            <!-- HEADER RESPONSIVO -->
            <div class="bg-gradient-to-r from-pink-600 to-purple-600 text-white p-3 sm:p-4 flex items-center justify-between">
                <h3 class="text-base sm:text-xl font-bold flex items-center gap-2">
                    <i class="bi bi-crop text-lg sm:text-xl"></i>
                    <span class="hidden xs:inline">Cortar Foto <span x-text="cropperFotoAtual"></span></span>
                    <span class="xs:hidden">Crop <span x-text="cropperFotoAtual"></span></span>
                </h3>
                <button @click="fecharCropperBI()" 
                        class="text-white hover:text-gray-200 text-2xl sm:text-3xl p-2 touch-manipulation">
                    &times;
                </button>
            </div>

            <!-- √ÅREA DO CROPPER - 100% Touch Optimized -->
            <div class="flex-1 overflow-hidden bg-gray-900 flex items-center justify-center p-2 sm:p-4 relative">
                <!-- Instru√ß√µes Mobile -->
                <div class="absolute top-2 left-2 right-2 bg-black/70 text-white text-xs px-3 py-2 rounded-lg sm:hidden z-10">
                    <i class="bi bi-hand-index-thumb mr-1"></i>
                    Use 2 dedos para zoom/rota√ß√£o
                </div>
                
                <div id="cropper-container" class="max-w-full max-h-full touch-manipulation w-full flex items-center justify-center">
                    <img id="cropper-image" style="max-width: 100%; max-height: 60vh; display: block; touch-action: none;" class="sm:max-h-[70vh]">
                </div>
            </div>

            <!-- FOOTER: A√ß√µes 100% RESPONSIVAS -->
            <div :class="darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300'" 
                 class="p-3 sm:px-6 sm:py-4 flex flex-col gap-3 border-t">
                
                <!-- Controles de Rota√ß√£o - Grid Mobile, Flex Desktop -->
                <div class="grid grid-cols-3 sm:flex sm:items-center sm:justify-center gap-2 sm:gap-3">
                    <button @click="rotacionarCropper(-90)" 
                            class="px-3 sm:px-4 py-3 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white rounded-lg transition-colors touch-manipulation flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 text-xs sm:text-sm">
                        <i class="bi bi-arrow-counterclockwise text-lg sm:text-base"></i>
                        <span class="hidden xs:inline">‚Ü∫</span>
                        <span class="xs:hidden text-[10px]">‚Ü∫</span>
                    </button>
                    
                    <button @click="resetarCropper()" 
                            class="px-3 sm:px-4 py-3 bg-gray-500 hover:bg-gray-600 active:bg-gray-700 text-white rounded-lg transition-colors touch-manipulation flex flex-col sm:flex-row items-center justify-center gap-1 text-xs sm:text-sm">
                        <i class="bi bi-arrow-repeat text-lg sm:text-base"></i>
                        <span class="hidden sm:inline">Reset</span>
                    </button>
                    
                    <button @click="rotacionarCropper(90)" 
                            class="px-3 sm:px-4 py-3 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white rounded-lg transition-colors touch-manipulation flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2 text-xs sm:text-sm">
                        <i class="bi bi-arrow-clockwise text-lg sm:text-base"></i>
                        <span class="hidden xs:inline">‚Üª</span>
                        <span class="xs:hidden text-[10px]">‚Üª</span>
                    </button>
                </div>
                
                <!-- Bot√µes de A√ß√£o Principal - Grid Mobile -->
                <div class="grid grid-cols-2 gap-2 sm:flex sm:justify-end sm:gap-3">
                    <button @click="fecharCropperBI()" 
                            :class="darkMode ? 'bg-gray-600 hover:bg-gray-500 active:bg-gray-400 text-gray-200' : 'bg-gray-300 hover:bg-gray-400 active:bg-gray-500 text-gray-700'"
                            class="px-4 sm:px-6 py-3 rounded-lg transition-colors font-medium touch-manipulation text-sm sm:text-base">
                        Cancelar
                    </button>
                    <button @click="aplicarCorte()" 
                            class="px-4 sm:px-6 py-3 bg-gradient-to-r from-pink-600 to-purple-600 text-white rounded-lg hover:from-pink-700 hover:to-purple-700 active:from-pink-800 active:to-purple-800 transition-all font-bold shadow-lg touch-manipulation text-sm sm:text-base">
                        <i class="bi bi-check-lg mr-2"></i>Aplicar
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal: Nova Empresa -->
    <div x-show="modalNovaEmpresa" 
         x-transition
         @click.self="fecharModalEmpresa()"
         class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-40 p-0">
        <div @click.stop 
             :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white text-gray-900'"
             class="rounded-none lg:rounded-2xl max-w-full lg:max-w-7xl w-full h-screen lg:h-[98vh] overflow-hidden shadow-2xl flex flex-col">
            
            <!-- Header Fixo -->
            <div class="flex items-center justify-between px-6 lg:px-8 py-4 lg:py-6 border-b-2"
                 :class="darkMode ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-white'">
                <h3 class="text-2xl lg:text-3xl font-bold"
                    :class="darkMode ? 'text-white' : 'text-gray-800'">
                    <i class="bi bi-building-add mr-2 lg:mr-3 text-blue-600"></i>
                    <span x-text="empresaForm.id ? 'Editar Empresa' : 'Nova Empresa'"></span>
                </h3>
                <button @click="fecharModalEmpresa()" 
                        :class="darkMode ? 'text-gray-400 hover:text-gray-200' : 'text-gray-400 hover:text-gray-600'"
                        class="text-3xl lg:text-4xl transition-all duration-300 hover:rotate-90 transform">
                    &times;
                </button>
            </div>

            <!-- Container Principal com Flex -->
            <div class="flex flex-1 overflow-hidden">
                
                <!-- FORMUL√ÅRIO (Lado Esquerdo) -->
                <div class="w-full lg:w-3/5 overflow-y-auto p-6 lg:p-8"
                     :class="darkMode ? 'bg-gray-800' : 'bg-white'">
                    <form @submit.prevent="salvarEmpresa()" class="space-y-6 lg:space-y-8" 
                          x-bind:class="darkMode ? 'dark-form' : 'light-form'">
                    
                    <style>
                        /* Dark mode form styles */
                        .dark-form label { color: #d1d5db !important; }
                        .dark-form h4 { color: #e5e7eb !important; }
                        .dark-form input:not([type="color"]):not([type="file"]),
                        .dark-form textarea,
                        .dark-form select {
                            background-color: #374151 !important;
                            border-color: #4b5563 !important;
                            color: #ffffff !important;
                        }
                        .dark-form input::placeholder,
                        .dark-form textarea::placeholder {
                            color: #9ca3af !important;
                        }
                        .dark-form p { color: #d1d5db !important; }
                        
                        /* Light mode form styles */
                        .light-form label { color: #374151 !important; }
                        .light-form h4 { color: #374151 !important; }
                        .light-form input:not([type="color"]):not([type="file"]),
                        .light-form textarea,
                        .light-form select {
                            background-color: #ffffff !important;
                            border-color: #d1d5db !important;
                            color: #111827 !important;
                        }
                        .light-form input::placeholder,
                        .light-form textarea::placeholder {
                            color: #9ca3af !important;
                        }
                    </style>
                    
                    <!-- SE√á√ÉO 1: Identifica√ß√£o -->
                    <div class="mb-6 lg:mb-8">
                        <h4 class="text-lg font-bold mb-4 pb-2 border-b-2 border-blue-600">
                            <i class="bi bi-info-circle mr-2"></i>Identifica√ß√£o
                        </h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">
                                    Nome da Empresa <span class="text-red-500">*</span>
                                </label>
                                <input type="text" 
                                       x-model="empresaForm.nome"
                                       required
                                       placeholder="Ex: EMFC Consulting, S.A."
                                       class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors">
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">
                                    NIF/CC <span class="text-red-500">*</span>
                                </label>
                                <input type="text" 
                                       x-model="empresaForm.nif"
                                       required
                                       placeholder="Ex: 5480023446"
                                       class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors">
                            </div>
                        </div>
                    </div>

                    <!-- SE√á√ÉO 2: Endere√ßo Completo -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold mb-4 pb-2 border-b-2 border-green-600">
                            <i class="bi bi-geo-alt mr-2"></i>Endere√ßo da Sede
                        </h4>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2">
                                    <label class="block text-sm font-medium mb-2">
                                        Rua/Avenida <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.rua"
                                           required
                                           placeholder="Ex: Avenida 4 de Fevereiro"
                                           class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2">Edif√≠cio</label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.edificio"
                                           placeholder="Ex: Edif√≠cio Summit Tower"
                                           class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2">Andar</label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.andar"
                                           placeholder="Ex: 5.¬∫ andar"
                                           class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2">Sala</label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.sala"
                                           placeholder="Ex: Sala 502"
                                           class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2">
                                        Bairro <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.bairro"
                                           required
                                           placeholder="Ex: Kinaxixe"
                                           class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2">
                                        Munic√≠pio <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.municipio"
                                           required
                                           placeholder="Ex: Luanda"
                                           class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2">
                                        Prov√≠ncia <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.provincia"
                                           required
                                           placeholder="Ex: Luanda"
                                           class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2">
                                        Pa√≠s <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" 
                                           x-model="empresaForm.endereco.pais"
                                           required
                                           placeholder="Ex: Angola"
                                           class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SE√á√ÉO 3: Contatos (Opcional) -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-gray-700 mb-4 pb-2 border-b-2 border-purple-600">
                            <i class="bi bi-telephone mr-2"></i>Contatos <span class="text-sm text-gray-500 font-normal">(Opcional)</span>
                        </h4>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Telefone</label>
                                <input type="tel" 
                                       x-model="empresaForm.telefone"
                                       placeholder="Ex: +244 XXX XXX XXX"
                                       class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">Email</label>
                                <input type="email" 
                                       x-model="empresaForm.email"
                                       placeholder="Ex: contato@empresa.ao"
                                       class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">Website</label>
                                <input type="url" 
                                       x-model="empresaForm.website"
                                       placeholder="Ex: www.empresa.ao"
                                       class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- SE√á√ÉO 4: Elementos Visuais -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-gray-700 mb-4 pb-2 border-b-2 border-orange-600">
                            <i class="bi bi-image mr-2"></i>Elementos Visuais
                        </h4>
                        
                        <div class="space-y-6">
                            <!-- UPLOAD DE LOGO -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">
                                    Logo da Empresa <span class="text-red-500">*</span>
                                </label>
                                
                                <!-- Preview do Logo -->
                                <div class="flex items-start space-x-4">
                                    <!-- Preview -->
                                    <div class="flex-shrink-0">
                                        <div class="w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50 overflow-hidden">
                                            <template x-if="empresaForm.logoPreview || empresaForm.logo">
                                                <img :src="empresaForm.logoPreview || empresaForm.logo" 
                                                     :key="empresaForm.logoPreview || empresaForm.logo"
                                                     alt="Logo Preview" 
                                                     class="w-full h-full object-contain"
                                                     crossorigin="anonymous">
                                            </template>
                                            <template x-if="!empresaForm.logoPreview && !empresaForm.logo">
                                                <div class="text-center text-gray-400">
                                                    <i class="bi bi-image text-4xl"></i>
                                                    <p class="text-xs mt-1">Sem logo</p>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <!-- Bot√µes de A√ß√£o -->
                                    <div class="flex-1 space-y-2">
                                        <!-- Bot√£o Upload/Alterar -->
                                        <button type="button"
                                                @click="$refs.logoInput.click()"
                                                class="w-full px-4 py-3 rounded-lg transition-all transform hover:scale-105 flex items-center justify-center space-x-2 shadow-sm"
                                                :class="empresaForm.logo || empresaForm.logoPreview ? 'bg-blue-600 hover:bg-blue-700 text-white' : 'bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white'">
                                            <i :class="empresaForm.logo || empresaForm.logoPreview ? 'bi bi-arrow-repeat' : 'bi bi-cloud-upload-fill'"></i>
                                            <span x-text="(empresaForm.logo || empresaForm.logoPreview) ? 'Alterar Logo' : 'Upload Logo'"></span>
                                        </button>
                                        
                                        <!-- Input File Oculto -->
                                        <input type="file" 
                                               x-ref="logoInput"
                                               @change="handleLogoUpload($event)"
                                               accept="image/png,image/jpeg,image/jpg,image/svg+xml"
                                               class="hidden">
                                        
                                        <!-- Bot√£o Remover (se tiver logo) -->
                                        <template x-if="empresaForm.logo || empresaForm.logoPreview">
                                            <button type="button"
                                                    @click="removerLogoEmpresa()"
                                                    class="w-full px-4 py-2 bg-red-50 hover:bg-red-100 text-red-600 border-2 border-red-200 hover:border-red-300 rounded-lg transition-all flex items-center justify-center space-x-2">
                                                <i class="bi bi-trash3"></i>
                                                <span>Remover Logo</span>
                                            </button>
                                        </template>
                                        
                                        <!-- Status -->
                                        <div class="flex items-center space-x-2 text-xs mt-2">
                                            <template x-if="empresaForm.logoPreview || empresaForm.logo">
                                                <div class="flex items-center text-green-600">
                                                    <i class="bi bi-check-circle-fill mr-1"></i>
                                                    <span>Logo carregado</span>
                                                </div>
                                            </template>
                                            <template x-if="!empresaForm.logoPreview && !empresaForm.logo">
                                                <div class="flex items-center text-gray-400">
                                                    <i class="bi bi-exclamation-circle mr-1"></i>
                                                    <span>Obrigat√≥rio</span>
                                                </div>
                                            </template>
                                        </div>
                                        
                                        <p class="text-xs text-gray-500 mt-2">
                                            <i class="bi bi-info-circle mr-1"></i>
                                            Formatos: PNG, JPG, SVG ‚Ä¢ M√°x: 2MB
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- UPLOAD DE CARIMBO -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">
                                    Carimbo com Assinatura <span class="text-red-500">*</span>
                                </label>
                                
                                <!-- Preview do Carimbo -->
                                <div class="flex items-start space-x-4">
                                    <!-- Preview -->
                                    <div class="flex-shrink-0">
                                        <div class="w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50 overflow-hidden">
                                            <template x-if="empresaForm.carimboPreview || empresaForm.carimbo">
                                                <img :src="empresaForm.carimboPreview || empresaForm.carimbo" 
                                                     :key="empresaForm.carimboPreview || empresaForm.carimbo"
                                                     alt="Carimbo Preview" 
                                                     class="w-full h-full object-contain"
                                                     crossorigin="anonymous">
                                            </template>
                                            <template x-if="!empresaForm.carimboPreview && !empresaForm.carimbo">
                                                <div class="text-center text-gray-400">
                                                    <i class="bi bi-stamp text-4xl"></i>
                                                    <p class="text-xs mt-1">Sem carimbo</p>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                    
                                    <!-- Bot√µes de A√ß√£o -->
                                    <div class="flex-1 space-y-2">
                                        <!-- Bot√£o Upload/Alterar -->
                                        <button type="button"
                                                @click="$refs.carimboInput.click()"
                                                class="w-full px-4 py-3 rounded-lg transition-all transform hover:scale-105 flex items-center justify-center space-x-2 shadow-sm"
                                                :class="empresaForm.carimbo || empresaForm.carimboPreview ? 'bg-green-600 hover:bg-green-700 text-white' : 'bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white'">
                                            <i :class="empresaForm.carimbo || empresaForm.carimboPreview ? 'bi bi-arrow-repeat' : 'bi bi-cloud-upload-fill'"></i>
                                            <span x-text="(empresaForm.carimbo || empresaForm.carimboPreview) ? 'Alterar Carimbo' : 'Upload Carimbo'"></span>
                                        </button>
                                        
                                        <!-- Input File Oculto -->
                                        <input type="file" 
                                               x-ref="carimboInput"
                                               @change="handleCarimboUpload($event)"
                                               accept="image/png,image/jpeg,image/jpg,image/svg+xml"
                                               class="hidden">
                                        
                                        <!-- Bot√£o Remover (se tiver carimbo) -->
                                        <template x-if="empresaForm.carimbo || empresaForm.carimboPreview">
                                            <button type="button"
                                                    @click="removerCarimboEmpresa()"
                                                    class="w-full px-4 py-2 bg-red-50 hover:bg-red-100 text-red-600 border-2 border-red-200 hover:border-red-300 rounded-lg transition-all flex items-center justify-center space-x-2">
                                                <i class="bi bi-trash3"></i>
                                                <span>Remover Carimbo</span>
                                            </button>
                                        </template>
                                        
                                        <!-- Status -->
                                        <div class="flex items-center space-x-2 text-xs mt-2">
                                            <template x-if="empresaForm.carimboPreview || empresaForm.carimbo">
                                                <div class="flex items-center text-green-600">
                                                    <i class="bi bi-check-circle-fill mr-1"></i>
                                                    <span>Carimbo carregado</span>
                                                </div>
                                            </template>
                                            <template x-if="!empresaForm.carimboPreview && !empresaForm.carimbo">
                                                <div class="flex items-center text-gray-400">
                                                    <i class="bi bi-exclamation-circle mr-1"></i>
                                                    <span>Obrigat√≥rio</span>
                                                </div>
                                            </template>
                                        </div>
                                        
                                        <p class="text-xs text-gray-500 mt-2">
                                            <i class="bi bi-info-circle mr-1"></i>
                                            Fundo transparente recomendado ‚Ä¢ M√°x: 2MB
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Cor Prim√°ria</label>
                                    <div class="flex items-center space-x-3">
                                        <input type="color" 
                                               x-model="empresaForm.corPrimaria"
                                               class="h-12 w-20 rounded cursor-pointer">
                                        <input type="text" 
                                               x-model="empresaForm.corPrimaria"
                                               placeholder="#1e40af"
                                               class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium mb-2">Cor Secund√°ria</label>
                                    <div class="flex items-center space-x-3">
                                        <input type="color" 
                                               x-model="empresaForm.corSecundaria"
                                               class="h-12 w-20 rounded cursor-pointer">
                                        <input type="text" 
                                               x-model="empresaForm.corSecundaria"
                                               placeholder="#64748b"
                                               class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">Marca d'√°gua <span class="text-sm text-gray-500">(Opcional)</span></label>
                                <input type="text" 
                                       x-model="empresaForm.marcaDagua"
                                       placeholder="Ex: CONSULTING, S.A."
                                       class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-1">Texto que aparecer√° em diagonal no fundo do documento</p>
                            </div>
                        </div>
                    </div>

                    <!-- BOT√ïES -->
                    <div class="flex items-center justify-between pt-6 border-t-2 sticky bottom-0 pb-4"
                         :class="darkMode ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-white'">
                        <button type="button" 
                                @click="fecharModalEmpresa()"
                                :class="darkMode ? 'bg-gray-700 hover:bg-gray-600 text-gray-200' : 'bg-gray-200 hover:bg-gray-300 text-gray-700'"
                                class="px-6 py-3 rounded-lg transition-all duration-200 flex items-center space-x-2">
                            <i class="bi bi-x-circle"></i>
                            <span>Cancelar</span>
                        </button>
                        <button type="submit"
                                class="px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl flex items-center space-x-2">
                            <i class="bi bi-check-circle"></i>
                            <span x-text="empresaForm.id ? 'Salvar Altera√ß√µes' : 'Cadastrar Empresa'"></span>
                        </button>
                    </div>

                </form>
            </div>

            <!-- PREVIEW (Lado Direito) -->
            <div class="hidden lg:block lg:w-2/5 overflow-y-auto border-l-2"
                 :class="darkMode ? 'bg-gradient-to-br from-gray-700 to-gray-800 border-gray-700' : 'bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200'">
                <div class="p-8">
                    <h4 class="text-xl font-bold mb-6 flex items-center"
                        :class="darkMode ? 'text-white' : 'text-gray-800'">
                        <i class="bi bi-eye mr-2 text-purple-600"></i>Preview em Tempo Real
                    </h4>

                <!-- Preview Card -->
                <div class="rounded-xl shadow-lg p-6 mb-6 border-2"
                     :class="darkMode ? 'bg-gray-900 border-gray-600' : 'bg-white border-gray-200'">
                    <div class="flex items-start justify-between mb-4">
                        <!-- Logo Preview -->
                        <div class="w-24 h-24 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800">
                            <img x-show="empresaForm.logoPreview || empresaForm.logo" 
                                 :src="empresaForm.logoPreview || empresaForm.logo" 
                                 :key="empresaForm.logoPreview || empresaForm.logo"
                                 alt="Logo"
                                 class="max-w-full max-h-full object-contain">
                            <i x-show="!empresaForm.logoPreview && !empresaForm.logo" class="bi bi-image text-4xl text-gray-300 dark:text-gray-600"></i>
                        </div>
                    </div>

                    <!-- Dados da Empresa -->
                    <div class="space-y-2 mb-4">
                        <h5 class="font-bold text-lg" 
                            :style="'color: ' + (empresaForm.corPrimaria || '#1e40af')"
                            x-text="empresaForm.nome || 'Nome da Empresa'"></h5>
                        <p class="text-sm text-gray-600">
                            <strong>NIF:</strong> <span x-text="empresaForm.nif || 'XXXXXXXXXX'"></span>
                        </p>
                        <p class="text-sm text-gray-600">
                            <strong>Sede:</strong> 
                            <span x-text="empresaForm.endereco.rua || 'Endere√ßo'"></span>
                            <span x-show="empresaForm.endereco.edificio" x-text="', ' + empresaForm.endereco.edificio"></span>
                            <span x-show="empresaForm.endereco.andar" x-text="', ' + empresaForm.endereco.andar"></span>
                            <span x-show="empresaForm.endereco.sala" x-text="', ' + empresaForm.endereco.sala"></span>
                        </p>
                        <p class="text-sm text-gray-600">
                            <span x-text="empresaForm.endereco.bairro || 'Bairro'"></span> ‚Äî 
                            <span x-text="empresaForm.endereco.municipio || 'Munic√≠pio'"></span>
                        </p>
                        <p class="text-sm text-gray-600">
                            <span x-text="empresaForm.endereco.provincia || 'Prov√≠ncia'"></span> ‚Äî 
                            <span x-text="empresaForm.endereco.pais || 'Pa√≠s'"></span>
                        </p>
                        
                        <div x-show="empresaForm.telefone || empresaForm.email || empresaForm.website" class="pt-2 mt-2 border-t">
                            <p x-show="empresaForm.telefone" class="text-xs text-gray-500">
                                <i class="bi bi-telephone mr-1"></i><span x-text="empresaForm.telefone"></span>
                            </p>
                            <p x-show="empresaForm.email" class="text-xs text-gray-500">
                                <i class="bi bi-envelope mr-1"></i><span x-text="empresaForm.email"></span>
                            </p>
                            <p x-show="empresaForm.website" class="text-xs text-gray-500">
                                <i class="bi bi-globe mr-1"></i><span x-text="empresaForm.website"></span>
                            </p>
                        </div>
                    </div>

                    <!-- Carimbo Preview -->
                    <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-2 font-medium">Carimbo:</p>
                        <div class="w-24 h-24 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center bg-gray-50 dark:bg-gray-800">
                            <img x-show="empresaForm.carimboPreview || empresaForm.carimbo" 
                                 :src="empresaForm.carimboPreview || empresaForm.carimbo" 
                                 :key="empresaForm.carimboPreview || empresaForm.carimbo"
                                 alt="Carimbo"
                                 class="max-w-full max-h-full object-contain">
                            <i x-show="!empresaForm.carimboPreview && !empresaForm.carimbo" class="bi bi-stamp text-4xl text-gray-300 dark:text-gray-600"></i>
                        </div>
                    </div>

                    <!-- Cores -->
                    <div x-show="empresaForm.corPrimaria || empresaForm.corSecundaria" class="pt-4 border-t border-gray-200 dark:border-gray-700 mt-4">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-2 font-medium">Cores:</p>
                        <div class="flex space-x-3">
                            <div class="flex items-center space-x-2">
                                <div class="w-10 h-10 rounded-lg border-2 border-gray-300 dark:border-gray-600 shadow-sm" 
                                     :style="'background-color: ' + (empresaForm.corPrimaria || '#1e40af')"></div>
                                <span class="text-xs text-gray-600 dark:text-gray-400">Prim√°ria</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-10 h-10 rounded-lg border-2 border-gray-300 dark:border-gray-600 shadow-sm" 
                                     :style="'background-color: ' + (empresaForm.corSecundaria || '#64748b')"></div>
                                <span class="text-xs text-gray-600 dark:text-gray-400">Secund√°ria</span>
                            </div>
                        </div>
                    </div>

                    <!-- Marca d'√°gua -->
                    <div x-show="empresaForm.marcaDagua" class="pt-4 border-t border-gray-200 dark:border-gray-700 mt-4">
                        <p class="text-xs text-gray-500 dark:text-gray-400 mb-2 font-medium">Marca d'√°gua:</p>
                        <p class="text-2xl font-bold text-gray-200 dark:text-gray-700 transform -rotate-45 text-center" 
                           x-text="empresaForm.marcaDagua"></p>
                    </div>
                </div>

                <!-- Dica -->
                <div class="bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-600 p-4 rounded-lg">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        <i class="bi bi-lightbulb-fill mr-2"></i>
                        <strong>Dica:</strong> Este preview mostra como sua empresa aparecer√° nos documentos PDF gerados.
                    </p>
                </div>
            </div>
        </div>

        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/github-api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/image-uploader.js"></script>
    <script>
        // Inst√¢ncias globais necess√°rias
        const githubAPI = new GitHubAPI();
        const auth = new SimpleAuth();
    </script>
    
    <!-- Sistema de C√°lculo de Sal√°rios -->
    <script src="js/calculo-salario.js"></script>
    
    <!-- Sistema de Gest√£o de Trabalhadores (ETAPA 2) -->
    <script src="js/cliente-manager.js"></script>
    
    <!-- Modelos de Documentos (Modulares) -->
    <script src="js/modelos/declaracao-executivo.js"></script>
    
    <!-- Controllers -->
    <script src="js/admin-controller.js"></script>
    <!-- MODAL: SALVAR PERSONALIZA√á√ÉO -->
    <div x-show="modalSalvarPersonalizacao" 
         x-cloak
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6"
             @click.stop>
            
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-gray-800">
                    <i class="bi bi-save mr-2"></i>Salvar Personaliza√ß√£o
                </h3>
                <button @click="modalSalvarPersonalizacao = false" 
                        class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="bi bi-x"></i>
                </button>
            </div>

            <p class="text-sm text-gray-600 mb-4">
                Salvando no <strong x-text="'Slot ' + slotSelecionado?.replace('slot', '')"></strong>
            </p>

            <!-- Nome da Personaliza√ß√£o -->
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">
                    Nome da Personaliza√ß√£o
                </label>
                <input type="text" 
                       x-model="nomePersonalizacaoTemp"
                       @keyup.enter="salvarPersonalizacao(slotSelecionado)"
                       placeholder="Ex: Declara√ß√£o Formal Azul"
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       autofocus>
            </div>

            <!-- Informa√ß√µes -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                <p class="text-xs text-blue-700">
                    <i class="bi bi-info-circle mr-1"></i>
                    Esta personaliza√ß√£o ser√° salva localmente no seu navegador e ficar√° dispon√≠vel para uso posterior.
                </p>
            </div>

            <!-- Bot√µes -->
            <div class="flex space-x-2">
                <button @click="modalSalvarPersonalizacao = false"
                        class="flex-1 px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium transition-colors">
                    Cancelar
                </button>
                <button @click="salvarPersonalizacao(slotSelecionado)"
                        class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
                    <i class="bi bi-check-lg mr-1"></i>Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/historico-manager.js"></script>
    <script src="js/image-cache-manager.js"></script>

    <!-- Inicializa√ß√£o do Swiper (Carrosseis Responsivos) -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Carrossel de Stats do Dashboard - Configura√ß√£o Profissional
            const statsSwiper = new Swiper('.statsSwiper', {
                // Configura√ß√µes b√°sicas
                slidesPerView: 1,
                spaceBetween: 16,
                loop: false,
                grabCursor: true,
                centeredSlides: false,
                
                // Autoplay inteligente
                autoplay: {
                    delay: 4000,
                    disableOnInteraction: true,
                    pauseOnMouseEnter: true
                },
                
                // Pagina√ß√£o profissional
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                    dynamicBullets: false,
                    renderBullet: function (index, className) {
                        return '<span class="' + className + '"></span>';
                    }
                },
                
                // Efeitos de transi√ß√£o
                effect: 'slide',
                speed: 600,
                
                // Touch events otimizados
                touchEventsTarget: 'container',
                simulateTouch: true,
                touchRatio: 1,
                touchAngle: 45,
                shortSwipes: true,
                longSwipes: true,
                longSwipesRatio: 0.5,
                
                // Resist√™ncia nos limites
                resistance: true,
                resistanceRatio: 0.85,
                
                // Breakpoints responsivos
                breakpoints: {
                    // Mobile muito pequeno (320px)
                    320: {
                        slidesPerView: 1,
                        spaceBetween: 12,
                        navigation: {
                            enabled: false
                        }
                    },
                    // Mobile pequeno (375px)
                    375: {
                        slidesPerView: 1,
                        spaceBetween: 14,
                        navigation: {
                            enabled: true
                        }
                    },
                    // Mobile (480px)
                    480: {
                        slidesPerView: 1.3,
                        spaceBetween: 16,
                        centeredSlides: false
                    },
                    // Phablet (540px)
                    540: {
                        slidesPerView: 1.5,
                        spaceBetween: 16
                    },
                    // Tablet pequeno (640px)
                    640: {
                        slidesPerView: 2,
                        spaceBetween: 18
                    },
                    // Tablet (768px)
                    768: {
                        slidesPerView: 2.5,
                        spaceBetween: 20
                    },
                    // Tablet grande (900px)
                    900: {
                        slidesPerView: 3,
                        spaceBetween: 20
                    }
                },
                
                // Callbacks
                on: {
                    init: function () {
                        console.log('‚úÖ Carrossel de stats inicializado');
                    },
                    slideChange: function () {
                        // Feedback haptico em dispositivos que suportam
                        if ('vibrate' in navigator) {
                            navigator.vibrate(10);
                        }
                    }
                }
            });
        });
    </script>

    <!-- ===================================================================== -->
    <!-- MODAIS DE TRABALHADORES -->
    <!-- ===================================================================== -->


</body>
</html>
